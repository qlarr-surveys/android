import{r as D,a4 as F,m as T}from"./index-DCf9ET77.js";import{ad as N,ae as A,af as P,ag as Y,ah as k,ai as L,aj as z,ak as J,al as $,J as G,E as S,H as w,a2 as _,L as I,am as v,an as K,O as Q}from"./Android-0LfW9AkK.js";let x=!1;class U{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;N(!x,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return x=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{x=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class V{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!A(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=P({dropTarget:(t,c)=>{this.clearDropTarget(),this.dropTargetOptions=c,Y(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function W(n){return D.useMemo(()=>n.hooks.dropTarget(),[n])}function X(n){const e=k(),t=D.useMemo(()=>new V(e.getBackend()),[e]);return L(()=>(t.dropTargetOptions=n||null,t.reconnect(),()=>t.disconnectDropTarget()),[n]),t}function Z(){const n=k();return D.useMemo(()=>new U(n),[n])}function ee(n){const{accept:e}=n;return D.useMemo(()=>(N(n.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class te{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function re(n,e){const t=D.useMemo(()=>new te(n,e),[e]);return D.useEffect(()=>{t.spec=n},[n]),t}function ne(n,e,t){const c=k(),o=re(n,e),l=ee(n);L(function(){const[s,g]=z(l,o,c);return e.receiveHandlerId(s),t.receiveHandlerId(s),g},[c,e,o,t,l.map(f=>f.toString()).join("|")])}function B(n,e){const t=J(n),c=Z(),o=X(t.options);return ne(t,c,o),[$(t.collect,c,o),W(o)]}const oe="_dragContainer_5yuyr_1",ie="_rankingItem_5yuyr_10",j={dragContainer:oe,rankingItem:ie};function ce(n){const e=G(),t=F(),c=n.lang,o=S(r=>{let i={};return n.component.answers.forEach(h=>{i[h.qualifiedCode]=r.runState.values[h.qualifiedCode].value}),i},w),l=r=>isNaN(o[r])?"unsorted":"sorted",f=S(r=>{let i={};return n.component.answers.forEach(h=>{r.runState.order?i[h.qualifiedCode]=r.runState.order[h.qualifiedCode]:i[h.qualifiedCode]=r.runState.values[h.qualifiedCode].order+1}),i},w),s=n.component.answers.filter(r=>!o[r.qualifiedCode]).sort(function(r,i){return f[r.qualifiedCode]-f[i.qualifiedCode]}),g=n.component.answers.filter(r=>+o[r.qualifiedCode]>0).sort(function(r,i){return o[r.qualifiedCode]-o[i.qualifiedCode]}),p=(r,i,h)=>{const u={...f};if(h=="sorted"&&l(r.qualifiedCode)=="unsorted"){const d=i+1;for(let a in o)o.hasOwnProperty(a)&&o[a]>=d&&e(I({componentCode:a,value:o[a]+1}));e(I({componentCode:r.qualifiedCode,value:d})),r.index=i;const C=u[r.qualifiedCode];s.forEach(a=>{u[a.qualifiedCode]>=C&&(u[a.qualifiedCode]=u[a.qualifiedCode]-1)}),e(v(u))}else if(h=="unsorted"&&l(r.qualifiedCode)=="sorted"){const d=o[r.qualifiedCode];for(let a in o)o.hasOwnProperty(a)&&o[a]>=d&&e(I({componentCode:a,value:o[a]-1}));e(I({componentCode:r.qualifiedCode,value:void 0})),r.index=i;const C=i+1;s.forEach(a=>{u[a.qualifiedCode]>=C&&(u[a.qualifiedCode]=u[a.qualifiedCode]+1)}),u[r.qualifiedCode]=C,e(v(u))}},O=r=>{l(r.qualifiedCode)=="unsorted"?p(r,g.length,"sorted"):p(r,s.length,"unsorted")},q=(r,i,h,u)=>{const d={...f};if(h=="unsorted"&&l(r.qualifiedCode)=="unsorted"){const C=d[r.qualifiedCode];d[r.qualifiedCode]=d[i.qualifiedCode],d[i.qualifiedCode]=C,e(v(d)),r.index=u}else h=="sorted"&&l(r.qualifiedCode)=="sorted"&&(e(I({componentCode:r.qualifiedCode,value:o[i.qualifiedCode]})),e(I({componentCode:i.qualifiedCode,value:o[r.qualifiedCode]})),r.index=u)};return T.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[T.jsx(H,{styles:j,lang:c,theme:t,ordererLength:g.length,unordererLength:s.length,onHover:q,order:f,onItemTransfer:p,onDoubleClick:O,itemType:"unsorted",options:s}),T.jsx(H,{styles:j,lang:c,theme:t,onHover:q,onItemTransfer:p,onDoubleClick:O,ordererLength:g.length,unordererLength:s.length,order:f,itemType:"sorted",options:g})]})}function H({styles:n,itemType:e,lang:t,theme:c,options:o,onItemTransfer:l,onDoubleClick:f,onHover:s}){const g=D.useRef(null);return T.jsxs(_,{ref:g,className:n.dragContainer,sx:{backgroundColor:"background.default"},children:[o.map((p,O)=>T.jsxs(D.Fragment,{children:[T.jsx(E,{itemType:e,index:O,onItemTransfer:l},"drop"+p.code),T.jsx(ae,{lang:t,theme:c,index:O,onHover:s,itemType:e,option:p,rankingItemStyle:n.rankingItem,onDoubleClick:f},p.code)]},p.code)),T.jsx(E,{itemType:e,index:o.length,fillParent:!0,onItemTransfer:l},"last")]})}function ae({lang:n,theme:e,option:t,onDoubleClick:c,rankingItemStyle:o,index:l,onHover:f,itemType:s}){var u;const g=D.useRef(),p={index:l,qualifiedCode:t.qualifiedCode},[O,q,r]=K({type:"rankingOption",item:p,collect:d=>{var C;return((C=d.getItem())==null?void 0:C.qualifiedCode)===t.qualifiedCode}}),[{handlerId:i},h]=B({accept:"rankingOption",collect(d){return{handlerId:d.getHandlerId()}},hover(d,C){var R;if(!g.current||!C.isOver({shallow:!0})||!d)return;const a=d.index,m=l;if(a===m)return;const y=(R=g.current)==null?void 0:R.getBoundingClientRect(),b=(y.bottom-y.top)/2,M=C.getClientOffset().y-y.top;a<m&&M<b||a>m&&M>b||f(d,t,s,l)}});return h(r(g)),T.jsx("div",{ref:q,children:T.jsx(_,{ref:g,"data-handler-id":i,style:{opacity:O?"0.2":"1"},onDoubleClick:()=>c(p),className:o,sx:{backgroundColor:"background.paper"},children:T.jsx(Q,{elementCode:t.code,fontFamily:e.textStyles.text.font,color:e.textStyles.text.color,fontSize:e.textStyles.text.size,name:"label",lang:n,content:(u=t.content)==null?void 0:u.label})})})}function E({index:n,onItemTransfer:e,itemType:t,fillParent:c}){const o=D.useRef(),[{handlerId:l},f]=B({accept:"rankingOption",collect(s){return{handlerId:s.getHandlerId()}},hover(s,g){!o.current||!g.isOver({shallow:!0})||!s||e(s,n,t)}});return f(o),T.jsx("div",{style:{flex:c?1:"inherit",minHeight:"12px"},ref:o,"data-handler-id":l})}export{ce as default};
