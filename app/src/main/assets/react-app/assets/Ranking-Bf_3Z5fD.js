import{j as q,r as v}from"./index-DrdL8HT2.js";import{U as H,H as b,aS as D,b9 as L,aT as p,ba as y}from"./use-service-0Fq5u1zn.js";import{B as m}from"./index-DQ4E-_8z.js";import{u as B}from"./useDrop-DSjUcWFC.js";import"./isTouchDevice-CHtK4r2d.js";import"./common-5BhfyGYi.js";import"./CardMedia-CIEe5zwn.js";import"./Card-Dppxln-L.js";import"./Toolbar-CWuxDDNF.js";const N="_dragContainer_5yuyr_1",M="_rankingItem_5yuyr_10",E={dragContainer:N,rankingItem:M};function Q(s){const t=H(),r=b(e=>{let o={};return s.component.answers.forEach(l=>{o[l.qualifiedCode]=e.runState.values[l.qualifiedCode].value}),o},D),u=e=>isNaN(r[e])?"unsorted":"sorted",f=b(e=>{let o={};return s.component.answers.forEach(l=>{e.runState.order?o[l.qualifiedCode]=e.runState.order[l.qualifiedCode]:o[l.qualifiedCode]=e.runState.values[l.qualifiedCode].order+1}),o},D),C=s.component.answers.filter(e=>!r[e.qualifiedCode]).sort(function(e,o){return f[e.qualifiedCode]-f[o.qualifiedCode]}),c=s.component.answers.filter(e=>+r[e.qualifiedCode]>0).sort(function(e,o){return r[e.qualifiedCode]-r[o.qualifiedCode]}),a=(e,o,l)=>{const i={...f};if(l=="sorted"&&u(e.qualifiedCode)=="unsorted"){const d=o+1;for(let n in r)r.hasOwnProperty(n)&&r[n]>=d&&t(p({componentCode:n,value:r[n]+1}));t(p({componentCode:e.qualifiedCode,value:d})),e.index=o;const g=i[e.qualifiedCode];C.forEach(n=>{i[n.qualifiedCode]>=g&&(i[n.qualifiedCode]=i[n.qualifiedCode]-1)}),t(y(i))}else if(l=="unsorted"&&u(e.qualifiedCode)=="sorted"){const d=r[e.qualifiedCode];for(let n in r)r.hasOwnProperty(n)&&r[n]>=d&&t(p({componentCode:n,value:r[n]-1}));t(p({componentCode:e.qualifiedCode,value:void 0})),e.index=o;const g=o+1;C.forEach(n=>{i[n.qualifiedCode]>=g&&(i[n.qualifiedCode]=i[n.qualifiedCode]+1)}),i[e.qualifiedCode]=g,t(y(i))}},h=e=>{u(e.qualifiedCode)=="unsorted"?a(e,c.length,"sorted"):a(e,C.length,"unsorted")},x=(e,o,l,i)=>{const d={...f};if(l=="unsorted"&&u(e.qualifiedCode)=="unsorted"){const g=d[e.qualifiedCode];d[e.qualifiedCode]=d[o.qualifiedCode],d[o.qualifiedCode]=g,t(y(d)),e.index=i}else l=="sorted"&&u(e.qualifiedCode)=="sorted"&&(t(p({componentCode:e.qualifiedCode,value:r[o.qualifiedCode]})),t(p({componentCode:o.qualifiedCode,value:r[e.qualifiedCode]})),e.index=i)};return q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[q.jsx(S,{styles:E,ordererLength:c.length,unordererLength:C.length,onHover:x,order:f,onItemTransfer:a,onDoubleClick:h,itemType:"unsorted",options:C}),q.jsx(S,{styles:E,onHover:x,onItemTransfer:a,onDoubleClick:h,ordererLength:c.length,unordererLength:C.length,order:f,itemType:"sorted",options:c})]})}function S({styles:s,itemType:t,options:r,onItemTransfer:u,onDoubleClick:f,onHover:C}){const c=v.useRef(null);return q.jsxs(m,{ref:c,className:s.dragContainer,sx:{backgroundColor:"background.default"},children:[r.map((a,h)=>q.jsxs(v.Fragment,{children:[q.jsx(_,{itemType:t,index:h,onItemTransfer:u},"drop"+a.code),q.jsx(P,{index:h,onHover:C,itemType:t,option:a,rankingItemStyle:s.rankingItem,onDoubleClick:f},a.code)]},a.code)),q.jsx(_,{itemType:t,index:r.length,fillParent:!0,onItemTransfer:u},"last")]})}function P({option:s,onDoubleClick:t,rankingItemStyle:r,index:u,onHover:f,itemType:C}){var i;const c=v.useRef(),a={index:u,qualifiedCode:s.qualifiedCode},[h,x,e]=L({type:"rankingOption",item:a,collect:d=>{var g;return((g=d.getItem())==null?void 0:g.qualifiedCode)===s.qualifiedCode}}),[{handlerId:o},l]=B({accept:"rankingOption",collect(d){return{handlerId:d.getHandlerId()}},hover(d,g){var R;if(!c.current||!g.isOver({shallow:!0})||!d)return;const n=d.index,O=u;if(n===O)return;const k=(R=c.current)==null?void 0:R.getBoundingClientRect(),j=(k.bottom-k.top)/2,w=g.getClientOffset().y-k.top;n<O&&w<j||n>O&&w>j||f(d,s,C,u)}});return l(e(c)),q.jsx("div",{ref:x,children:q.jsx(m,{ref:c,"data-handler-id":o,style:{opacity:h?"0.2":"1"},onDoubleClick:()=>t(a),className:r,sx:{backgroundColor:"background.paper"},children:(i=s.content)==null?void 0:i.label})})}function _({index:s,onItemTransfer:t,itemType:r,fillParent:u}){const f=v.useRef(),[{handlerId:C},c]=B({accept:"rankingOption",collect(a){return{handlerId:a.getHandlerId()}},hover(a,h){!f.current||!h.isOver({shallow:!0})||!a||t(a,s,r)}});return c(f),q.jsx("div",{style:{flex:u?1:"inherit",minHeight:"12px"},ref:f,"data-handler-id":C})}export{Q as default};
