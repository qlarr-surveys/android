import{r as C,j as e,R as r,z as V}from"./index-Dk6dJ9ej.js";import{f as Q,R as G,w as J,M as N,be as O,H as k,U as P,aQ as x,b3 as W,b1 as A,b5 as X,aV as Y}from"./use-service-CuOd9RJq.js";import{a as U}from"./index-D8xbzhRJ.js";import{L as q}from"./Link-XdUsRC_k.js";import"./isTouchDevice-BxZW9fIr.js";import"./common-DrzhiyDD.js";import"./Close-Coe7rEfx.js";import"./Card-vFcRbAK1.js";import"./Toolbar-C-_hleNE.js";const Z=Q("input")({display:"none"});function de(i){var _,b,F,g,w,S,y,z;const M=G("run"),v=J(),{t:d}=N("run");let o=O((b=(_=i.component.validation)==null?void 0:_.validation_file_types)==null?void 0:b.fileTypes);const c=((g=(F=i.component.validation)==null?void 0:F.validation_max_file_size)==null?void 0:g.isActive)&&((S=(w=i.component.validation)==null?void 0:w.validation_max_file_size)==null?void 0:S.max_size)||-1,t=k(n=>{let s=n.runState.values[i.component.qualifiedCode];return s==null?void 0:s.value}),T=k(n=>n.runState.preview),m=P(),[a,u]=C.useState(),[l,f]=C.useState(!1),D=()=>{window.Android.previewFileUpload(t.stored_filename,t.filename)},p=!l&&a&&o.length>0&&!o.includes(a.type),h=!l&&a&&c>0&&a.size/1024>c,R=n=>{m(A(i.component.qualifiedCode)),u(n.target.files[0])},K=()=>{f(!0),X(M,i.component.qualifiedCode,T,a).then(n=>{f(!1),j(),m(Y({componentCode:i.component.qualifiedCode,value:n}))}).catch(n=>{f(!1),console.error(n)})},j=()=>{u(void 0)},L=n=>{if(window.Android){const s=i.component.qualifiedCode;n.preventDefault(),window.Android.selectFile(s,(o==null?void 0:o.join(","))||"",c||-1),window["onFileSelected"+s]=(E,H,I)=>{m(A(i.component.qualifiedCode)),u({name:E,size:H,type:I})}}};let B=a&&!p&&!h;return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"contained-button-file",children:[e.jsx(Z,{id:"contained-button-file",type:"file",accept:o?o.join(","):void 0,onChange:R}),e.jsx(x,{disabled:l,onClick:L,variant:"contained",component:"span",children:d("choose_file")})]}),a?e.jsxs(r.Fragment,{children:[e.jsxs("span",{children:["Â ",a.name," - ",Math.round(a.size/1024),"K"]}),B?e.jsx(x,{disabled:l,variant:"text",onClick:K,children:d("upload")}):"",e.jsx(x,{disabled:l,sx:{fontFamily:v.textStyles.text.font,fontSize:v.textStyles.text.size},variant:"text",onClick:j,children:d("cancel")})]}):"",h&&e.jsxs(r.Fragment,{children:[e.jsx("br",{}),e.jsx(U,{name:"validation_max_file_size",validation:(y=i.component.validation)==null?void 0:y.validation_max_file_size})]}),p&&e.jsxs(r.Fragment,{children:[e.jsx("br",{}),e.jsx(U,{name:"validation_file_types",validation:(z=i.component.validation)==null?void 0:z.validation_file_types})]}),l?e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(V,{}),e.jsx("br",{}),e.jsx("span",{children:d("uploading")})]}):!t||!t.stored_filename?"":e.jsxs(r.Fragment,{children:[e.jsx("br",{}),e.jsx("br",{}),window.Android?e.jsxs(q,{target:"_blank",onClick:D,children:[t.filename," - ",Math.round(t.size/1024),"K"]}):e.jsxs(q,{target:"_blank",href:W(t.stored_filename),children:[t.filename," - ",Math.round(t.size/1024),"K"]})]})]})}export{de as default};
