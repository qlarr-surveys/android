import{j as q,r as x}from"./index-BdaHkdQl.js";import{D as H,v as D,aG as L,aq as p,aH as y}from"./use-service-D09swmN7.js";import{s as b}from"./index-Djh-vddw.js";import{B as m}from"./Box-DN3Tm9NJ.js";import{u as B}from"./useDrop-DJ-jQUqd.js";import"./isTouchDevice-DBnnGyOq.js";import"./common-C_0iAd7K.js";import"./ArrowBack-l2Daik9b.js";const N="_dragContainer_5yuyr_1",M="_rankingItem_5yuyr_10",E={dragContainer:N,rankingItem:M};function T(s){const a=H(),r=D(e=>{let o={};return s.component.answers.forEach(l=>{o[l.qualifiedCode]=e.runState.values[l.qualifiedCode].value}),o},b),u=e=>isNaN(r[e])?"unsorted":"sorted",f=D(e=>{let o={};return s.component.answers.forEach(l=>{e.runState.order?o[l.qualifiedCode]=e.runState.order[l.qualifiedCode]:o[l.qualifiedCode]=e.runState.values[l.qualifiedCode].order+1}),o},b),C=s.component.answers.filter(e=>!r[e.qualifiedCode]).sort(function(e,o){return f[e.qualifiedCode]-f[o.qualifiedCode]}),c=s.component.answers.filter(e=>+r[e.qualifiedCode]>0).sort(function(e,o){return r[e.qualifiedCode]-r[o.qualifiedCode]}),t=(e,o,l)=>{const i={...f};if(l=="sorted"&&u(e.qualifiedCode)=="unsorted"){const d=o+1;for(let n in r)r.hasOwnProperty(n)&&r[n]>=d&&a(p({componentCode:n,value:r[n]+1}));a(p({componentCode:e.qualifiedCode,value:d})),e.index=o;const g=i[e.qualifiedCode];C.forEach(n=>{i[n.qualifiedCode]>=g&&(i[n.qualifiedCode]=i[n.qualifiedCode]-1)}),a(y(i))}else if(l=="unsorted"&&u(e.qualifiedCode)=="sorted"){const d=r[e.qualifiedCode];for(let n in r)r.hasOwnProperty(n)&&r[n]>=d&&a(p({componentCode:n,value:r[n]-1}));a(p({componentCode:e.qualifiedCode,value:void 0})),e.index=o;const g=o+1;C.forEach(n=>{i[n.qualifiedCode]>=g&&(i[n.qualifiedCode]=i[n.qualifiedCode]+1)}),i[e.qualifiedCode]=g,a(y(i))}},h=e=>{u(e.qualifiedCode)=="unsorted"?t(e,c.length,"sorted"):t(e,C.length,"unsorted")},v=(e,o,l,i)=>{const d={...f};if(l=="unsorted"&&u(e.qualifiedCode)=="unsorted"){const g=d[e.qualifiedCode];d[e.qualifiedCode]=d[o.qualifiedCode],d[o.qualifiedCode]=g,a(y(d)),e.index=i}else l=="sorted"&&u(e.qualifiedCode)=="sorted"&&(a(p({componentCode:e.qualifiedCode,value:r[o.qualifiedCode]})),a(p({componentCode:o.qualifiedCode,value:r[e.qualifiedCode]})),e.index=i)};return q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[q.jsx(S,{styles:E,ordererLength:c.length,unordererLength:C.length,onHover:v,order:f,onItemTransfer:t,onDoubleClick:h,itemType:"unsorted",options:C}),q.jsx(S,{styles:E,onHover:v,onItemTransfer:t,onDoubleClick:h,ordererLength:c.length,unordererLength:C.length,order:f,itemType:"sorted",options:c})]})}function S({styles:s,itemType:a,options:r,onItemTransfer:u,onDoubleClick:f,onHover:C}){const c=x.useRef(null);return q.jsxs(m,{ref:c,className:s.dragContainer,sx:{backgroundColor:"background.default"},children:[r.map((t,h)=>q.jsxs(x.Fragment,{children:[q.jsx(_,{itemType:a,index:h,onItemTransfer:u},"drop"+t.code),q.jsx(P,{index:h,onHover:C,itemType:a,option:t,rankingItemStyle:s.rankingItem,onDoubleClick:f},t.code)]},t.code)),q.jsx(_,{itemType:a,index:r.length,fillParent:!0,onItemTransfer:u},"last")]})}function P({option:s,onDoubleClick:a,rankingItemStyle:r,index:u,onHover:f,itemType:C}){var i;const c=x.useRef(),t={index:u,qualifiedCode:s.qualifiedCode},[h,v,e]=L({type:"rankingOption",item:t,collect:d=>{var g;return((g=d.getItem())==null?void 0:g.qualifiedCode)===s.qualifiedCode}}),[{handlerId:o},l]=B({accept:"rankingOption",collect(d){return{handlerId:d.getHandlerId()}},hover(d,g){var R;if(!c.current||!g.isOver({shallow:!0})||!d)return;const n=d.index,O=u;if(n===O)return;const k=(R=c.current)==null?void 0:R.getBoundingClientRect(),j=(k.bottom-k.top)/2,w=g.getClientOffset().y-k.top;n<O&&w<j||n>O&&w>j||f(d,s,C,u)}});return l(e(c)),q.jsx("div",{ref:v,children:q.jsx(m,{ref:c,"data-handler-id":o,style:{opacity:h?"0.2":"1"},onDoubleClick:()=>a(t),className:r,sx:{backgroundColor:"background.paper"},children:(i=s.content)==null?void 0:i.label})})}function _({index:s,onItemTransfer:a,itemType:r,fillParent:u}){const f=x.useRef(),[{handlerId:C},c]=B({accept:"rankingOption",collect(t){return{handlerId:t.getHandlerId()}},hover(t,h){!f.current||!h.isOver({shallow:!0})||!t||a(t,s,r)}});return c(f),q.jsx("div",{style:{flex:u?1:"inherit",minHeight:"12px"},ref:f,"data-handler-id":C})}export{T as default};
