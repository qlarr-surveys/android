import{j as e,B as j,p as T,w as Z,R as Q,r as v,u as Y,A as ee,L as te}from"./index-DrdL8HT2.js";import{d as se}from"./Delete-CZJSvO2w.js";import{f as N,s as I}from"./DateUtils-Ce4EpQzP.js";import{e as ne,M as V,aM as ae,T as L,aD as O,R as oe,h as U,bk as re,I as ie,bd as le,b1 as ce}from"./use-service-0Fq5u1zn.js";import{t as de,C as pe}from"./Web-f7YbRHTs.js";import{T as ue,c as A}from"./Tabs-CzcAv-q5.js";import{T as me,a as fe,b as z,c as he}from"./TableRow-BbZSZcIZ.js";import{T as xe}from"./TableHead-CWmtQXfJ.js";import{T as i}from"./TableCell-DKckLh6O.js";import{T as ve}from"./TablePagination-BIv43byg.js";import"./Checkbox-DbTDcKnM.js";import"./SwitchBase-9pSiC_Cg.js";import"./radioClasses-CNZTtMI3.js";import"./tableRowClasses-Dzs-lpCH.js";import"./TextField-DRWs31uB.js";import"./FormControlLabel-DFbM1-QV.js";import"./Toolbar-CWuxDDNF.js";const je=ne(e.jsx("path",{d:"M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"}),"ArrowOutward"),ge="_mainContainer_14aat_1",we="_loadingWrapper_14aat_12",be="_cardContent_14aat_19",E={mainContainer:ge,loadingWrapper:we,cardContent:be},_e="_wrapper_5jjwg_1",ye="_action_5jjwg_13",Ce="_separator_5jjwg_20",M={wrapper:_e,action:ye,separator:Ce},Te=({open:R,onClose:w,onDelete:r})=>{const{t:m}=V("manage");return e.jsx(ae,{sx:{".MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0.3)"}},open:R,onClose:w,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(j,{className:M.wrapper,children:[e.jsx(L,{variant:"h5",fontWeight:600,children:m("responses.title_delete_response")}),e.jsx(j,{className:M.separator}),e.jsxs(j,{className:M.action,children:[e.jsx(O,{onClick:w,color:"primary",variant:"contained",children:m("action_btn.cancel")}),e.jsx(O,{variant:"secondary",onClick:r,children:m("action_btn.delete")})]})]})})};var q={exports:{}};(function(R,w){(function(r,m){m()})(T,function(){function r(t,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\uFEFF",t],{type:t.type}):t}function m(t,n,l){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){_(a.response,n,l)},a.onerror=function(){console.error("could not download file")},a.send()}function h(t){var n=new XMLHttpRequest;n.open("HEAD",t,!1);try{n.send()}catch(l){}return 200<=n.status&&299>=n.status}function x(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(l){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var p=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof T=="object"&&T.global===T?T:void 0,b=p.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),_=p.saveAs||(typeof window!="object"||window!==p?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(t,n,l){var a=p.URL||p.webkitURL,c=document.createElement("a");n=n||t.name||"download",c.download=n,c.rel="noopener",typeof t=="string"?(c.href=t,c.origin===location.origin?x(c):h(c.href)?m(t,n,l):x(c,c.target="_blank")):(c.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(c.href)},4e4),setTimeout(function(){x(c)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,l){if(n=n||t.name||"download",typeof t!="string")navigator.msSaveOrOpenBlob(r(t,l),n);else if(h(t))m(t,n,l);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){x(a)})}}:function(t,n,l,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof t=="string")return m(t,n,l);var c=t.type==="application/octet-stream",u=/constructor/i.test(p.HTMLElement)||p.safari,S=/CriOS\/[\d]+/.test(navigator.userAgent);if((S||c&&u||b)&&typeof FileReader<"u"){var f=new FileReader;f.onloadend=function(){var C=f.result;C=S?C:C.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=C:location=C,a=null},f.readAsDataURL(t)}else{var y=p.URL||p.webkitURL,g=y.createObjectURL(t);a?a.location=g:location.href=g,a=null,setTimeout(function(){y.revokeObjectURL(g)},4e4)}});p.saveAs=_.saveAs=_,R.exports=_})})(q);var Re=q.exports;const Se=Z(Re);function Ee({viewEvents:R}){const w=oe("survey"),{t:r}=V("manage"),[m,h]=v.useState(!0),[x,p]=v.useState(!1),[b,_]=v.useState("none"),[t,n]=v.useState(null),{surveyId:l}=Y(),a=s=>{h(!1)},c=Intl.DateTimeFormat().resolvedOptions().timeZone,[u,S]=v.useState(null),[f,y]=v.useState(1),[g,C]=v.useState(10),G=()=>{h(!0),w.exportResponses(l,c,x,b).then(s=>{if(s){var d=new File([s],"".concat(l,"-responses-export.csv"),{type:"text/csv;charset=utf-8"});Se.saveAs(d)}h(!1)}).catch(s=>{a()})},K=s=>{_("none"),n(s.surveyorID)},X=s=>{switch(s){case"true":return!0;case"false":return!1;case"none":default:return}},W=(s=!1)=>{h(!0);const d=X(b);w.allResponse(l,x,f,g,d,t).then(o=>{if(o){const H=o.totalCount,P=Math.ceil(H/g),J=f>P?P:f;s&&f>P&&y(J+1),S(o)}h(!1)}).catch(o=>{a(),h(!1)})};v.useEffect(()=>{W()},[f,g,x,b,t]);const[D,B]=v.useState(),F=()=>{B(null)},$=()=>{F(),w.deleteResponse(l,D.id).then(()=>{W(!0)}).catch(s=>{a()})},k={SHOW_ALL:"none",SHOW_COMPLETED:"true",SHOW_INCOMPLETE:"false"};return e.jsxs(j,{className:E.mainContainer,children:[e.jsxs(j,{display:"flex",flexWrap:{xs:"wrap",sm:"wrap",md:"nowrap"},gap:10,children:[e.jsxs(j,{width:"100%",className:E.cardContent,children:[e.jsx(L,{variant:"h5",color:"primary",fontWeight:600,children:r("responses.raw_values")}),e.jsx(de,{checked:x,onChange:s=>{p(s.target.checked)}})]}),e.jsxs(j,{width:"100%",className:E.cardContent,children:[e.jsx(L,{variant:"h5",color:"primary",fontWeight:600,children:r("responses.export")}),e.jsx(O,{sx:{minWidth:"50px"},color:"primary",disabled:t||!1,size:"small",variant:"contained",onClick:()=>G(),children:e.jsx(je,{})})]})]}),e.jsxs(j,{display:"flex",alignItems:"center",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(L,{color:"primary",variant:"h4",fontWeight:600,sx:{width:"33%"},children:r("responses.filter_completed")}),e.jsxs(ue,{sx:{width:"100%"},value:b,onChange:(s,d)=>{y(1),_(d)},textColor:"primary",indicatorColor:"primary",variant:"fullWidth",children:[e.jsx(A,{disabled:t||!1,label:r("responses.filter_completed_show_all"),value:k.SHOW_ALL}),e.jsx(A,{disabled:t||!1,label:r("responses.filter_completed_show_completed"),value:k.SHOW_COMPLETED}),e.jsx(A,{disabled:t||!1,label:r("responses.filter_completed_show_incomplete"),value:k.SHOW_INCOMPLETE})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(O,{sx:{margin:"8px"},onClick:()=>n(null),children:r("responses.reset_surveyor_filter")})]}),m?e.jsx("div",{className:E.loadingWrapper,children:e.jsx(ee,{})}):e.jsxs(U,{sx:{width:"100%",background:"transparent",mb:2},children:[e.jsx(me,{component:U,children:e.jsxs(fe,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(xe,{children:u&&e.jsxs(z,{children:[e.jsx(i,{},"btns"),e.jsx(i,{align:"left",children:"ID"},"id"),e.jsx(i,{align:"left",children:r("label.surveyor")},"surveyor"),e.jsx(i,{align:"left",children:r("responses.ip_addr")},"ip"),e.jsx(i,{align:"left",children:r("responses.start_date")},"start_date"),e.jsx(i,{align:"left",children:r("responses.submit_date")},"submit_date"),e.jsx(i,{align:"left",children:r("responses.lang")},"lang"),Object.values(u==null?void 0:u.columnNames).map(s=>e.jsx(i,{align:"left",children:re(s)},s))]})}),e.jsx(he,{children:u==null?void 0:u.responses.map(s=>e.jsxs(z,{sx:{minHeight:"100px"},children:[e.jsx(i,{align:"left",children:e.jsx(j,{sx:{display:"flex"},children:e.jsx(ie,{onClick:()=>{B(s)},children:e.jsx(se,{})})})},"btns"),e.jsx(i,{align:"left",children:s.index},"id"),e.jsx(i,{align:"left",children:s.surveyorName?e.jsx(te,{onClick:()=>{K(s)},children:s.surveyorName}):""},"surveyor"),e.jsx(i,{align:"left",children:s.ipAddress},"ip"),e.jsx(i,{align:"left",children:N(I(s.startDate))},"startDate"),e.jsx(i,{align:"left",children:s.submitDate?N(I(s.submitDate)):" - "},"submitDate"),e.jsx(i,{align:"left",children:s.lang},"lang"),Object.keys(s.values).map(d=>{const o=s.values[d];return e.jsx(i,{align:"left",children:o==null||o===""?" - ":typeof o=="string"?e.jsx(pe,{showIcon:!1,title:o,children:e.jsx("span",{children:le(o,25)})}):typeof o=="object"&&"size"in o&&"filename"in o&&"stored_filename"in o?e.jsxs("a",{target:"_blank",download:o.stored_filename,href:ce(s.id,d.split(".")[0]),children:[o.filename," -",Math.round(o.size/1e3)+"K"]}):JSON.stringify(o)},d)})]},s.id))})]})}),e.jsx(ve,{rowsPerPageOptions:[10,25,50,100],component:"div",labelDisplayedRows:({from:s,to:d,count:o,page:H})=>r("responses.label_displayed_rows",{from:s,to:d,count:o}),labelRowsPerPage:r("responses.label_rows_per_page"),count:u==null?void 0:u.totalCount,rowsPerPage:g,page:f-1,onPageChange:(s,d)=>{y(d+1)},onRowsPerPageChange:s=>{C(parseInt(s.target.value,10)),y(1)}})]}),!!D&&e.jsx(Te,{onDelete:$,open:!!D,onClose:F})]})}const Ge=Q.memo(Ee);export{Ge as default};
