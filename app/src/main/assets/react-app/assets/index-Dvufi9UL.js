import{j as e,f as pe,g as he,h as se,_ as z,r as c,b as fe,d as J,B as M,R as xe}from"./index-BPkE25ts.js";import{e as te,f as ae,B as _e,j as be,c as ge,M as q,aL as je,T as V,aC as re,Q as ne,R as oe,Y as y,aM as ve,aK as Se,J as Ce,I as Ue,bW as Ne,N as K}from"./use-service-Bb7LY6Q3.js";import{L as B,d as ye,a as E,c as Re,e as Te,o as De}from"./yup-BOIU9D06.js";import{u as Ae,p as Me,j as _,F as Ie,R as k,q as Ee,I as P}from"./Web-BBqAH_aj.js";import{a as Le}from"./Tabs-ui_O5_y9.js";import{C as we}from"./Card-D1gdhD1c.js";import{T as $e,a as ke,b as Pe,c as Q,d as Oe}from"./TableRow-Beq5cqAM.js";import{a as X}from"./tableRowClasses-JqPlK2IC.js";import{T as g}from"./TableCell-BjKLxRk-.js";import{D as ze}from"./Divider-D51H4_yW.js";import"./Checkbox-Dntn-pZ4.js";import"./SwitchBase-CHSPGF-1.js";import"./radioClasses-CjX8ViDh.js";import"./TextField-M1IR9KQb.js";import"./FormControlLabel-sZjcD-3I.js";const Be=te(e.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}),"ArrowDownward");function qe(a){return he("MuiTableSortLabel",a)}const O=pe("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc"]),Ve=["active","children","className","direction","hideSortIcon","IconComponent"],Fe=a=>{const{classes:r,direction:l,active:u}=a,t={root:["root",u&&"active"],icon:["icon","iconDirection".concat(se(l))]};return ge(t,qe,r)},We=ae(_e,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:l}=a;return[r.root,l.active&&r.active]}})(({theme:a})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(a.vars||a).palette.text.secondary},"&:hover":{color:(a.vars||a).palette.text.secondary,["& .".concat(O.icon)]:{opacity:.5}},["&.".concat(O.active)]:{color:(a.vars||a).palette.text.primary,["& .".concat(O.icon)]:{opacity:1,color:(a.vars||a).palette.text.secondary}}})),Ye=ae("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(a,r)=>{const{ownerState:l}=a;return[r.icon,r["iconDirection".concat(se(l.direction))]]}})(({theme:a,ownerState:r})=>z({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:a.transitions.create(["opacity","transform"],{duration:a.transitions.duration.shorter}),userSelect:"none"},r.direction==="desc"&&{transform:"rotate(0deg)"},r.direction==="asc"&&{transform:"rotate(180deg)"})),L=c.forwardRef(function(r,l){const u=be({props:r,name:"MuiTableSortLabel"}),{active:t=!1,children:p,className:j,direction:b="asc",hideSortIcon:v=!1,IconComponent:n=Be}=u,R=fe(u,Ve),S=z({},u,{active:t,direction:b,hideSortIcon:v,IconComponent:n}),N=Fe(S);return e.jsxs(We,z({className:J(N.root,j),component:"span",disableRipple:!0,ownerState:S,ref:l},R,{children:[p,v&&!t?null:e.jsx(Ye,{as:n,className:J(N.icon),ownerState:S})]}))}),He=te(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd"),Ge="_mainContainer_1u62w_1",Ze="_content_1u62w_9",Je={mainContainer:Ge,content:Ze},Ke="_addUser_6nyqh_1",Qe={addUser:Ke},Xe="_wrapper_1rjvu_1",es="_action_1rjvu_13",ee={wrapper:Xe,action:es},ss=({open:a,onClose:r,deleteUser:l,name:u,isLoading:t})=>{const{t:p}=q("manage");return e.jsx(je,{sx:{".MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0.3)"}},open:a,onClose:r,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(M,{className:ee.wrapper,children:[e.jsx(V,{children:p("users_manage.delete_title",{name:u})}),e.jsxs(M,{className:ee.action,children:[e.jsx(B,{variant:"contained",onClick:l,loading:t,children:p("action_btn.delete")}),e.jsx(re,{onClick:r,children:p("action_btn.cancel")})]})]})})},ts="_mainContainer_sp6mp_1",as="_createUserCard_sp6mp_9",rs="_formGroup_sp6mp_13",ns="_errorText_sp6mp_17",os={mainContainer:ts,createUserCard:as,formGroup:rs,errorText:ns};function is({userId:a,open:r,onClose:l}){const u=ne("user"),{t}=q("manage"),p=oe();ye(E,"noWhitespace",function(o){return this.test("no-whitespace",o,function(d){const{path:f,createError:x}=this;return d!=null&&d.trim()?!0:x({path:f,message:o})})});const j=Re().shape({firstName:E().required(t("firstname_required")).noWhitespace(t("error.invalid_first_name")).max(50,t("error.first_name_too_long")),lastName:E().required(t("lastname_required")).noWhitespace(t("error.invalid_last_name")).max(50,t("error.last_name_too_long")),email:E().required(t("email_required")).matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/i,t("error.invalid_email")),roles:Te().required(t("error.roles_required")).min(1,t("error.at_least_one_role"))}),b={firstName:"",lastName:"",email:"",roles:[]},v=Ae({resolver:De(j),defaultValues:b}),n=Me({control:v.control,name:"roles"}),{setError:R,reset:S,handleSubmit:N,formState:{isSubmitting:w},setValue:T,watch:F}=v;c.useEffect(()=>{a&&(p(y(!0)),u.getUser({userId:a}).then(o=>{p(y(!1)),S(o)}))},[S,a]);const D=N(async o=>{p(y(!0));const{firstName:d,lastName:f,email:x,roles:C}=o;try{a?await u.updateUser({userId:a,data:{email:x,firstName:d,lastName:f,roles:C}}):await u.createUser({email:x,firstName:d,lastName:f,roles:C}),l()}catch(I){I.name==ve.DUPLICATE_EMAIL.name&&R("email",{type:"manual",message:t("processed_errors.".concat(I.name))})}finally{p(y(!1))}}),$=[{value:_.SUPER_ADMIN,label:t("label.super_admin")},{value:_.SURVEY_ADMIN,label:t("label.survey_admin")},{value:_.ANALYST,label:t("label.analyst")},{value:_.SURVEYOR,label:t("label.surveyor")}],A=(o,d)=>{const f=d.includes(_.SUPER_ADMIN),x=d.includes(_.SURVEY_ADMIN);return f||x?f&&o!==_.SUPER_ADMIN||x&&o!==_.SURVEY_ADMIN:!1};return c.useEffect(()=>{const o=n.includes(_.SUPER_ADMIN),d=n.includes(_.SURVEY_ADMIN);if(o||d){const f=n.filter(x=>x===_.SUPER_ADMIN||x===_.SURVEY_ADMIN);T("roles",f)}},[n,T]),e.jsx(Le,{open:r,onClose:l,maxWidth:"md",fullWidth:!0,children:e.jsxs(we,{sx:{overflow:"visible"},className:os.createUserCard,children:[e.jsx(V,{variant:"h4",sx:{mb:3},children:t(a?"edit_user.title":"add_user.title")}),e.jsxs(Ie,{methods:v,onSubmit:D,children:[e.jsxs(Se,{spacing:2.5,children:[e.jsx(k,{name:"firstName",label:t("label.first_name")}),e.jsx(k,{name:"lastName",label:t("label.last_name")}),e.jsx(k,{name:"email",label:t("label.email")}),e.jsx(Ee,{chip:!0,checkbox:!0,name:"roles",label:t("add_user.roles"),options:$,isOptionDisabled:A})]}),e.jsxs(M,{sx:{display:"flex",gap:"1rem",justifyContent:"flex-end",mt:"40px"},children:[e.jsx(B,{onClick:()=>l(!0),color:"inherit",size:"large",variant:"contained",children:t("add_user.cancel")}),e.jsx(B,{color:"inherit",size:"large",type:"submit",variant:"contained",loading:w,children:t("add_user.save")})]})]})]})})}const ls=()=>{const a=ne("user"),{t:r}=q("manage"),[l,u]=c.useState([]),t=oe(),[p,j]=c.useState(null),[b,v]=c.useState("asc"),[n,R]=c.useState("name"),[S,N]=c.useState(null),[w,T]=c.useState(null),[F,D]=c.useState(!1),$=Ce.getUser().id,A=()=>{t(y(!0)),a.getAllUsers().then(s=>{s&&u(s)}).finally(()=>{t(y(!1))})},[o,d]=c.useState(null),f=()=>{d(null)},x=()=>{D(!0),a.deleteUser({userId:o.id}).then(()=>{f(),A(),D(!1)}).catch(s=>{D(!1)})};c.useEffect(()=>{A()},[]);const C=s=>{v(n===s&&b==="asc"?"desc":"asc"),R(s)},I=(s,m)=>{const i=s.map((h,U)=>[h,U]);return i.sort((h,U)=>{const Z=m(h[0],U[0]);return Z!==0?Z:h[1]-U[1]}),i.map(h=>h[0])},ie=(s,m)=>s==="desc"?(i,h)=>W(i,h,m):(i,h)=>-W(i,h,m),W=(s,m,i)=>{if(i==="name"){const h="".concat(s.firstName," ").concat(s.lastName).toLowerCase(),U="".concat(m.firstName," ").concat(m.lastName).toLowerCase();return U<h?-1:U>h?1:0}else return m[i]<s[i]?-1:m[i]>s[i]?1:0},le=I(l,ie(b,n)),[Y,H]=c.useState(!1),G=(s=null)=>{N(s),H(!0)},ce=s=>{G(s),j(null)},de=s=>{H(!1),s||A()},me=c.useCallback((s,m)=>{j(s.currentTarget),T(m)},[]),ue=c.useCallback(()=>{j(null),T(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(M,{display:"flex",justifyContent:"space-between",children:[e.jsx(V,{variant:"h5",sx:{mb:3},children:r("users_manage.users")}),e.jsxs(re,{className:Qe.addUser,onClick:()=>G(),children:[e.jsx(He,{}),r("users_manage.add_user")]})]}),e.jsx($e,{sx:{overflow:"unset",["& .".concat(X.head)]:{color:"text.primary"},["& .".concat(X.root)]:{bgcolor:"background.default",borderBottomColor:s=>s.palette.divider}},children:e.jsxs(ke,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Pe,{children:e.jsxs(Q,{children:[e.jsx(g,{align:"left",children:e.jsx(L,{active:n==="name",direction:n==="name"?b:"asc",onClick:()=>C("name"),children:r("users_manage.name")})}),e.jsx(g,{align:"left",children:e.jsx(L,{active:n==="email",direction:n==="email"?b:"asc",onClick:()=>C("email"),children:r("users_manage.email")})}),e.jsx(g,{align:"left",children:e.jsx(L,{active:n==="roles",direction:n==="roles"?b:"asc",onClick:()=>C("roles"),children:r("users_manage.roles")})}),e.jsx(g,{align:"left",children:e.jsx(L,{active:n==="status",direction:n==="status"?b:"asc",onClick:()=>C("status"),children:r("users_manage.status")})})]})}),e.jsx(Oe,{children:le.map(s=>{const m=!s.isConfirmed||s.id===$;return e.jsxs(xe.Fragment,{children:[e.jsxs(Q,{children:[e.jsxs(g,{align:"left",children:[s.firstName," ",s.lastName]}),e.jsx(g,{align:"left",children:s.email}),e.jsx(g,{align:"left",children:s.roles.map(i=>r("label.".concat(i))).join(", ")}),e.jsx(g,{align:"left",children:s.isConfirmed?r("users_manage.active"):r("users_manage.invitation_sent")}),e.jsx(g,{align:"right",padding:"none",children:!m&&e.jsx(Ue,{onClick:i=>me(i,s.id),children:e.jsx(P,{icon:"carbon:overflow-menu-vertical"})})})]},s.id),e.jsxs(Ne,{open:!!p&&w===s.id,anchorEl:p,onClose:ue,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{width:160}}},children:[e.jsxs(K,{onClick:()=>{ce(s.id)},children:[e.jsx(P,{icon:"carbon:edit",sx:{mr:1}})," ",r("users_manage.title_edit")]}),e.jsx(ze,{sx:{borderStyle:"dashed",mt:.5}}),e.jsxs(K,{onClick:()=>{j(null),d(s)},sx:{color:"error.main"},children:[e.jsx(P,{icon:"carbon:trash-can",sx:{mr:1}})," ",r("users_manage.title_delete")]})]})]},s.id)})})]})}),!!o&&e.jsx(ss,{deleteUser:x,name:o.firstName+" "+o.lastName,open:!!o,onClose:f,isLoading:F}),Y&&e.jsx(is,{userId:S,open:Y,onClose:de})]})};function Us(){return e.jsx(M,{className:Je.mainContainer,children:e.jsx(ls,{})})}export{Us as default};
