import{h as k,r as u,b as et,_ as ve,d as ke,j as e,q as ye,B as _,s as tt,aj as at,z as Fe}from"./index-Dk6dJ9ej.js";import{f as Me,j as st,x as Oe,c as rt,e as me,K as Ce,T as z,bf as Ue,I as M,M as ae,R as te,U as be,aO as G,X as D,aR as pe,bg as nt,V as ot,aN as it,aQ as $e,a_ as Pe,J as lt}from"./use-service-CuOd9RJq.js";import{u as He,d as ct,a as dt,D as ut}from"./Image-Bpkmz4MJ.js";import{s as Re,l as ze}from"./DateUtils-Ce4EpQzP.js";import{b as B,g as pt,T as F,E as Le,S as mt,a as ht,A as gt,i as K,d as vt,c as ft,e as _e,u as xt,F as _t,R as yt,f as Ct,h as Ae}from"./Web-DQ9Pn3X4.js";import{d as bt}from"./dayjs.min-CgH4Saeh.js";import{d as St}from"./Delete-B5E6oedv.js";import{b as jt}from"./common-DrzhiyDD.js";import{T as Ve}from"./TextField-D9TfNg6R.js";import{C as we}from"./Card-vFcRbAK1.js";import{C as Dt,a as Ne}from"./Close-Coe7rEfx.js";import{D as Tt}from"./Divider-BUY4a0fY.js";import{c as It,a as Et,o as kt,L as Ot}from"./yup-Ke-idBs6.js";import{S as V}from"./survey-D2pw4t3m.js";import{T as $t}from"./TablePagination-mwr8tNNv.js";import"./Checkbox-B5kyj27j.js";import"./SwitchBase-vj41ugwS.js";import"./Tabs-BEdGyaaJ.js";import"./radioClasses-u6Ak_u_2.js";import"./tableRowClasses-CVBxymtu.js";import"./FormControlLabel-DbQERhmC.js";import"./TableCell-Df_hHt8Q.js";import"./Toolbar-C-_hleNE.js";function Pt(t){const{badgeContent:s,invisible:a=!1,max:c=99,showZero:d=!1}=t,i=He({badgeContent:s,max:c});let n=a;a===!1&&s===0&&!d&&(n=!0);const{badgeContent:o,max:l=c}=n?i:t,m=o&&Number(o)>l?"".concat(l,"+"):o;return{badgeContent:o,invisible:n,max:l,displayValue:m}}const Rt=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],fe=10,xe=4,zt=t=>{const{color:s,anchorOrigin:a,invisible:c,overlap:d,variant:i,classes:n={}}=t,o={root:["root"],badge:["badge",i,c&&"invisible","anchorOrigin".concat(k(a.vertical)).concat(k(a.horizontal)),"anchorOrigin".concat(k(a.vertical)).concat(k(a.horizontal)).concat(k(d)),"overlap".concat(k(d)),s!=="default"&&"color".concat(k(s))]};return rt(o,pt,n)},At=Me("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,s)=>s.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Nt=Me("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,s)=>{const{ownerState:a}=t;return[s.badge,s[a.variant],s["anchorOrigin".concat(k(a.anchorOrigin.vertical)).concat(k(a.anchorOrigin.horizontal)).concat(k(a.overlap))],a.color!=="default"&&s["color".concat(k(a.color))],a.invisible&&s.invisible]}})(({theme:t})=>{var s;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:fe*2,lineHeight:1,padding:"0 6px",height:fe*2,borderRadius:fe,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.keys(((s=t.vars)!=null?s:t).palette).filter(a=>{var c,d;return((c=t.vars)!=null?c:t).palette[a].main&&((d=t.vars)!=null?d:t).palette[a].contrastText}).map(a=>({props:{color:a},style:{backgroundColor:(t.vars||t).palette[a].main,color:(t.vars||t).palette[a].contrastText}})),{props:{variant:"dot"},style:{borderRadius:xe,height:xe*2,minWidth:xe*2,padding:0}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="right"&&a.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="top"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:a})=>a.anchorOrigin.vertical==="bottom"&&a.anchorOrigin.horizontal==="left"&&a.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",["&.".concat(B.invisible)]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}}),Be=u.forwardRef(function(s,a){var c,d,i,n,o,l;const m=st({props:s,name:"MuiBadge"}),{anchorOrigin:f={vertical:"top",horizontal:"right"},className:I,component:g,components:S={},componentsProps:T={},children:U,overlap:w="rectangular",color:y="default",invisible:x=!1,max:Y=99,badgeContent:A,slots:O,slotProps:N,showZero:v=!1,variant:b="standard"}=m,$=et(m,Rt),{badgeContent:P,invisible:H,max:se,displayValue:he}=Pt({max:Y,invisible:x,badgeContent:A,showZero:v}),L=He({anchorOrigin:f,color:y,overlap:w,variant:b,badgeContent:A}),re=H||P==null&&b!=="dot",{color:ne=y,overlap:q=w,anchorOrigin:oe=f,variant:W=b}=re?L:m,Q=W!=="dot"?he:void 0,X=ve({},m,{badgeContent:P,invisible:re,max:se,displayValue:Q,showZero:v,anchorOrigin:oe,color:ne,overlap:q,variant:W}),ie=zt(X),le=(c=(d=O==null?void 0:O.root)!=null?d:S.Root)!=null?c:At,ce=(i=(n=O==null?void 0:O.badge)!=null?n:S.Badge)!=null?i:Nt,Z=(o=N==null?void 0:N.root)!=null?o:T.root,J=(l=N==null?void 0:N.badge)!=null?l:T.badge,ge=Oe({elementType:le,externalSlotProps:Z,externalForwardedProps:$,additionalProps:{ref:a,as:g},ownerState:X,className:ke(Z==null?void 0:Z.className,ie.root,I)}),de=Oe({elementType:ce,externalSlotProps:J,ownerState:X,className:ke(ie.badge,J==null?void 0:J.className)});return e.jsxs(le,ve({},ge,{children:[U,e.jsx(ce,ve({},de,{children:Q}))]}))}),Bt=me(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),Ft=me(e.jsx("path",{d:"M18 2H9c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H9V4h9zM3 15v-2h2v2zm0-5.5h2v2H3zM10 20h2v2h-2zm-7-1.5v-2h2v2zM5 22c-1.1 0-2-.9-2-2h2zm3.5 0h-2v-2h2zm5 0v-2h2c0 1.1-.9 2-2 2M5 6v2H3c0-1.1.9-2 2-2"}),"CopyAll"),Mt=me(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description"),Ut=me(e.jsx("path",{d:"M6 6h12v12H6z"}),"Stop"),Ht="_mainContainer_1kl2v_1",Lt="_newSurveysButton_1kl2v_8",Vt="_content_1kl2v_13",wt="_loadingWrapper_1kl2v_20",Wt="_allButton_1kl2v_27",Gt="_surveyCardsContainer_1kl2v_43",Yt="_noSurveys_1kl2v_51",ee={mainContainer:Ht,newSurveysButton:Lt,content:Vt,loadingWrapper:wt,allButton:Wt,surveyCardsContainer:Gt,noSurveys:Yt};var Se={},qt=ye;Object.defineProperty(Se,"__esModule",{value:!0});var We=Se.default=void 0,Qt=qt(Ce()),Xt=e;We=Se.default=(0,Qt.default)((0,Xt.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article");const Zt="_surveyHeader_k7hfg_1",Jt="_contentCard_k7hfg_7",Kt="_actionBtn_k7hfg_11",ea="_card_k7hfg_17",ta="_cardContent_k7hfg_22",aa="_imageContainer_k7hfg_28",sa="_surveyContent_k7hfg_35",ra="_surveyTitle_k7hfg_43",na="_surveyStatus_k7hfg_48",oa="_badge_k7hfg_55",ia="_textTransform_k7hfg_61",la="_surveyResponse_k7hfg_65",ca="_surveyActions_k7hfg_72",da="_iconButton_k7hfg_82",ua="_logo_k7hfg_126",pa="_logoImageWrapper_k7hfg_139",ma="_imageOverlay_k7hfg_143",ha="_cameraIconWrapper_k7hfg_155",ga="_cameraIcon_k7hfg_155",va="_relativeContainer_k7hfg_182",fa="_absoluteOverlay_k7hfg_187",xa="_container_k7hfg_200",_a="_truncatedText_k7hfg_206",ya="_exampleTruncatedText_k7hfg_220",Ca="_titleContainer_k7hfg_235",ba="_surveyLink_k7hfg_243",Sa="_nameIcon_k7hfg_248",ja="_descriptionContainer_k7hfg_259",Da="_descriptionIcon_k7hfg_272",Ta="_photoIcon_k7hfg_281",h={surveyHeader:Zt,contentCard:Jt,actionBtn:Kt,card:ea,cardContent:ta,imageContainer:aa,surveyContent:sa,surveyTitle:ra,surveyStatus:na,badge:oa,textTransform:ia,surveyResponse:la,surveyActions:ca,iconButton:da,logo:ua,logoImageWrapper:pa,imageOverlay:ma,cameraIconWrapper:ha,cameraIcon:ga,relativeContainer:va,absoluteOverlay:fa,container:xa,truncatedText:_a,exampleTruncatedText:ya,titleContainer:Ca,surveyLink:ba,nameIcon:Sa,descriptionContainer:ja,descriptionIcon:Da,photoIcon:Ta};function ue(t,s){return t?bt(t).format("DD MMM YYYY"):""}var je={},Ia=ye;Object.defineProperty(je,"__esModule",{value:!0});var Ge=je.default=void 0,Ea=Ia(Ce()),ka=e;Ge=je.default=(0,Ea.default)((0,ka.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"}),"FormatQuote");var De={},Oa=ye;Object.defineProperty(De,"__esModule",{value:!0});var Ye=De.default=void 0,$a=Oa(Ce()),Pa=e;Ye=De.default=(0,$a.default)((0,Pa.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");const Ra=({survey:t,onSave:s,isEditable:a=!0})=>{const[c,d]=u.useState(!1),[i,n]=u.useState(t.name),o=f=>{n(f.target.value)},l=()=>{i.trim()===""?n(t.name):i!==t.name&&s(i,()=>n(t.name)),d(!1)},m=f=>{f.stopPropagation(),d(!0)};return e.jsx(_,{className:h.titleContainer,children:c?e.jsx(Ve,{sx:{px:3,flexGrow:1},value:i,onChange:o,onBlur:l,autoFocus:!0,variant:"standard",fullWidth:!0,InputProps:{style:{color:"white"}}}):e.jsxs(e.Fragment,{children:[e.jsx(F,{title:i.length>20?i:"",sx:{fontSize:"1.2rem"},arrow:!0,children:e.jsx(z,{variant:"h4",sx:{px:3},noWrap:!0,children:Ue(i,18)})}),a&&e.jsx(M,{className:h.nameIcon,onClick:m,sx:{ml:1},children:e.jsx(Le,{sx:{color:"white"}})})]})})},za=({survey:t,onSave:s,isEditable:a=!0,isExample:c})=>{const[d,i]=u.useState(!1),[n,o]=u.useState(t.description),l=c?450:125,m=g=>{o(g.target.value)},f=()=>{n!==t.description&&s(n,()=>o(t.description)),i(!1)},I=g=>{g.stopPropagation(),i(!0)};return e.jsx(_,{className:h.descriptionContainer,children:d?e.jsx(Ve,{sx:{px:3},value:n,onChange:m,onBlur:f,autoFocus:!0,variant:"standard",fullWidth:!0,multiline:!0,rows:3}):e.jsxs(e.Fragment,{children:[e.jsx(F,{title:(n==null?void 0:n.length)>l?n:"",sx:{fontSize:"1.2rem"},arrow:!0,children:e.jsx(z,{variant:"caption",sx:{px:3,color:n?"inherit":"gray",flexGrow:1},className:"".concat(c?h.exampleTruncatedText:h.truncatedText),children:Ue(n,l)||"Click to add a description..."})}),a&&e.jsx(M,{className:"".concat(h.descriptionIcon),onClick:I,sx:{ml:1},children:e.jsx(Le,{sx:{color:"gray"}})})]})})},p={DRAFT:"draft",CLOSED:"closed",ACTIVE:"active",EXPIRED:"expired",SCHEDULED:"scheduled"},Aa=t=>{switch(t.status){case"draft":return p.DRAFT;case"closed":return p.CLOSED;case"active":return t.endDate&&Re(t.endDate)<Date.now()?p.EXPIRED:t.startDate&&Re(t.startDate)>Date.now()?p.SCHEDULED:p.ACTIVE;default:return p.DRAFT}},Na=t=>{switch(t){case p.DRAFT:return"#e9db3e";case p.CLOSED:return"#d32f2f";case p.EXPIRED:return"#9d4435";case p.SCHEDULED:return"#607d8b";case p.ACTIVE:return"#669834";default:return}},qe=({survey:t,example:s=!1,onClone:a,onDelete:c,onClose:d,onUpdateTitle:i,onUpdateDescription:n,onUpdateImage:o})=>{const{t:l}=ae("manage"),m=Aa(t),f=te("survey"),I=te("design"),[g,S]=u.useState(!1),[T,U]=u.useState(null),w=tt(),y=be(),x=at(),Y=(v,b)=>{y(D(!0)),f.putSurvey({...t,name:v},t.id).then(()=>{i(t.id,v)}).catch($=>{$.name==pe.DUPLICATE_SURVEY_NAME.name&&(U(l("processed_errors.".concat($.name))),S(!0),b())}).finally(()=>{y(D(!1))})},A=v=>{y(D(!0)),f.putSurvey({...t,description:v},t.id).then(()=>{n(t.id,v)}).catch(b=>{}).finally(()=>{y(D(!1))})},O=()=>{S(!1)},N=v=>{const b=v.target.files[0],$=new FileReader;$.onload=()=>{I.uploadResource(b,t.id).then(P=>{f.putSurvey({image:P.name},t.id).then(H=>{o(t.id,P.name)}).catch(H=>{U(l("processed_errors.".concat(H.name))),S(!0)}).finally(()=>{y(D(!1))})}).catch(P=>{U(l("processed_errors.".concat(P.name))),S(!0)}).finally(()=>{y(D(!1))})},$.readAsDataURL(b)};return e.jsxs(e.Fragment,{children:[e.jsx(mt,{}),e.jsx(ht,{open:g,autoHideDuration:6e3,onClose:O,children:e.jsx(gt,{onClose:O,severity:"error",children:T})}),e.jsxs(we,{sx:{"&:hover":{boxShadow:v=>v.customShadows.z24}},children:[e.jsxs(G,{sx:{pb:0},children:[e.jsxs(G,{spacing:.5,sx:{mb:1},children:[e.jsxs(_,{className:h.relativeContainer,children:[e.jsx(_,{className:h.absoluteOverlay,children:e.jsx(Ra,{survey:t,onSave:Y,isEditable:K()&&!s})}),e.jsxs(_,{className:h.logo,children:[e.jsxs(_,{className:"".concat(h.logoImageWrapper),children:[e.jsx(Dt,{component:"img",image:t.image?jt(t.image,t.id,s):"/qlarr.png",height:"150"}),e.jsx(_,{className:h.imageOverlay}),K()&&!t.example&&e.jsx(_,{className:h.photoIcon,onClick:v=>{v.stopPropagation(),document.getElementById("imageInput-".concat(t.id)).click()},children:e.jsx(ct,{className:h.cameraIcon})})]}),e.jsx("input",{id:"imageInput-".concat(t.id),type:"file",accept:"image/*",style:{display:"none"},onChange:N})]})]}),e.jsx(za,{survey:t,isExample:s,onSave:A,isEditable:K()&&!s}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{direction:"row",alignItems:"center",spacing:.5,sx:{px:3,typography:"body2",color:"text.secondary"},children:[e.jsx("span",{style:{backgroundColor:Na(m)},className:h.badge})," ",e.jsx(z,{variant:"subtitle2",className:h.textTransform,children:l("status.".concat(m))})]}),e.jsxs(_,{sx:{px:3,display:"flex",gap:2,my:.5},children:[!s&&t.status!=="closed"&&t.latestVersion.published===!1&&e.jsx(F,{title:"Has unpublished changes",children:e.jsx(Ye,{sx:{color:"text.secondary"}})}),e.jsx(F,{title:"Complete Responses: ".concat(t.completeResponseCount),children:e.jsx(Be,{badgeContent:t.completeResponseCount,color:"primary",anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(vt,{sx:{color:"text.secondary"}})})}),e.jsx(F,{title:t.surveyQuota>0?"Quota: ".concat(t.surveyQuota):"No Quota",children:e.jsx(Be,{badgeContent:t.surveyQuota>0?t.surveyQuota:0,color:"primary",anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ge,{sx:{color:"text.secondary"}})})})]})]})]}),e.jsxs(z,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:l("edit_survey.metadata.created")}),":"," ",ue(t.creationDate)]}),e.jsxs(z,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:l("edit_survey.metadata.last_modified")}),":"," ",ue(t.lastModified)]}),!s&&t.startDate&&e.jsxs(z,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:l("edit_survey.metadata.start_date")}),":"," ",ue(t.startDate)]}),!s&&t.endDate&&e.jsxs(z,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:l("edit_survey.metadata.end_date")}),":"," ",ue(t.endDate)]})]}),e.jsx(Tt,{sx:{borderStyle:"dashed",my:1}}),e.jsxs(G,{sx:{p:3,pt:0,typography:"body2",color:"text.secondary",textTransform:"capitalize"},className:h.surveyActions,children:[e.jsx(M,{className:h.iconButton,sx:{backgroundColor:x.palette.primary.main,"&:hover":{backgroundColor:x.palette.primary.main}},"aria-label":"redirect",size:"large",onClick:v=>{v.stopPropagation();const b=t.example?"/guest/preview/".concat(t.id):"/design-survey/".concat(t.id);w(b)},children:s?e.jsx(dt,{sx:{color:"#fff"}}):e.jsx(We,{sx:{color:"#fff"}})}),K()&&!s&&t.status==="active"&&e.jsx(F,{title:l("edit_survey.close_title"),children:e.jsx(M,{className:h.iconButton,"aria-label":"stop",size:"large",onClick:()=>d(t.id),children:e.jsx(Ut,{color:"primary"})})}),K()&&e.jsx(F,{title:l("edit_survey.clone_survey"),children:e.jsx(M,{className:h.iconButton,"aria-label":"clone",size:"large",onClick:a,children:e.jsx(ft,{color:"primary"})})}),!s&&t.status!==p.ACTIVE&&e.jsx(F,{title:l("action_btn.delete"),children:e.jsx(M,{className:h.iconButton,"aria-label":"delete",size:"large",onClick:()=>c(t.id),children:e.jsx(St,{color:"primary"})})})]})]})]})},Ba=({sort:t,filter:s,onFilterSelected:a,onSortSelected:c})=>{const d=[{value:"responses_desc",label:"survey_sort_options.responses_desc"},{value:"last_modified_desc",label:"survey_sort_options.last_modified_desc"}],i=[{value:"all",label:"status.all"},{value:p.ACTIVE,label:"status.".concat(p.ACTIVE)},{value:p.SCHEDULED,label:"status.".concat(p.SCHEDULED)},{value:p.DRAFT,label:"status.".concat(p.DRAFT)},{value:p.EXPIRED,label:"status.".concat(p.EXPIRED)},{value:p.CLOSED,label:"status.".concat(p.CLOSED)}],{t:n}=ae("manage");return e.jsxs(_,{rowGap:2.5,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(z,{variant:"h5",flex:"1",textTransform:"uppercase",fontWeight:"600",children:n("my_surveys")}),e.jsxs(G,{width:"100%",spacing:2.5,direction:{xs:"column",md:"row"},alignItems:"center",children:[e.jsx(_e,{onChange:c,native:!0,value:t,name:"Status",label:n("label.sort_by"),children:d.map(o=>e.jsx("option",{value:o.value,children:n(o.label)},o.value))}),e.jsx(_e,{onChange:a,native:!0,value:s,name:"Status",label:n("edit_survey.status"),children:i.map(o=>e.jsx("option",{value:o.value,children:n(o.label)},o.value))})]})]})},Fa="_exampleSurveysContainer_apkeh_1",Ma={exampleSurveysContainer:Fa},Ua=({onClone:t})=>{const{t:s}=ae("manage"),[a,c]=u.useState(!1),[d,i]=u.useState([]),n=te("survey");return u.useEffect(()=>{c(!0),n.getGuestsSurveys().then(o=>{if(c(!1),o){const l=o.map(m=>({...m,example:!0}));i(l)}}).catch(o=>{c(!1),nt(o)})},[]),e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"h5",marginBottom:2,fontWeight:600,textTransform:"uppercase",children:s("example_surveys")}),a?e.jsx(Fe,{}):e.jsx(_,{className:Ma.exampleSurveysContainer,sx:{mt:3,columnGap:4,display:"grid",rowGap:{xs:4,md:5},gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:d==null?void 0:d.map(o=>e.jsx(qe,{survey:o,onClone:()=>t(o),example:!0},o.id))})]})},Ha="_createUserCard_zrfc2_1",La="_formGroup_zrfc2_9",Va="_rightContainer_zrfc2_16",wa="_createButton_zrfc2_24",Wa="_surveyNameInput_zrfc2_39",Ga="_selectInput_zrfc2_55",Ya="_errorText_zrfc2_63",qa={createUserCard:Ha,formGroup:La,rightContainer:Va,createButton:wa,surveyNameInput:Wa,selectInput:Ga,errorText:Ya},Qa=[{value:V.WEB,label:"mode.".concat(V.WEB)},{value:V.OFFLINE,label:"mode.".concat(V.OFFLINE)},{value:V.MIXED,label:"mode.".concat(V.MIXED)}];function Xa({onSurveyCreated:t}){const s=te("survey"),{t:a}=ae("manage"),c=be(),d={surveyName:"",surveyMode:V.MIXED,surveyActiveFrom:"",surveyActiveTo:""},i=It().shape({surveyName:Et().required(a("survey_required")).max(50,a("survey_too_long"))}),n=xt({resolver:kt(i),defaultValues:d}),{setError:o,reset:l,handleSubmit:m,formState:{isSubmitting:f}}=n,I=m(async g=>{c(D(!0));const S={name:g.surveyName,usage:g.surveyMode};g.surveyActiveFrom&&(S.startDate=ze(surveyActiveFrom)),g.surveyActiveTo&&(S.endDate=ze(surveyActiveTo)),s.createSurvey(S).then(()=>{t&&(t(),l())}).catch(T=>{T.name==pe.DUPLICATE_SURVEY_NAME.name?o("surveyName",{type:"manual",message:a("processed_errors.".concat(T.name))}):T.name==pe.INVALID_SURVEY_DATES.name&&o("surveyActiveFrom",{type:"manual",message:a("processed_errors.".concat(T.name))})}).finally(()=>{c(D(!1))})});return e.jsx(we,{className:qa.createUserCard,children:e.jsx(_t,{methods:n,onSubmit:I,children:e.jsxs(_,{rowGap:2.5,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[e.jsx(yt,{name:"surveyName",label:a("label.survey_name")}),e.jsx(_e,{name:"surveyMode",label:a("label.survey_mode"),children:Qa.map(g=>e.jsx("option",{value:g.value,children:a(g.label)},g.value))}),e.jsx(Ot,{fullWidth:!0,size:"large",color:"primary",type:"submit",variant:"contained",loading:f,children:a("action_btn.create")})]})})})}function ys(){var Ie,Ee;const t=te("survey"),[s,a]=u.useState(null),[c,d]=u.useState(!0),[i,n]=u.useState(1),[o,l]=u.useState(5),[m,f]=u.useState("all"),[I,g]=u.useState("last_modified_desc"),[S,T]=u.useState(!1),[U,w]=u.useState(),y=be(),{t:x}=ae("manage"),Y=r=>{d(!1)},A=()=>{t.getAllSurveys(i,o,m,I).then(r=>{r&&(d(!1),a(r))}).catch(r=>Y())};u.useEffect(()=>{A()},[i,o,I,m]);const O=(r,C)=>{a(j=>({...j,surveys:j.surveys.map(R=>R.id===r?{...R,status:C}:R)}))},N=()=>{const r=lt.getUser().roles;return r.indexOf(Ae.SUPER_ADMIN)>-1||r.indexOf(Ae.SURVEY_ADMIN)>-1},[v,b]=u.useState(""),[$,P]=u.useState(""),[H,se]=u.useState(null),[he,L]=u.useState(!1),[re,ne]=u.useState(x("action_btn.delete")),[q,oe]=u.useState(!1),[W,Q]=u.useState(!1),X=()=>{oe(!0)},ie=()=>{Q(!0)},le=()=>{oe(!1)},ce=()=>{Q(!1)},Z=r=>{P("delete"),ne(x("action_btn.delete")),se(r),b(x("edit_survey.delete_survey",{survey_name:r.name})),L(!0)},J=r=>{P("close"),ne(x("action_btn.close")),se(r),b(x("edit_survey.close_survey",{survey_name:r.name})),L(!0)},ge=()=>{$==="delete"?(Qe(H.id),L(!1)):$==="close"&&(Xe(H.id),L(!1))},de=r=>{w(r),T(!0)},Qe=r=>{y(D(!0)),t.deleteSurvey(r).then(()=>{A()}).catch(C=>{y(D(!1))}).finally(()=>{y(D(!1))})},Xe=r=>{y(D(!0)),t.closeSurvey(r).then(C=>{O(r,"closed")}).catch(C=>{C.name==pe.INVALID_SURVEY_DATES.name&&setSurveyDateError(x("processed_errors.".concat(processed.name)))}).finally(()=>{y(D(!1))})},Ze=(r,C)=>{a(j=>{const R=j.surveys.map(E=>E.id===r?{...E,name:C}:E);return{...j,surveys:R}})},Je=(r,C)=>{a(j=>{const R=j.surveys.map(E=>E.id===r?{...E,description:C}:E);return{...j,surveys:R}})},Ke=(r,C)=>{a(j=>{const R=j.surveys.map(E=>E.id===r?{...E,image:C}:E);return{...j,surveys:R}})},Te=ot();return e.jsxs(_,{className:ee.mainContainer,children:[e.jsx(it,{children:e.jsxs(_,{className:ee.content,children:[e.jsxs(G,{className:ee.newSurveysButton,direction:"row",spacing:2,children:[N()&&!q&&e.jsx($e,{variant:"contained",color:"primary",startIcon:e.jsx(Bt,{}),onClick:X,children:x("create_new_survey")}),N()&&!W&&e.jsx($e,{variant:"contained",color:"primary",startIcon:e.jsx(Ft,{}),onClick:ie,children:x("copy_example_surveys")})]}),q&&e.jsx(Pe,{in:q,timeout:300,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(M,{onClick:le,"aria-label":"close",style:{position:"absolute",top:0,...Te==="ltr"?{right:0}:{left:0},color:"black",zIndex:1},children:e.jsx(Ne,{color:"#000"})}),e.jsx(Xa,{onSurveyCreated:A})]})}),W&&e.jsx(Pe,{in:W,timeout:300,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(M,{onClick:ce,"aria-label":"close",style:{position:"absolute",top:0,...Te==="ltr"?{right:0}:{left:0},color:"black",zIndex:1},children:e.jsx(Ne,{color:"#000"})}),e.jsx(Ua,{onClone:r=>de(r)})]})}),e.jsx(Ba,{filter:m,onFilterSelected:r=>{n(1),f(r.target.value)},sort:I,onSortSelected:r=>{n(1),g(r.target.value)}}),e.jsx(_,{className:ee.surveyCardsContainer,children:c?e.jsx(Fe,{}):e.jsx(e.Fragment,{children:((Ie=s==null?void 0:s.surveys)==null?void 0:Ie.length)>0?e.jsx(_,{sx:{mt:3,columnGap:2,display:"grid",rowGap:{xs:4,md:5},gridTemplateColumns:{xs:"1fr",sm:"repeat(auto-fit, minmax(280px, 1fr))",md:"repeat(auto-fit, minmax(330px, 350px))"}},children:(Ee=s==null?void 0:s.surveys)==null?void 0:Ee.map(r=>e.jsx(qe,{survey:r,onStatusChange:O,onClone:()=>de(r),onDelete:()=>Z(r),onClose:()=>J(r),onUpdateTitle:Ze,onUpdateDescription:Je,onUpdateImage:Ke},r.id))}):e.jsxs("div",{className:ee.noSurveys,children:[e.jsx(Mt,{sx:{fontSize:48,color:"#ccc"}}),e.jsx(z,{variant:"h6",color:"textSecondary",sx:{mt:2},children:x("create_survey.empty_state_message")})]})})}),s&&e.jsx($t,{rowsPerPageOptions:[5,10,20,50],component:"div",labelDisplayedRows:({from:r,to:C,count:j,page:R})=>x("responses.label_displayed_rows",{from:r,to:C,count:j}),labelRowsPerPage:x("responses.label_surveys_per_page"),count:s==null?void 0:s.totalCount,rowsPerPage:o,page:i-1,onPageChange:(r,C)=>{n(C+1)},onRowsPerPageChange:r=>{l(parseInt(r.target.value,10)),n(1)}})]})}),e.jsx(Ct,{open:S,onClose:r=>{T(!1),r&&A()},survey:U}),e.jsx(ut,{open:he,description:v,handleClose:()=>L(!1),handleDelete:ge,title:re})]})}export{ys as default};
