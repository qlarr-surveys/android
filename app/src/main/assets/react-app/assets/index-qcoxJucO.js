import{j as e,B as x,p as R,w as J,R as Q,r as h,u as Z,A as Y,L as ee}from"./index-BPkE25ts.js";import{d as te}from"./Delete-rQE9UuLi.js";import{f as N,s as I}from"./DateUtils-Ce4EpQzP.js";import{e as se,M as V,aL as ne,T as E,aC as L,Q as ae,h as U,bj as oe,I as re,bc as ie,b0 as le}from"./use-service-Bb7LY6Q3.js";import{t as ce,C as de}from"./Web-BBqAH_aj.js";import{T as pe,c as A}from"./Tabs-ui_O5_y9.js";import{T as ue,a as me,b as fe,c as z,d as he}from"./TableRow-Beq5cqAM.js";import{T as c}from"./TableCell-BjKLxRk-.js";import{T as xe}from"./TablePagination-B7Nn71C9.js";import"./Checkbox-Dntn-pZ4.js";import"./SwitchBase-CHSPGF-1.js";import"./radioClasses-CjX8ViDh.js";import"./tableRowClasses-JqPlK2IC.js";import"./TextField-M1IR9KQb.js";import"./FormControlLabel-sZjcD-3I.js";import"./Toolbar-DcOb7dJo.js";const je=se(e.jsx("path",{d:"M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"}),"ArrowOutward"),ve="_mainContainer_14aat_1",ge="_loadingWrapper_14aat_12",we="_cardContent_14aat_19",S={mainContainer:ve,loadingWrapper:ge,cardContent:we},be="_wrapper_5jjwg_1",_e="_action_5jjwg_13",ye="_separator_5jjwg_20",W={wrapper:be,action:_e,separator:ye},Ce=({open:v,onClose:i,onDelete:_})=>{const{t:l}=V("manage");return e.jsx(ne,{sx:{".MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0.3)"}},open:v,onClose:i,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(x,{className:W.wrapper,children:[e.jsx(E,{variant:"h5",fontWeight:600,children:l("responses.title_delete_response")}),e.jsx(x,{className:W.separator}),e.jsxs(x,{className:W.action,children:[e.jsx(L,{onClick:i,color:"primary",variant:"contained",children:l("action_btn.cancel")}),e.jsx(L,{variant:"secondary",onClick:_,children:l("action_btn.delete")})]})]})})};var q={exports:{}};(function(v,i){(function(_,l){l()})(R,function(){function _(s,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function l(s,n,p){var a=new XMLHttpRequest;a.open("GET",s),a.responseType="blob",a.onload=function(){m(a.response,n,p)},a.onerror=function(){console.error("could not download file")},a.send()}function g(s){var n=new XMLHttpRequest;n.open("HEAD",s,!1);try{n.send()}catch(p){}return 200<=n.status&&299>=n.status}function y(s){try{s.dispatchEvent(new MouseEvent("click"))}catch(p){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(n)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof R=="object"&&R.global===R?R:void 0,C=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),m=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!C?function(s,n,p){var a=d.URL||d.webkitURL,o=document.createElement("a");n=n||s.name||"download",o.download=n,o.rel="noopener",typeof s=="string"?(o.href=s,o.origin===location.origin?y(o):g(o.href)?l(s,n,p):y(o,o.target="_blank")):(o.href=a.createObjectURL(s),setTimeout(function(){a.revokeObjectURL(o.href)},4e4),setTimeout(function(){y(o)},0))}:"msSaveOrOpenBlob"in navigator?function(s,n,p){if(n=n||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(_(s,p),n);else if(g(s))l(s,n,p);else{var a=document.createElement("a");a.href=s,a.target="_blank",setTimeout(function(){y(a)})}}:function(s,n,p,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof s=="string")return l(s,n,p);var o=s.type==="application/octet-stream",O=/constructor/i.test(d.HTMLElement)||d.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||o&&O||C)&&typeof FileReader<"u"){var j=new FileReader;j.onloadend=function(){var b=j.result;b=f?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=b:location=b,a=null},j.readAsDataURL(s)}else{var w=d.URL||d.webkitURL,T=w.createObjectURL(s);a?a.location=T:location.href=T,a=null,setTimeout(function(){w.revokeObjectURL(T)},4e4)}});d.saveAs=m.saveAs=m,v.exports=m})})(q);var Te=q.exports;const Re=J(Te);function Se(){const v=ae("survey"),{t:i}=V("manage"),[_,l]=h.useState(!0),[g,y]=h.useState(!1),[d,C]=h.useState("none"),[m,s]=h.useState(null),{surveyId:n}=Z(),p=t=>{l(!1)},a=Intl.DateTimeFormat().resolvedOptions().timeZone,[o,O]=h.useState(null),[f,j]=h.useState(1),[w,T]=h.useState(10),b=()=>{l(!0),v.exportResponses(n,a,g,d).then(t=>{if(t){var u=new File([t],"".concat(n,"-responses-export.csv"),{type:"text/csv;charset=utf-8"});Re.saveAs(u)}l(!1)}).catch(t=>{p()})},G=t=>{C("none"),s(t.surveyorID)},K=t=>{switch(t){case"true":return!0;case"false":return!1;case"none":default:return}},M=(t=!1)=>{l(!0);const u=K(d);v.allResponse(n,g,f,w,u,m).then(r=>{if(r){const H=r.totalCount,k=Math.ceil(H/w),$=f>k?k:f;t&&f>k&&j($+1),O(r)}l(!1)}).catch(r=>{p(),l(!1)})};h.useEffect(()=>{M()},[f,w,g,d,m]);const[D,B]=h.useState(),F=()=>{B(null)},X=()=>{F(),v.deleteResponse(n,D.id).then(()=>{M(!0)}).catch(t=>{p()})},P={SHOW_ALL:"none",SHOW_COMPLETED:"true",SHOW_INCOMPLETE:"false"};return e.jsxs(x,{className:S.mainContainer,children:[e.jsxs(x,{display:"flex",flexWrap:{xs:"wrap",sm:"wrap",md:"nowrap"},gap:10,children:[e.jsxs(x,{width:"100%",className:S.cardContent,children:[e.jsx(E,{variant:"h5",color:"primary",fontWeight:600,children:i("responses.raw_values")}),e.jsx(ce,{checked:g,onChange:t=>{y(t.target.checked)}})]}),e.jsxs(x,{width:"100%",className:S.cardContent,children:[e.jsx(E,{variant:"h5",color:"primary",fontWeight:600,children:i("responses.export")}),e.jsx(L,{sx:{minWidth:"50px"},color:"primary",disabled:m||!1,size:"small",variant:"contained",onClick:()=>b(),children:e.jsx(je,{})})]})]}),e.jsxs(x,{display:"flex",alignItems:"center",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(E,{color:"primary",variant:"h4",fontWeight:600,sx:{width:"33%"},children:i("responses.filter_completed")}),e.jsxs(pe,{sx:{width:"100%"},value:d,onChange:(t,u)=>{j(1),C(u)},textColor:"primary",indicatorColor:"primary",variant:"fullWidth",children:[e.jsx(A,{disabled:m||!1,label:i("responses.filter_completed_show_all"),value:P.SHOW_ALL}),e.jsx(A,{disabled:m||!1,label:i("responses.filter_completed_show_completed"),value:P.SHOW_COMPLETED}),e.jsx(A,{disabled:m||!1,label:i("responses.filter_completed_show_incomplete"),value:P.SHOW_INCOMPLETE})]})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(L,{sx:{margin:"8px"},onClick:()=>s(null),children:i("responses.reset_surveyor_filter")})]}),_?e.jsx("div",{className:S.loadingWrapper,children:e.jsx(Y,{})}):e.jsxs(U,{sx:{width:"100%",background:"transparent",mb:2},children:[e.jsx(ue,{component:U,children:e.jsxs(me,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(fe,{children:o&&e.jsxs(z,{children:[e.jsx(c,{},"btns"),e.jsx(c,{align:"left",children:"ID"},"id"),e.jsx(c,{align:"left",children:i("label.surveyor")},"surveyor"),e.jsx(c,{align:"left",children:i("responses.ip_addr")},"ip"),e.jsx(c,{align:"left",children:i("responses.start_date")},"start_date"),e.jsx(c,{align:"left",children:i("responses.submit_date")},"submit_date"),e.jsx(c,{align:"left",children:i("responses.lang")},"lang"),Object.values(o==null?void 0:o.columnNames).map(t=>e.jsx(c,{align:"left",children:oe(t)},t))]})}),e.jsx(he,{children:o==null?void 0:o.responses.map(t=>e.jsxs(z,{sx:{minHeight:"100px"},children:[e.jsx(c,{align:"left",children:e.jsx(x,{sx:{display:"flex"},children:e.jsx(re,{onClick:()=>{B(t)},children:e.jsx(te,{})})})},"btns"),e.jsx(c,{align:"left",children:t.index},"id"),e.jsx(c,{align:"left",children:t.surveyorName?e.jsx(ee,{onClick:()=>{G(t)},children:t.surveyorName}):""},"surveyor"),e.jsx(c,{align:"left",children:t.ipAddress},"ip"),e.jsx(c,{align:"left",children:N(I(t.startDate))},"startDate"),e.jsx(c,{align:"left",children:t.submitDate?N(I(t.submitDate)):" - "},"submitDate"),e.jsx(c,{align:"left",children:t.lang},"lang"),Object.keys(t.values).map(u=>{const r=t.values[u];return e.jsx(c,{align:"left",children:r==null||r===""?" - ":typeof r=="string"?e.jsx(de,{showIcon:!1,title:r,children:e.jsx("span",{children:ie(r,25)})}):typeof r=="object"&&"size"in r&&"filename"in r&&"stored_filename"in r?e.jsxs("a",{target:"_blank",download:r.stored_filename,href:le(t.id,u.split(".")[0]),children:[r.filename," -",Math.round(r.size/1e3)+"K"]}):JSON.stringify(r)},u)})]},t.id))})]})}),e.jsx(xe,{rowsPerPageOptions:[10,25,50,100],component:"div",labelDisplayedRows:({from:t,to:u,count:r,page:H})=>i("responses.label_displayed_rows",{from:t,to:u,count:r}),labelRowsPerPage:i("responses.label_rows_per_page"),count:o==null?void 0:o.totalCount,rowsPerPage:w,page:f-1,onPageChange:(t,u)=>{j(u+1)},onRowsPerPageChange:t=>{T(parseInt(t.target.value,10)),j(1)}})]}),!!D&&e.jsx(Ce,{onDelete:X,open:!!D,onClose:F})]})}const Ve=Q.memo(Se);export{Ve as default};
