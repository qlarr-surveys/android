import{j as e,q as X,r,s as Pe,B as h,z as Le}from"./index-BdaHkdQl.js";import{d as Fe,x as Q,y as K,A as q,D as te,am as F,T as E,aK as ae,I as k,F as S,ao as Y,al as ke,w as we}from"./use-service-D09swmN7.js";import{s as pe,l as me}from"./DateUtils-Ce4EpQzP.js";import{S as Me,a as Oe,A as Ue,i as H,T as N,d as Be,b as We,c as ee,u as Ve,F as He,R as Ge,e as qe,f as _e}from"./Web-Xt-AHKsA.js";import{R as xe}from"./router-link-CfAjyfVJ.js";import{d as Ye}from"./dayjs.min-C6SlMFD4.js";import{d as Xe}from"./Delete-Dife5L9n.js";import{b as Qe}from"./common-C_0iAd7K.js";import{C as Ke,d as Je,D as Ze}from"./Image-CSM5aGrs.js";import{C as ve}from"./Card-DaS3BkKI.js";import{L as ge}from"./Link-Iys5U15E.js";import{D as et}from"./Divider-OC9h4qP8.js";import{T as fe}from"./TextField-B66jFwFo.js";import{c as tt,a as at,o as st}from"./yup-DY16kGze.js";import{S as P}from"./survey-x3hUDjhT.js";import{L as nt}from"./LoadingButton-CeTIEj79.js";import{T as rt}from"./TablePagination-D9rs5b3W.js";import"./Checkbox-0qy6A3Vu.js";import"./SwitchBase-outpB1OY.js";import"./useFormControl-BousA45m.js";import"./Tabs-CXy611xA.js";import"./radioClasses-DNdhtY0L.js";import"./tableRowClasses-D2zlaSzG.js";import"./FormControlLabel-DrGXXvQK.js";import"./TableCell-CNVjjGNS.js";const ot=Fe(e.jsx("path",{d:"M6 6h12v12H6z"}),"Stop"),it="_mainContainer_1sp6k_1",lt="_content_1sp6k_8",ct="_loadingWrapper_1sp6k_12",dt="_allButton_1sp6k_19",he={mainContainer:it,content:lt,loadingWrapper:ct,allButton:dt},ut="_surveyHeader_16zhi_1",pt="_contentCard_16zhi_7",mt="_actionBtn_16zhi_11",_t="_card_16zhi_17",ht="_cardContent_16zhi_22",xt="_imageContainer_16zhi_28",vt="_surveyContent_16zhi_35",gt="_surveyTitle_16zhi_43",ft="_surveyStatus_16zhi_48",St="_badge_16zhi_55",yt="_textTransform_16zhi_61",Ct="_surveyResponse_16zhi_65",jt="_surveyActions_16zhi_72",Dt="_iconButton_16zhi_82",bt="_logo_16zhi_123",Et="_logoImageWrapper_16zhi_137",It="_imageOverlay_16zhi_142",Tt="_cameraIconWrapper_16zhi_154",Rt="_cameraIcon_16zhi_154",zt="_relativeContainer_16zhi_182",$t="_absoluteOverlay_16zhi_187",At="_container_16zhi_200",Nt="_truncatedText_16zhi_206",Pt="_titleContainer_16zhi_220",Lt="_surveyLink_16zhi_228",Ft="_nameIcon_16zhi_233",kt="_descriptionContainer_16zhi_244",wt="_descriptionIcon_16zhi_257",Mt="_photoIcon_16zhi_266",l={surveyHeader:ut,contentCard:pt,actionBtn:mt,card:_t,cardContent:ht,imageContainer:xt,surveyContent:vt,surveyTitle:gt,surveyStatus:ft,badge:St,textTransform:yt,surveyResponse:Ct,surveyActions:jt,iconButton:Dt,logo:bt,logoImageWrapper:Et,imageOverlay:It,cameraIconWrapper:Tt,cameraIcon:Rt,relativeContainer:zt,absoluteOverlay:$t,container:At,truncatedText:Nt,titleContainer:Pt,surveyLink:Lt,nameIcon:Ft,descriptionContainer:kt,descriptionIcon:wt,photoIcon:Mt};function G(t,s){const n=s||"DD MMM YYYY";return t?Ye(t).format(n):""}var se={},Ot=X;Object.defineProperty(se,"__esModule",{value:!0});var Se=se.default=void 0,Ut=Ot(Q()),Bt=e,Wt=(0,Ut.default)((0,Bt.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"}),"FormatQuote");Se=se.default=Wt;var ne={},Vt=X;Object.defineProperty(ne,"__esModule",{value:!0});var ye=ne.default=void 0,Ht=Vt(Q()),Gt=e,qt=(0,Ht.default)((0,Gt.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");ye=ne.default=qt;var re={},Yt=X;Object.defineProperty(re,"__esModule",{value:!0});var Ce=re.default=void 0,Xt=Yt(Q()),Qt=e,Kt=(0,Xt.default)((0,Qt.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"}),"Shield");Ce=re.default=Kt;var oe={},Jt=X;Object.defineProperty(oe,"__esModule",{value:!0});var ie=oe.default=void 0,Zt=Jt(Q()),ea=e,ta=(0,Zt.default)((0,ea.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");ie=oe.default=ta;const o={DRAFT:"draft",CLOSED:"closed",ACTIVE:"active",EXPIRED:"expired",SCHEDULED:"scheduled"},aa=t=>{switch(t.status){case"draft":return o.DRAFT;case"closed":return o.CLOSED;case"active":return t.endDate&&pe(t.endDate)<Date.now()?o.EXPIRED:t.startDate&&pe(t.startDate)>Date.now()?o.SCHEDULED:o.ACTIVE;default:return o.DRAFT}},sa=t=>{switch(t){case o.DRAFT:return"#e9db3e";case o.CLOSED:return"#d32f2f";case o.EXPIRED:return"#9d4435";case o.SCHEDULED:return"#607d8b";case o.ACTIVE:return"#669834";default:return}},na=({survey:t,onSave:s,isEditable:n=!0})=>{const[x,m]=r.useState(!1),[_,c]=r.useState(t.name),i=y=>{c(y.target.value)},u=()=>{_.trim()===""?c(t.name):_!==t.name&&s(_,()=>c(t.name)),m(!1)},g=y=>{y.stopPropagation(),m(!0)};return e.jsx(h,{className:l.titleContainer,children:x?e.jsx(fe,{sx:{px:3,flexGrow:1},value:_,onChange:i,onBlur:u,autoFocus:!0,variant:"standard",fullWidth:!0,InputProps:{style:{color:"white"}}}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{component:t.status!=="closed"?xe:void 0,href:t.example?"/guest/preview/".concat(t.id):"/design-survey/".concat(t.id),color:"inherit",className:l.surveyLink,children:e.jsx(E,{variant:"h4",sx:{px:3},noWrap:!0,children:ae(_,16)})}),n&&e.jsx(k,{className:l.nameIcon,onClick:g,sx:{ml:1},children:e.jsx(ie,{sx:{color:"white"}})})]})})},ra=({survey:t,onSave:s})=>{const[n,x]=r.useState(!1),[m,_]=r.useState(t.description),c=g=>{_(g.target.value)},i=()=>{m!==t.description&&s(m,()=>_(t.description)),x(!1)},u=g=>{g.stopPropagation(),x(!0)};return e.jsx(h,{className:l.descriptionContainer,children:n?e.jsx(fe,{sx:{px:3},value:m,onChange:c,onBlur:i,autoFocus:!0,variant:"standard",fullWidth:!0,multiline:!0,rows:3}):e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"caption",sx:{px:3,color:m?"inherit":"gray",flexGrow:1},className:l.truncatedText,children:ae(m,125)||"Click to add a description..."}),e.jsx(k,{className:"".concat(l.descriptionIcon),onClick:u,sx:{ml:1},children:e.jsx(ie,{sx:{color:"gray"}})})]})})},je=({survey:t,example:s=!1,onClone:n,onDelete:x,onClose:m,onUpdateTitle:_,onUpdateDescription:c,onUpdateImage:i})=>{const{t:u}=K("manage"),g=aa(t),y=q("survey"),z=q("design"),[f,C]=r.useState(!1),[T,w]=r.useState(null),M=Pe(),$=te(),J=(d,D)=>{$(S(!0)),y.putSurvey({name:d},t.id).then(()=>{_(t.id,d)}).catch(R=>{R.name==Y.DUPLICATE_SURVEY_NAME.name&&(w(u("processed_errors.".concat(R.name))),C(!0),D())}).finally(()=>{$(S(!1))})},A=d=>{$(S(!0)),y.putSurvey({description:d},t.id).then(()=>{c(t.id,d)}).catch(D=>{}).finally(()=>{$(S(!1))})},j=()=>{C(!1)},O=d=>{const D=d.target.files[0],R=D.name,U=new FileReader;U.onload=()=>{const B=z.uploadResource(D,t.id),W=y.putSurvey({image:R},t.id);Promise.all([B,W]).then(([V,Z])=>{i(t.id,R)}).catch(V=>{w(u("processed_errors.".concat(processedError.name))),C(!0)}).finally(()=>{$(S(!1))})},U.readAsDataURL(D)};return e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsx(Oe,{open:f,autoHideDuration:6e3,onClose:j,children:e.jsx(Ue,{onClose:j,severity:"error",children:T})}),e.jsxs(ve,{sx:{"&:hover":{boxShadow:d=>d.customShadows.z24}},children:[e.jsxs(F,{sx:{pb:0},children:[e.jsxs(F,{spacing:.5,sx:{mb:1},children:[e.jsxs(h,{className:l.relativeContainer,children:[e.jsx(h,{className:l.absoluteOverlay,children:H()&&!s?e.jsx(na,{survey:t,onSave:J}):e.jsx(ge,{component:t.status!=="closed"?xe:void 0,href:s?"/guest/preview/".concat(t.id):"/design-survey/".concat(t.id),sx:{px:3},color:"inherit",children:e.jsx(E,{display:"contents",variant:"h4",line:1,children:t.name})})}),e.jsxs(h,{className:l.logo,children:[e.jsxs(h,{className:"".concat(l.logoImageWrapper),onClick:d=>{d.stopPropagation();const D=t.example?"/guest/preview/".concat(t.id):"/design-survey/".concat(t.id);M(D)},children:[e.jsx(Ke,{component:"img",image:t.image?Qe(t.image,t.id):"/qlarr.png",height:"150"}),e.jsx(h,{className:l.imageOverlay}),H()&&!t.example&&e.jsx(h,{className:l.photoIcon,onClick:d=>{d.stopPropagation(),document.getElementById("imageInput-".concat(t.id)).click()},children:e.jsx(Je,{className:l.cameraIcon})})]}),e.jsx("input",{id:"imageInput-".concat(t.id),type:"file",accept:"image/*",style:{display:"none"},onChange:O})]})]}),H()&&!s?e.jsx(ra,{survey:t,onSave:A}):e.jsx(E,{variant:"caption",sx:{px:3,color:t.description?"inherit":"gray"},className:l.truncatedText,children:ae(t.description,125)}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs(F,{direction:"row",alignItems:"center",spacing:.5,sx:{px:3,typography:"body2",color:"text.secondary"},children:[e.jsx("span",{style:{backgroundColor:sa(g)},className:l.badge})," ",e.jsx(E,{variant:"subtitle2",className:l.textTransform,children:u("status.".concat(g))})]}),e.jsxs(h,{sx:{px:3,display:"flex",gap:2},children:[!s&&e.jsx(e.Fragment,{children:e.jsx(N,{title:t.publicWithinOrg?"Public":"Private",children:e.jsx(Ce,{sx:{color:"text.secondary"}})})}),!s&&t.status!=="closed"&&t.latestVersion.published===!1&&e.jsx(N,{title:"Has unpublished changes",children:e.jsx(ye,{sx:{color:"text.secondary"}})}),e.jsx(N,{title:"Complete Responses: ".concat(t.completeResponseCount),children:e.jsx(Be,{sx:{color:"text.secondary"}})}),e.jsx(N,{title:t.surveyQuota>0?"Quota: ".concat(t.surveyQuota):"No Quota",children:e.jsx(Se,{sx:{color:"text.secondary"}})})]})]})]}),e.jsxs(E,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:"Created"}),": ",G(t.creationDate)]}),e.jsxs(E,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:"Last Modified"}),": ",G(t.lastModified)]}),!s&&t.startDate&&e.jsxs(E,{variant:"caption",sx:{px:3,color:"text.disabled"},children:[e.jsx("strong",{children:"Start Date"}),": ",G(t.startDate)]}),!s&&t.endDate&&e.jsxs(E,{variant:"caption",sx:{color:"text.disabled"},children:[e.jsx("strong",{children:"End Date"}),": ",G(t.endDate)]})]}),H()?e.jsxs(e.Fragment,{children:[e.jsx(et,{sx:{borderStyle:"dashed",my:2}}),e.jsxs(F,{sx:{p:3,pt:0,typography:"body2",color:"text.secondary",textTransform:"capitalize"},className:l.surveyActions,children:[!s&&t.status==="active"&&e.jsx(N,{title:u("edit_survey.close_title"),children:e.jsx(k,{className:l.iconButton,"aria-label":"stop",size:"large",onClick:()=>m(t.id),children:e.jsx(ot,{color:"primary"})})}),e.jsx(N,{title:u("edit_survey.clone_survey"),children:e.jsx(k,{className:l.iconButton,"aria-label":"clone",size:"large",onClick:n,children:e.jsx(We,{color:"primary"})})}),!s&&t.status!==o.ACTIVE&&e.jsx(N,{title:u("action_btn.delete"),children:e.jsx(k,{className:l.iconButton,"aria-label":"delete",size:"large",onClick:()=>x(t.id),children:e.jsx(Xe,{color:"primary"})})})]})]}):e.jsx("div",{style:{height:"12px"}})]})]})},oa=({sort:t,filter:s,onFilterSelected:n,onSortSelected:x})=>{const m=[{value:"responses_desc",label:"survey_sort_options.responses_desc"},{value:"last_modified_desc",label:"survey_sort_options.last_modified_desc"}],_=[{value:"all",label:"status.all"},{value:o.ACTIVE,label:"status.".concat(o.ACTIVE)},{value:o.SCHEDULED,label:"status.".concat(o.SCHEDULED)},{value:o.DRAFT,label:"status.".concat(o.DRAFT)},{value:o.EXPIRED,label:"status.".concat(o.EXPIRED)},{value:o.CLOSED,label:"status.".concat(o.CLOSED)}],{t:c}=K("manage");return e.jsxs(h,{rowGap:2.5,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(E,{variant:"h5",flex:"1",textTransform:"uppercase",fontWeight:"600",children:c("my_surveys")}),e.jsxs(F,{width:"100%",spacing:2.5,direction:{xs:"column",md:"row"},alignItems:"center",children:[e.jsx(ee,{onChange:x,native:!0,value:t,name:"Status",label:c("label.sort_by"),children:m.map(i=>e.jsx("option",{value:i.value,children:c(i.label)},i.value))}),e.jsx(ee,{onChange:n,native:!0,value:s,name:"Status",label:c("edit_survey.status"),children:_.map(i=>e.jsx("option",{value:i.value,children:c(i.label)},i.value))})]})]})},ia="_sliderContainer_1ra03_1",la="_sliderStyle_1ra03_7",ca="_surveyName_1ra03_11",da="_cardContent_1ra03_16",ua="_cardLink_1ra03_26",pa="_nextArrow_1ra03_42",ma="_backArrow_1ra03_49",_a={sliderContainer:ia,sliderStyle:la,surveyName:ca,cardContent:da,cardLink:ua,nextArrow:pa,backArrow:ma},ha=({surveys:t,onClone:s})=>e.jsxs(h,{className:_a.sliderContainer,children:[e.jsx(E,{variant:"h5",marginBottom:2,fontWeight:600,color:"#181735",children:"Surveys Forms"}),e.jsx("div",{style:{width:"100%",overflow:"auto",display:"flex",gap:"40px"},children:t.map((n,x)=>e.jsx(h,{sx:{minWidth:"21rem",margin:"1rem 0rem"},children:e.jsx(je,{survey:n,onClone:()=>s(n),example:!0},n.id)},x))})]}),xa="_createUserCard_zrfc2_1",va="_formGroup_zrfc2_9",ga="_rightContainer_zrfc2_16",fa="_createButton_zrfc2_24",Sa="_surveyNameInput_zrfc2_39",ya="_selectInput_zrfc2_55",Ca="_errorText_zrfc2_63",ja={createUserCard:xa,formGroup:va,rightContainer:ga,createButton:fa,surveyNameInput:Sa,selectInput:ya,errorText:Ca},Da=[{value:P.WEB,label:"mode.".concat(P.WEB)},{value:P.OFFLINE,label:"mode.".concat(P.OFFLINE)},{value:P.MIXED,label:"mode.".concat(P.MIXED)}];function ba({onSurveyCreated:t}){const s=q("survey"),{t:n}=K("manage"),x=te(),m={surveyName:"",surveyMode:P.MIXED,surveyActiveFrom:"",surveyActiveTo:""},_=tt().shape({surveyName:at().required(n("survey_required")).max(50,n("survey_too_long"))}),c=Ve({resolver:st(_),defaultValues:m}),{setError:i,reset:u,handleSubmit:g,formState:{isSubmitting:y}}=c,z=g(async f=>{x(S(!0));const C={name:f.surveyName,usage:f.surveyMode};f.surveyActiveFrom&&(C.startDate=me(surveyActiveFrom)),f.surveyActiveTo&&(C.endDate=me(surveyActiveTo)),s.createSurvey(C).then(()=>{t&&(t(),u())}).catch(T=>{T.name==Y.DUPLICATE_SURVEY_NAME.name?i("surveyName",{type:"manual",message:n("processed_errors.".concat(T.name))}):T.name==Y.INVALID_SURVEY_DATES.name&&i("surveyActiveFrom",{type:"manual",message:n("processed_errors.".concat(T.name))})}).finally(()=>{x(S(!1))})});return e.jsx(ve,{className:ja.createUserCard,children:e.jsx(He,{methods:c,onSubmit:z,children:e.jsxs(h,{rowGap:2.5,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(3, 1fr)"},children:[e.jsx(Ge,{name:"surveyName",label:n("label.survey_name")}),e.jsx(ee,{name:"surveyMode",label:n("label.survey_mode"),children:Da.map(f=>e.jsx("option",{value:f.value,children:n(f.label)},f.value))}),e.jsx(nt,{fullWidth:!0,size:"large",color:"primary",type:"submit",variant:"contained",loading:y,children:n("action_btn.create")})]})})})}function Ka(){var ue;const t=q("survey"),[s,n]=r.useState(null),[x,m]=r.useState([]),[_,c]=r.useState(!0),[i,u]=r.useState(1),[g,y]=r.useState(5),[z,f]=r.useState("all"),[C,T]=r.useState("last_modified_desc"),[w,M]=r.useState(!1),[$,J]=r.useState(),A=te(),{t:j}=K("manage"),O=a=>{c(!1)},d=()=>{t.getAllSurveys(i,g,z,C).then(a=>{a&&(c(!1),n(a))}).catch(a=>O())};r.useEffect(()=>{d()},[i,g,C,z]),r.useEffect(()=>{t.getGuestsSurveys().then(a=>{if(a){const p=a.map(v=>({...v,example:!0}));m(p)}}).catch(a=>O())},[]);const D=(a,p)=>{n(v=>({...v,surveys:v.surveys.map(I=>I.id===a?{...I,status:p}:I)}))},R=()=>{const a=we.getUser().roles;return a.indexOf(_e.SUPER_ADMIN)>-1||a.indexOf(_e.SURVEY_ADMIN)>-1},[U,B]=r.useState(""),[W,V]=r.useState(""),[Z,le]=r.useState(null),[De,L]=r.useState(!1),[be,ce]=r.useState(j("action_btn.delete")),Ee=a=>{V("delete"),ce(j("action_btn.delete")),le(a),B(j("edit_survey.delete_survey",{survey_name:a.name})),L(!0)},Ie=a=>{V("close"),ce(j("action_btn.close")),le(a),B(j("edit_survey.close_survey",{survey_name:a.name})),L(!0)},Te=()=>{W==="delete"?(Re(Z.id),L(!1)):W==="close"&&(ze(Z.id),L(!1))},de=a=>{J(a),M(!0)},Re=a=>{A(S(!0)),t.deleteSurvey(a).then(()=>{d()}).catch(p=>{A(S(!1))}).finally(()=>{A(S(!1))})},ze=a=>{A(S(!0)),t.closeSurvey(a).then(p=>{D(a,"closed")}).catch(p=>{p.name==Y.INVALID_SURVEY_DATES.name&&setSurveyDateError(j("processed_errors.".concat(processed.name)))}).finally(()=>{A(S(!1))})},$e=(a,p)=>{n(v=>{const I=v.surveys.map(b=>b.id===a?{...b,name:p}:b);return{...v,surveys:I}})},Ae=(a,p)=>{n(v=>{const I=v.surveys.map(b=>b.id===a?{...b,description:p}:b);return{...v,surveys:I}})},Ne=(a,p)=>{n(v=>{const I=v.surveys.map(b=>b.id===a?{...b,image:p}:b);return{...v,surveys:I}})};return e.jsxs(h,{className:he.mainContainer,children:[e.jsxs(ke,{children:[e.jsxs(h,{className:he.content,children:[R()&&e.jsx(ba,{onSurveyCreated:d}),e.jsx(oa,{filter:z,onFilterSelected:a=>{u(1),f(a.target.value)},sort:C,onSortSelected:a=>{u(1),T(a.target.value)}}),_?e.jsx(Le,{}):e.jsx(h,{sx:{mt:3,columnGap:4,display:"grid",rowGap:{xs:4,md:5},gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}},children:(ue=s==null?void 0:s.surveys)==null?void 0:ue.map(a=>e.jsx(je,{survey:a,onStatusChange:D,onClone:()=>de(a),onDelete:()=>Ee(a),onClose:()=>Ie(a),onUpdateTitle:$e,onUpdateDescription:Ae,onUpdateImage:Ne},a.id))}),s&&e.jsx(rt,{rowsPerPageOptions:[5,10,20,50],component:"div",labelDisplayedRows:({from:a,to:p,count:v,page:I})=>j("responses.label_displayed_rows",{from:a,to:p,count:v}),labelRowsPerPage:j("responses.label_surveys_per_page"),count:s==null?void 0:s.totalCount,rowsPerPage:g,page:i-1,onPageChange:(a,p)=>{u(p+1)},onRowsPerPageChange:a=>{y(parseInt(a.target.value,10)),u(1)}})]}),R()&&e.jsx(ha,{surveys:x,onClone:a=>de(a)})]}),e.jsx(qe,{open:w,onClose:a=>{M(!1),a&&d()},survey:$}),e.jsx(Ze,{open:De,description:U,handleClose:()=>L(!1),handleDelete:Te,title:be})]})}export{Ka as default};
