import{j as e,q as ee,B as j,p as R,w as te,R as se,r as x,u as ne,z as ae,L as oe}from"./index-BdaHkdQl.js";import{d as re}from"./Delete-Dife5L9n.js";import{d as ie,x as le,y as K,T as D,an as L,A as ce,D as de,aL as pe,I as N,aK as ue,ax as fe}from"./use-service-D09swmN7.js";import{f as U,s as z}from"./DateUtils-Ce4EpQzP.js";import{j as me,P as V}from"./TextField-B66jFwFo.js";import{p as he,T as xe}from"./Web-Xt-AHKsA.js";import{T as je,a as M}from"./Tabs-CXy611xA.js";import{T as ve,a as ge,b as q,c as we}from"./TableRow-XbFzsXVn.js";import{T as _e}from"./TableHead-CYTlZN0Y.js";import{T as i}from"./TableCell-CNVjjGNS.js";import{T as be}from"./TablePagination-D9rs5b3W.js";import"./useFormControl-BousA45m.js";import"./Checkbox-0qy6A3Vu.js";import"./SwitchBase-outpB1OY.js";import"./radioClasses-DNdhtY0L.js";import"./tableRowClasses-D2zlaSzG.js";import"./FormControlLabel-DrGXXvQK.js";const ye=ie(e.jsx("path",{d:"M6 6v2h8.59L5 17.59 6.41 19 16 9.41V18h2V6z"}),"ArrowOutward");var W={},Te=ee;Object.defineProperty(W,"__esModule",{value:!0});var $=W.default=void 0,Ce=Te(le()),Re=e,Ee=(0,Ce.default)((0,Re.jsx)("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}),"Event");$=W.default=Ee;const Se="_mainContainer_14aat_1",De="_loadingWrapper_14aat_12",Le="_cardContent_14aat_19",S={mainContainer:Se,loadingWrapper:De,cardContent:Le},Oe="_wrapper_5jjwg_1",Pe="_action_5jjwg_13",ke="_separator_5jjwg_20",A={wrapper:Oe,action:Pe,separator:ke},Me=({open:C,onClose:w,onDelete:r})=>{const{t:u}=K("manage");return e.jsx(me,{sx:{".MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0.3)"}},open:C,onClose:w,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(j,{className:A.wrapper,children:[e.jsx(D,{variant:"h5",fontWeight:600,children:u("responses.title_delete_response")}),e.jsx(j,{className:A.separator}),e.jsxs(j,{className:A.action,children:[e.jsx(L,{variant:"contained",onClick:r,children:u("action_btn.delete")}),e.jsx(L,{onClick:w,children:u("action_btn.cancel")})]})]})})};var G={exports:{}};(function(C,w){(function(r,u){u()})(R,function(){function r(t,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\uFEFF",t],{type:t.type}):t}function u(t,n,l){var a=new XMLHttpRequest;a.open("GET",t),a.responseType="blob",a.onload=function(){b(a.response,n,l)},a.onerror=function(){console.error("could not download file")},a.send()}function m(t){var n=new XMLHttpRequest;n.open("HEAD",t,!1);try{n.send()}catch(l){}return 200<=n.status&&299>=n.status}function h(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(l){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof R=="object"&&R.global===R?R:void 0,_=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),b=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!_?function(t,n,l){var a=d.URL||d.webkitURL,c=document.createElement("a");n=n||t.name||"download",c.download=n,c.rel="noopener",typeof t=="string"?(c.href=t,c.origin===location.origin?h(c):m(c.href)?u(t,n,l):h(c,c.target="_blank")):(c.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(c.href)},4e4),setTimeout(function(){h(c)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,l){if(n=n||t.name||"download",typeof t!="string")navigator.msSaveOrOpenBlob(r(t,l),n);else if(m(t))u(t,n,l);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout(function(){h(a)})}}:function(t,n,l,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof t=="string")return u(t,n,l);var c=t.type==="application/octet-stream",p=/constructor/i.test(d.HTMLElement)||d.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||c&&p||_)&&typeof FileReader<"u"){var f=new FileReader;f.onloadend=function(){var T=f.result;T=E?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=T:location=T,a=null},f.readAsDataURL(t)}else{var y=d.URL||d.webkitURL,v=y.createObjectURL(t);a?a.location=v:location.href=v,a=null,setTimeout(function(){y.revokeObjectURL(v)},4e4)}});d.saveAs=b.saveAs=b,C.exports=b})})(G);var Ae=G.exports;const We=te(Ae);function He({viewEvents:C}){const w=ce("survey"),{t:r}=K("manage"),[u,m]=x.useState(!0);de();const[h,d]=x.useState(!1),[_,b]=x.useState("none"),[t,n]=x.useState(null),{surveyId:l}=ne(),a=s=>{m(!1)},c=Intl.DateTimeFormat().resolvedOptions().timeZone,[p,E]=x.useState(null),[f,y]=x.useState(1),[v,T]=x.useState(10),X=()=>{m(!0),w.exportResponses(l,c,h,_).then(s=>{if(s){var o=new File([s],"".concat(l,"-responses-export.csv"),{type:"text/csv;charset=utf-8"});We.saveAs(o)}m(!1)}).catch(s=>{a()})},J=s=>{b("none"),n(s.surveyorID)},Z=s=>{switch(s){case"true":return!0;case"false":return!1;case"none":default:return}},H=(s=!1)=>{m(!0);const o=Z(_);w.allResponse(l,h,f,v,o,t).then(g=>{if(g){const I=g.totalCount,k=Math.ceil(I/v),Y=f>k?k:f;s&&f>k&&y(Y+1),E(g)}m(!1)}).catch(g=>{a(),m(!1)})};x.useEffect(()=>{H()},[f,v,h,_,t]);const[O,B]=x.useState(),F=()=>{B(null)},Q=()=>{F(),w.deleteResponse(l,O.id).then(()=>{H(!0)}).catch(s=>{a()})},P={SHOW_ALL:"none",SHOW_COMPLETED:"true",SHOW_INCOMPLETE:"false"};return e.jsxs(j,{className:S.mainContainer,children:[e.jsxs(j,{display:"flex",flexWrap:{xs:"wrap",sm:"wrap",md:"nowrap"},gap:10,children:[e.jsxs(j,{width:"100%",className:S.cardContent,children:[e.jsx(D,{variant:"h5",color:"primary",fontWeight:600,children:r("responses.raw_values")}),e.jsx(he,{checked:h,onChange:s=>{d(s.target.checked)}})]}),e.jsxs(j,{width:"100%",className:S.cardContent,children:[e.jsx(D,{variant:"h5",color:"primary",fontWeight:600,children:r("responses.export")}),e.jsx(L,{sx:{minWidth:"50px"},color:"primary",disabled:t||!1,size:"small",variant:"contained",onClick:()=>X(),children:e.jsx(ye,{})})]})]}),e.jsxs(j,{display:"flex",alignItems:"center",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(D,{color:"primary",variant:"h4",fontWeight:600,sx:{width:"33%"},children:r("responses.filter_completed")}),e.jsxs(je,{sx:{width:"100%"},value:_,onChange:(s,o)=>{y(1),b(o)},textColor:"primary",indicatorColor:"primary",variant:"fullWidth",children:[e.jsx(M,{disabled:t||!1,label:r("responses.filter_completed_show_all"),value:P.SHOW_ALL}),e.jsx(M,{disabled:t||!1,label:r("responses.filter_completed_show_completed"),value:P.SHOW_COMPLETED}),e.jsx(M,{disabled:t||!1,label:r("responses.filter_completed_show_incomplete"),value:P.SHOW_INCOMPLETE})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(L,{sx:{margin:"8px"},onClick:()=>n(null),children:r("responses.reset_surveyor_filter")})]}),u?e.jsx("div",{className:S.loadingWrapper,children:e.jsx(ae,{})}):e.jsxs(V,{sx:{width:"100%",background:"transparent",mb:2},children:[e.jsx(ve,{component:V,children:e.jsxs(ge,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(_e,{children:p&&e.jsxs(q,{children:[e.jsx(i,{},"btns"),e.jsx(i,{align:"left",children:"ID"},"id"),e.jsx(i,{align:"left",children:r("label.surveyor")},"surveyor"),e.jsx(i,{align:"left",children:r("responses.ip_addr")},"ip"),e.jsx(i,{align:"left",children:r("responses.start_date")},"start_date"),e.jsx(i,{align:"left",children:r("responses.submit_date")},"submit_date"),e.jsx(i,{align:"left",children:r("responses.lang")},"lang"),Object.values(p==null?void 0:p.columnNames).map(s=>e.jsx(i,{align:"left",children:pe(s)},s))]})}),e.jsx(we,{children:p==null?void 0:p.responses.map(s=>e.jsxs(q,{sx:{minHeight:"100px"},children:[e.jsx(i,{align:"left",children:e.jsxs(j,{sx:{display:"flex"},children:[e.jsx(N,{onClick:()=>{B(s)},children:e.jsx(re,{})}),s.hasEvents&&e.jsx(N,{onClick:()=>C(s.id),children:e.jsx($,{})})]})},"btns"),e.jsx(i,{align:"left",children:s.id},"id"),e.jsx(i,{align:"left",children:s.surveyorName?e.jsx(oe,{onClick:()=>{J(s)},children:s.surveyorName}):""},"surveyor"),e.jsx(i,{align:"left",children:s.ipAddress},"ip"),e.jsx(i,{align:"left",children:U(z(s.startDate))},"startDate"),e.jsx(i,{align:"left",children:s.submitDate?U(z(s.submitDate)):" - "},"submitDate"),e.jsx(i,{align:"left",children:s.lang},"lang"),s.values.map((o,g)=>e.jsx(i,{align:"left",children:o==null||o===""?" - ":typeof o=="string"?e.jsx(xe,{title:o,children:e.jsx("span",{children:ue(o,25)})}):typeof o=="object"&&"size"in o&&"filename"in o&&"stored_filename"in o?e.jsxs("a",{target:"_blank",download:o.stored_filename,href:fe(o.stored_filename),children:[o.filename," -",Math.round(o.size/1e3)+"K"]}):JSON.stringify(o)},g))]},s.id))})]})}),e.jsx(be,{rowsPerPageOptions:[10,25,50,100],component:"div",labelDisplayedRows:({from:s,to:o,count:g,page:I})=>r("responses.label_displayed_rows",{from:s,to:o,count:g}),labelRowsPerPage:r("responses.label_rows_per_page"),count:p==null?void 0:p.totalCount,rowsPerPage:v,page:f-1,onPageChange:(s,o)=>{y(o+1)},onRowsPerPageChange:s=>{T(parseInt(s.target.value,10)),y(1)}})]}),!!O&&e.jsx(Me,{onDelete:Q,open:!!O,onClose:F})]})}const tt=se.memo(He);export{tt as default};
