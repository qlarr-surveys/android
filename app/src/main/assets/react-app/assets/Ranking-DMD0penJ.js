import{r as D,a8 as B,m as C}from"./index-DNbeaJsE.js";import{af as N,ag as F,ah as P,ai as Y,aj as M,ak as L,al as z,am as K,an as $,M as G,K as y,L as x,a4 as _,O as I,ao as b,ap as J,R as Q}from"./Android-C8RkpF_s.js";let k=!1;class U{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;N(!k,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return k=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{k=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class V{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!F(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=P({dropTarget:(t,f)=>{this.clearDropTarget(),this.dropTargetOptions=f,Y(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function W(n){return D.useMemo(()=>n.hooks.dropTarget(),[n])}function X(n){const e=M(),t=D.useMemo(()=>new V(e.getBackend()),[e]);return L(()=>(t.dropTargetOptions=n||null,t.reconnect(),()=>t.disconnectDropTarget()),[n]),t}function Z(){const n=M();return D.useMemo(()=>new U(n),[n])}function ee(n){const{accept:e}=n;return D.useMemo(()=>(N(n.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class te{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function re(n,e){const t=D.useMemo(()=>new te(n,e),[e]);return D.useEffect(()=>{t.spec=n},[n]),t}function ne(n,e,t){const f=M(),d=re(n,e),o=ee(n);L(function(){const[u,c]=z(o,d,f);return e.receiveHandlerId(u),t.receiveHandlerId(u),c},[f,e,d,t,o.map(h=>h.toString()).join("|")])}function A(n,e){const t=K(n),f=Z(),d=X(t.options);return ne(t,f,d),[$(t.collect,f,d),W(d)]}const oe="_dragContainer_5yuyr_1",ie="_rankingItem_5yuyr_10",w={dragContainer:oe,rankingItem:ie};function ue(n){const e=G(),t=B(),f=n.lang,d=y(r=>n.component.answers.filter(i=>{var l,a;return(a=(l=r.runState.values[i.qualifiedCode])==null?void 0:l.relevance)!=null?a:!0}),x),o=y(r=>{let i={};return d.forEach(l=>{i[l.qualifiedCode]=r.runState.values[l.qualifiedCode].value}),i},x),h=r=>isNaN(o[r])?"unsorted":"sorted",u=y(r=>{let i={};return d.forEach(l=>{r.runState.order?i[l.qualifiedCode]=r.runState.order[l.qualifiedCode]:i[l.qualifiedCode]=r.runState.values[l.qualifiedCode].order+1}),i},x),c=d.filter(r=>!o[r.qualifiedCode]).sort(function(r,i){return u[r.qualifiedCode]-u[i.qualifiedCode]}),p=d.filter(r=>+o[r.qualifiedCode]>0).sort(function(r,i){return o[r.qualifiedCode]-o[i.qualifiedCode]}),O=(r,i,l)=>{const a={...u};if(l=="sorted"&&h(r.qualifiedCode)=="unsorted"){const g=i+1;for(let s in o)o.hasOwnProperty(s)&&o[s]>=g&&e(I({componentCode:s,value:o[s]+1}));e(I({componentCode:r.qualifiedCode,value:g})),r.index=i;const T=a[r.qualifiedCode];c.forEach(s=>{a[s.qualifiedCode]>=T&&(a[s.qualifiedCode]=a[s.qualifiedCode]-1)}),e(b(a))}else if(l=="unsorted"&&h(r.qualifiedCode)=="sorted"){const g=o[r.qualifiedCode];for(let s in o)o.hasOwnProperty(s)&&o[s]>=g&&e(I({componentCode:s,value:o[s]-1}));e(I({componentCode:r.qualifiedCode,value:void 0})),r.index=i;const T=i+1;c.forEach(s=>{a[s.qualifiedCode]>=T&&(a[s.qualifiedCode]=a[s.qualifiedCode]+1)}),a[r.qualifiedCode]=T,e(b(a))}},q=r=>{h(r.qualifiedCode)=="unsorted"?O(r,p.length,"sorted"):O(r,c.length,"unsorted")},v=(r,i,l,a)=>{const g={...u};if(l=="unsorted"&&h(r.qualifiedCode)=="unsorted"){const T=g[r.qualifiedCode];g[r.qualifiedCode]=g[i.qualifiedCode],g[i.qualifiedCode]=T,e(b(g)),r.index=a}else l=="sorted"&&h(r.qualifiedCode)=="sorted"&&(e(I({componentCode:r.qualifiedCode,value:o[i.qualifiedCode]})),e(I({componentCode:i.qualifiedCode,value:o[r.qualifiedCode]})),r.index=a)};return C.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[C.jsx(H,{styles:w,lang:f,theme:t,ordererLength:p.length,unordererLength:c.length,onHover:v,order:u,onItemTransfer:O,onDoubleClick:q,itemType:"unsorted",options:c}),C.jsx(H,{styles:w,lang:f,theme:t,onHover:v,onItemTransfer:O,onDoubleClick:q,ordererLength:p.length,unordererLength:c.length,order:u,itemType:"sorted",options:p})]})}function H({styles:n,itemType:e,lang:t,theme:f,options:d,onItemTransfer:o,onDoubleClick:h,onHover:u}){const c=D.useRef(null);return C.jsxs(_,{ref:c,className:n.dragContainer,sx:{backgroundColor:"background.default"},children:[d.map((p,O)=>C.jsxs(D.Fragment,{children:[C.jsx(E,{itemType:e,index:O,onItemTransfer:o},"drop"+p.code),C.jsx(ae,{lang:t,theme:f,index:O,onHover:u,itemType:e,option:p,rankingItemStyle:n.rankingItem,onDoubleClick:h},p.code)]},p.code)),C.jsx(E,{itemType:e,index:d.length,fillParent:!0,onItemTransfer:o},"last")]})}function ae({lang:n,theme:e,option:t,onDoubleClick:f,rankingItemStyle:d,index:o,onHover:h,itemType:u}){var l;const c=D.useRef(),p={index:o,qualifiedCode:t.qualifiedCode},[O,q,v]=J({type:"rankingOption",item:p,collect:a=>{var g;return((g=a.getItem())==null?void 0:g.qualifiedCode)===t.qualifiedCode}}),[{handlerId:r},i]=A({accept:"rankingOption",collect(a){return{handlerId:a.getHandlerId()}},hover(a,g){var j;if(!c.current||!g.isOver({shallow:!0})||!a)return;const T=a.index,s=o;if(T===s)return;const m=(j=c.current)==null?void 0:j.getBoundingClientRect(),R=(m.bottom-m.top)/2,S=g.getClientOffset().y-m.top;T<s&&S<R||T>s&&S>R||h(a,t,u,o)}});return i(v(c)),C.jsx("div",{ref:q,children:C.jsx(_,{ref:c,"data-handler-id":r,style:{opacity:O?"0.2":"1"},onDoubleClick:()=>f(p),className:d,sx:{backgroundColor:"background.paper"},children:C.jsx(Q,{elementCode:t.code,fontFamily:e.textStyles.text.font,color:e.textStyles.text.color,fontSize:e.textStyles.text.size,name:"label",lang:n,content:(l=t.content)==null?void 0:l.label})})})}function E({index:n,onItemTransfer:e,itemType:t,fillParent:f}){const d=D.useRef(),[{handlerId:o},h]=A({accept:"rankingOption",collect(u){return{handlerId:u.getHandlerId()}},hover(u,c){!d.current||!c.isOver({shallow:!0})||!u||e(u,n,t)}});return h(d),C.jsx("div",{style:{flex:f?1:"inherit",minHeight:"12px"},ref:d,"data-handler-id":o})}export{ue as default};
