import{r as T,m as C}from"./index-DVscfUVY.js";import{a9 as S,aa as B,ab as L,ac as A,ad as y,ae as E,af as F,ag as P,ah as Y,H as J,D as x,E as R,U as N,ai as U,J as D,aj as m}from"./Android-BY2ykiuN.js";let v=!1;class ${receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;S(!v,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return v=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{v=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}class z{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!B(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=L({dropTarget:(t,o)=>{this.clearDropTarget(),this.dropTargetOptions=o,A(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function G(n){return T.useMemo(()=>n.hooks.dropTarget(),[n])}function K(n){const e=y(),t=T.useMemo(()=>new z(e.getBackend()),[e]);return E(()=>(t.dropTargetOptions=n||null,t.reconnect(),()=>t.disconnectDropTarget()),[n]),t}function Q(){const n=y();return T.useMemo(()=>new $(n),[n])}function V(n){const{accept:e}=n;return T.useMemo(()=>(S(n.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class W{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function X(n,e){const t=T.useMemo(()=>new W(n,e),[e]);return T.useEffect(()=>{t.spec=n},[n]),t}function Z(n,e,t){const o=y(),a=X(n,e),g=V(n);E(function(){const[d,p]=F(g,a,o);return e.receiveHandlerId(d),t.receiveHandlerId(d),p},[o,e,a,t,g.map(u=>u.toString()).join("|")])}function _(n,e){const t=P(n),o=Q(),a=K(t.options);return Z(t,o,a),[Y(t.collect,o,a),G(a)]}const ee="_dragContainer_5yuyr_1",te="_rankingItem_5yuyr_10",w={dragContainer:ee,rankingItem:te};function ae(n){const e=J(),t=x(r=>{let i={};return n.component.answers.forEach(f=>{i[f.qualifiedCode]=r.runState.values[f.qualifiedCode].value}),i},R),o=r=>isNaN(t[r])?"unsorted":"sorted",a=x(r=>{let i={};return n.component.answers.forEach(f=>{r.runState.order?i[f.qualifiedCode]=r.runState.order[f.qualifiedCode]:i[f.qualifiedCode]=r.runState.values[f.qualifiedCode].order+1}),i},R),g=n.component.answers.filter(r=>!t[r.qualifiedCode]).sort(function(r,i){return a[r.qualifiedCode]-a[i.qualifiedCode]}),u=n.component.answers.filter(r=>+t[r.qualifiedCode]>0).sort(function(r,i){return t[r.qualifiedCode]-t[i.qualifiedCode]}),d=(r,i,f)=>{const c={...a};if(f=="sorted"&&o(r.qualifiedCode)=="unsorted"){const l=i+1;for(let s in t)t.hasOwnProperty(s)&&t[s]>=l&&e(D({componentCode:s,value:t[s]+1}));e(D({componentCode:r.qualifiedCode,value:l})),r.index=i;const h=c[r.qualifiedCode];g.forEach(s=>{c[s.qualifiedCode]>=h&&(c[s.qualifiedCode]=c[s.qualifiedCode]-1)}),e(m(c))}else if(f=="unsorted"&&o(r.qualifiedCode)=="sorted"){const l=t[r.qualifiedCode];for(let s in t)t.hasOwnProperty(s)&&t[s]>=l&&e(D({componentCode:s,value:t[s]-1}));e(D({componentCode:r.qualifiedCode,value:void 0})),r.index=i;const h=i+1;g.forEach(s=>{c[s.qualifiedCode]>=h&&(c[s.qualifiedCode]=c[s.qualifiedCode]+1)}),c[r.qualifiedCode]=h,e(m(c))}},p=r=>{o(r.qualifiedCode)=="unsorted"?d(r,u.length,"sorted"):d(r,g.length,"unsorted")},O=(r,i,f,c)=>{const l={...a};if(f=="unsorted"&&o(r.qualifiedCode)=="unsorted"){const h=l[r.qualifiedCode];l[r.qualifiedCode]=l[i.qualifiedCode],l[i.qualifiedCode]=h,e(m(l)),r.index=c}else f=="sorted"&&o(r.qualifiedCode)=="sorted"&&(e(D({componentCode:r.qualifiedCode,value:t[i.qualifiedCode]})),e(D({componentCode:i.qualifiedCode,value:t[r.qualifiedCode]})),r.index=c)};return C.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[C.jsx(H,{styles:w,ordererLength:u.length,unordererLength:g.length,onHover:O,order:a,onItemTransfer:d,onDoubleClick:p,itemType:"unsorted",options:g}),C.jsx(H,{styles:w,onHover:O,onItemTransfer:d,onDoubleClick:p,ordererLength:u.length,unordererLength:g.length,order:a,itemType:"sorted",options:u})]})}function H({styles:n,itemType:e,options:t,onItemTransfer:o,onDoubleClick:a,onHover:g}){const u=T.useRef(null);return C.jsxs(N,{ref:u,className:n.dragContainer,sx:{backgroundColor:"background.default"},children:[t.map((d,p)=>C.jsxs(T.Fragment,{children:[C.jsx(j,{itemType:e,index:p,onItemTransfer:o},"drop"+d.code),C.jsx(re,{index:p,onHover:g,itemType:e,option:d,rankingItemStyle:n.rankingItem,onDoubleClick:a},d.code)]},d.code)),C.jsx(j,{itemType:e,index:t.length,fillParent:!0,onItemTransfer:o},"last")]})}function re({option:n,onDoubleClick:e,rankingItemStyle:t,index:o,onHover:a,itemType:g}){var c;const u=T.useRef(),d={index:o,qualifiedCode:n.qualifiedCode},[p,O,r]=U({type:"rankingOption",item:d,collect:l=>{var h;return((h=l.getItem())==null?void 0:h.qualifiedCode)===n.qualifiedCode}}),[{handlerId:i},f]=_({accept:"rankingOption",collect(l){return{handlerId:l.getHandlerId()}},hover(l,h){var M;if(!u.current||!h.isOver({shallow:!0})||!l)return;const s=l.index,I=o;if(s===I)return;const q=(M=u.current)==null?void 0:M.getBoundingClientRect(),b=(q.bottom-q.top)/2,k=h.getClientOffset().y-q.top;s<I&&k<b||s>I&&k>b||a(l,n,g,o)}});return f(r(u)),C.jsx("div",{ref:O,children:C.jsx(N,{ref:u,"data-handler-id":i,style:{opacity:p?"0.2":"1"},onDoubleClick:()=>e(d),className:t,sx:{backgroundColor:"background.paper"},children:(c=n.content)==null?void 0:c.label})})}function j({index:n,onItemTransfer:e,itemType:t,fillParent:o}){const a=T.useRef(),[{handlerId:g},u]=_({accept:"rankingOption",collect(d){return{handlerId:d.getHandlerId()}},hover(d,p){!a.current||!p.isOver({shallow:!0})||!d||e(d,n,t)}});return u(a),C.jsx("div",{style:{flex:o?1:"inherit",minHeight:"12px"},ref:a,"data-handler-id":g})}export{ae as default};
