import{r as c,j as e,B as T,s as le}from"./index-BPkE25ts.js";import{c as ee,a as d,L as w,o as ae,d as ce,b as de}from"./yup-BOIU9D06.js";import{u as se,F as re,r as me,I as P,R as p,a as ue,A as he}from"./Web-BBqAH_aj.js";import{Q as W,aL as fe,aK as O,as as pe,T as h,aC as xe,H as _e,M as ge,J as Ne,R as we,Y as K,aM as Q,aJ as ve,I as q,W as Y}from"./use-service-Bb7LY6Q3.js";import{u as be}from"./use-boolean-C2KF0qPb.js";import{L as je}from"./Link-DZrEZT2W.js";import{S as Se}from"./index-BgMaChHB.js";import{I as D}from"./InputAdornment-BqPPlMsg.js";import"./Checkbox-Dntn-pZ4.js";import"./SwitchBase-CHSPGF-1.js";import"./Tabs-ui_O5_y9.js";import"./radioClasses-CjX8ViDh.js";import"./tableRowClasses-JqPlK2IC.js";import"./TextField-M1IR9KQb.js";import"./FormControlLabel-sZjcD-3I.js";const Ae="_mainContainer_1gv2g_1",Ee="_content_1gv2g_10",X={mainContainer:Ae,content:Ee},Ce="_verifyContainer_rwmnr_1",ye={verifyContainer:Ce};function Pe({t,open:x,email:v,resend:I,onClose:a}){const o=W("user"),[_,i]=c.useState(!1),b=ee().shape({pin:d().min(6,"".concat(t("email.code_characters"))).required("".concat(t("email.code_required")))}),j={pin:""},g=se({mode:"onChange",resolver:ae(b),defaultValues:j}),{handleSubmit:S,setError:A,reset:R}=g,E=S(async H=>{i(!0),o.confirmEmail(H).then(()=>{i(!1),a(!0),R(j)}).catch(L=>{i(!1),A("pin",{type:"manual",message:t("processed_errors.".concat(L.name))})})});return e.jsx(fe,{open:x,"aria-labelledby":"email-verification-modal","aria-describedby":"email-verification-modal-description",children:e.jsx(T,{className:ye.verifyContainer,children:e.jsxs(O,{sx:{textAlign:"center"},children:[e.jsx(pe,{alt:"email inbox",src:"/ic_email_inbox.svg",sx:{mb:5,width:96,height:96,mx:"auto"}}),e.jsx(h,{variant:"h3",children:t("email.check")}),e.jsxs(h,{variant:"body2",sx:{mt:2,mb:5,color:"text.secondary"},children:[t("email.confirmation_code1")," ",v," ",t("email.confirmation_code2")]}),e.jsxs(re,{methods:g,onSubmit:E,children:[e.jsx(me,{name:"pin"}),e.jsx(w,{fullWidth:!0,size:"large",color:"inherit",type:"submit",variant:"contained",loading:_,sx:{mt:3},children:t("email.verify")})]}),e.jsxs(h,{variant:"body2",align:"center",sx:{mt:3},children:[t("email.dont_have_code"),e.jsxs(je,{variant:"subtitle2",onClick:()=>I(),underline:"none",sx:{cursor:"pointer"},children:[" ",t("email.resend_code")]})]}),e.jsxs(xe,{onClick:()=>a(!1),color:"inherit",sx:{mt:3,mx:"auto",alignItems:"center",display:"inline-flex"},children:[e.jsx(P,{icon:"carbon:chevron-left",width:16,sx:{mr:1}}),t("action_btn.close")]})]})})})}const n={NONE:"",CHANGE_EMAIL:"CHANGE_EMAIL",CHANGE_PASSWORD:"CHANGE_PASSWORD"};function Ve(){const t=W("auth"),x=W("user"),v=le(),I=_e(s=>s.editState.loading),{t:a}=ge("manage"),o=be(),_=Ne.getUser().id,[i,b]=c.useState({}),[j,g]=c.useState(!1),[S,A]=c.useState(!1),[R,E]=c.useState(!1),[H,L]=c.useState(!1),[l,C]=c.useState(n.NONE),z=we(),M=()=>{E(!1)};ce(d,"noWhitespace",function(s){return this.test("no-whitespace",s,function(r){const{path:f,createError:y}=this;return r!=null&&r.trim()?!0:y({path:f,message:s})})});const $=s=>{let r={firstName:d().required(a("firstname_required")).noWhitespace(a("error.invalid_first_name")).max(50,a("error.first_name_too_long")).matches(/^[A-Za-z]+$/,a("error.invalid_first_name")),lastName:d().required(a("lastname_required")).noWhitespace(a("error.invalid_last_name")).max(50,a("error.last_name_too_long")).matches(/^[A-Za-z]+$/,a("error.invalid_last_name"))};return s===n.CHANGE_EMAIL&&(r={...r,currentPassword:d().required(a("password_required")),email:d().required(a("email_required")).matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/i,a("error.invalid_email"))}),s===n.CHANGE_PASSWORD&&(r={...r,currentPassword:d().required(a("password_required")).matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/,a("error.invalid_password")),newPassword:d().required(a("password_required")),confirmNewPassword:d().required(a("password_required")).oneOf([de("newPassword"),null],a("error.password_should_match"))}),ee().shape(r)},k=l===n.CHANGE_EMAIL||l===n.CHANGE_PASSWORD;let ie={firstName:"",lastName:"",email:"",currentPassword:"",newPassword:"",confirmNewPassword:""};const F=()=>{t.logout().then(()=>{v(Y.login)}).catch(s=>{v(Y.login)})},u=se({resolver:ae($(l)),defaultValues:ie}),{watch:ne,setError:V,reset:N,handleSubmit:te}=u,U=ne("email");c.useEffect(()=>{U!==i.email?(N({...u.getValues(),firstName:i.firstName,lastName:i.lastName}),A(!0)):A(!1)},[U,i.email,N,u]),c.useEffect(()=>{x.getUser({userId:_}).then(s=>{const r={firstName:s.firstName,lastName:s.lastName,email:s.email};b(s),N(r)})},[N,_]),c.useEffect(()=>{const s=$(l);u.reset({...u.getValues()},{errors:!0,schema:s})},[l,u]);const B=te(async s=>{const{firstName:r,lastName:f,email:y,newPassword:Z,currentPassword:J}=s,m={};i.firstName!==r&&(m.firstName=r),i.lastName!==f&&(m.lastName=f),i.email!==y&&(m.email=y),J!==""&&(m.password=J),Z!==""&&(m.newPassword=Z),z(K(!0)),x.updateUserProfile(m).then(()=>{m.email&&m.email!==i.email?g(!0):k?F():L(!0)}).catch(G=>{G.name==Q.DUPLICATE_EMAIL.name?V("email",{type:"manual",message:a("processed_errors.".concat(G.name))}):G.name==Q.WRONG_CREDENTIALS.name&&V("currentPassword",{type:"manual",message:a("error.incorrect_password")})}).finally(()=>{z(K(!1))})}),oe=s=>{g(!1),s&&(E(!0),setTimeout(()=>{F()},300)),C(n.NONE),x.getUser({userId:_}).then(r=>{const f={firstName:r.firstName,lastName:r.lastName,email:r.email};b(r),N(f)})};return e.jsx(T,{className:X.mainContainer,children:e.jsxs(ve,{className:X.content,children:[H&&e.jsx(Se,{success:"updated",left:"56"}),e.jsxs(re,{methods:u,onSubmit:B,children:[e.jsx(h,{variant:"h5",sx:{mb:3},children:"Personal"}),e.jsxs(T,{rowGap:2.5,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(p,{disabled:S,name:"firstName",label:a("label.first_name")}),e.jsx(p,{disabled:S,name:"lastName",label:a("label.last_name")}),e.jsx(p,{disabled:l!=n.CHANGE_EMAIL,name:"email",label:a("label.email")})]}),e.jsx(O,{spacing:3,sx:{my:5},children:e.jsxs(e.Fragment,{children:[l==n.CHANGE_PASSWORD&&e.jsxs("div",{children:[e.jsx(h,{variant:"h5",children:a("profile.change_password")}),e.jsx(h,{variant:"body2",sx:{color:"error.main",mb:1},children:a("profile.hint")})]}),l==n.CHANGE_EMAIL&&e.jsx(h,{variant:"body2",sx:{color:"error.main"},children:a("profile.hint")}),e.jsxs(O,{spacing:2.5,children:[k&&e.jsx(p,{name:"currentPassword",label:a("label.password"),type:o.value?"text":"password",InputProps:{endAdornment:e.jsx(D,{position:"end",children:e.jsx(q,{onClick:o.onToggle,edge:"end",children:e.jsx(P,{icon:o.value?"carbon:view":"carbon:view-off"})})})}}),l==n.CHANGE_PASSWORD&&e.jsxs(e.Fragment,{children:[e.jsx(p,{name:"newPassword",label:a("label.new_password"),type:o.value?"text":"password",InputProps:{endAdornment:e.jsx(D,{position:"end",children:e.jsx(q,{onClick:o.onToggle,edge:"end",children:e.jsx(P,{icon:o.value?"carbon:view":"carbon:view-off"})})})}}),e.jsx(p,{name:"confirmNewPassword",label:a("label.confirm_new_password"),type:o.value?"text":"password",InputProps:{endAdornment:e.jsx(D,{position:"end",children:e.jsx(q,{onClick:o.onToggle,edge:"end",children:e.jsx(P,{icon:o.value?"carbon:view":"carbon:view-off"})})})}})]})]})]})}),e.jsxs(O,{spacing:1,direction:"row",children:[l==n.NONE&&e.jsx(w,{color:"inherit",size:"large",variant:"contained",onClick:()=>C(n.CHANGE_EMAIL),children:a("profile.change_email")}),l==n.NONE&&e.jsx(w,{color:"inherit",size:"large",variant:"contained",onClick:()=>C(n.CHANGE_PASSWORD),children:a("profile.change_password")}),k&&e.jsx(w,{color:"inherit",size:"large",variant:"contained",onClick:()=>C(n.NONE),children:a("profile.cancel")}),e.jsx(w,{color:"inherit",size:"large",type:"submit",variant:"contained",loading:I,children:a("profile.save")})]})]}),e.jsx(Pe,{t:a,open:j,email:i==null?void 0:i.email,resend:B,onClose:oe}),e.jsx(ue,{open:R,autoHideDuration:6e3,onClose:M,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(he,{onClose:M,severity:"success",variant:"filled",sx:{width:"100%"},children:a("email.email_changed")})})]})})}export{Ve as default};
