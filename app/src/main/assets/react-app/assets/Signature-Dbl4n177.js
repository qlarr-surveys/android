import{N as K,a5 as Y,e as Q,r as S,m as M}from"./index-DCf9ET77.js";import{Z as tt,$ as et,E as V,J as nt,a0 as at,a1 as it,a2 as H,z as $,a3 as ot,L as rt}from"./Android-0LfW9AkK.js";var G={exports:{}};/*!
 * Signature Pad v2.3.2
 * https://github.com/szimek/signature_pad
 *
 * Copyright 2017 Szymon Nowak
 * Released under the MIT license
 *
 * The main idea and some parts of the code (e.g. drawing variable width Bézier curve) are taken from:
 * http://corner.squareup.com/2012/07/smoother-signatures.html
 *
 * Implementation of interpolation using cubic Bézier curves is taken from:
 * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
 *
 * Algorithm for approximated length of a Bézier curve is taken from:
 * http://www.lemoda.net/maths/bezier-length/index.html
 *
 */function O(t,a,n){this.x=t,this.y=a,this.time=n||new Date().getTime()}O.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1};O.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};O.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time};function F(t,a,n,e){this.startPoint=t,this.control1=a,this.control2=n,this.endPoint=e}F.prototype.length=function(){for(var t=10,a=0,n=void 0,e=void 0,i=0;i<=t;i+=1){var s=i/t,r=this._point(s,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),h=this._point(s,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(i>0){var d=r-n,o=h-e;a+=Math.sqrt(d*d+o*o)}n=r,e=h}return a};F.prototype._point=function(t,a,n,e,i){return a*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*e*(1-t)*t*t+i*t*t*t};function st(t,a,n){var e,i,s,r=null,h=0;n||(n={});var d=function(){h=n.leading===!1?0:Date.now(),r=null,s=t.apply(e,i),r||(e=i=null)};return function(){var o=Date.now();!h&&n.leading===!1&&(h=o);var c=a-(o-h);return e=this,i=arguments,c<=0||c>a?(r&&(clearTimeout(r),r=null),h=o,s=t.apply(e,i),r||(e=i=null)):!r&&n.trailing!==!1&&(r=setTimeout(d,c)),s}}function _(t,a){var n=this,e=a||{};this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.throttle?this._strokeMoveUpdate=st(_.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=_.prototype._strokeUpdate,this.dotSize=e.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.onBegin=e.onBegin,this.onEnd=e.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(i){i.which===1&&(n._mouseButtonDown=!0,n._strokeBegin(i))},this._handleMouseMove=function(i){n._mouseButtonDown&&n._strokeMoveUpdate(i)},this._handleMouseUp=function(i){i.which===1&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(i))},this._handleTouchStart=function(i){if(i.targetTouches.length===1){var s=i.changedTouches[0];n._strokeBegin(s)}},this._handleTouchMove=function(i){i.preventDefault();var s=i.targetTouches[0];n._strokeMoveUpdate(s)},this._handleTouchEnd=function(i){var s=i.target===n._canvas;s&&(i.preventDefault(),n._strokeEnd(i))},this.on()}_.prototype.clear=function(){var t=this._ctx,a=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,a.width,a.height),t.fillRect(0,0,a.width,a.height),this._data=[],this._reset(),this._isEmpty=!0};_.prototype.fromDataURL=function(t){var a=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=new Image,i=n.ratio||window.devicePixelRatio||1,s=n.width||this._canvas.width/i,r=n.height||this._canvas.height/i;this._reset(),e.src=t,e.onload=function(){a._ctx.drawImage(e,0,0,s,r)},this._isEmpty=!1};_.prototype.toDataURL=function(t){var a;switch(t){case"image/svg+xml":return this._toSVG();default:for(var n=arguments.length,e=Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return(a=this._canvas).toDataURL.apply(a,[t].concat(e))}};_.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()};_.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)};_.prototype.isEmpty=function(){return this._isEmpty};_.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),typeof this.onBegin=="function"&&this.onBegin(t)};_.prototype._strokeUpdate=function(t){var a=t.clientX,n=t.clientY,e=this._createPoint(a,n),i=this._data[this._data.length-1],s=i&&i[i.length-1],r=s&&e.distanceTo(s)<this.minDistance;if(!(s&&r)){var h=this._addPoint(e),d=h.curve,o=h.widths;d&&o&&this._drawCurve(d,o.start,o.end),this._data[this._data.length-1].push({x:e.x,y:e.y,time:e.time,color:this.penColor})}};_.prototype._strokeEnd=function(t){var a=this.points.length>2,n=this.points[0];if(!a&&n&&this._drawDot(n),n){var e=this._data[this._data.length-1],i=e[e.length-1];n.equals(i)||e.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}typeof this.onEnd=="function"&&this.onEnd(t)};_.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)};_.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)};_.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor};_.prototype._createPoint=function(t,a,n){var e=this._canvas.getBoundingClientRect();return new O(t-e.left,a-e.top,n||new Date().getTime())};_.prototype._addPoint=function(t){var a=this.points,n=void 0;if(a.push(t),a.length>2){a.length===3&&a.unshift(a[0]),n=this._calculateCurveControlPoints(a[0],a[1],a[2]);var e=n.c2;n=this._calculateCurveControlPoints(a[1],a[2],a[3]);var i=n.c1,s=new F(a[1],e,i,a[2]),r=this._calculateCurveWidths(s);return a.shift(),{curve:s,widths:r}}return{}};_.prototype._calculateCurveControlPoints=function(t,a,n){var e=t.x-a.x,i=t.y-a.y,s=a.x-n.x,r=a.y-n.y,h={x:(t.x+a.x)/2,y:(t.y+a.y)/2},d={x:(a.x+n.x)/2,y:(a.y+n.y)/2},o=Math.sqrt(e*e+i*i),c=Math.sqrt(s*s+r*r),f=h.x-d.x,p=h.y-d.y,g=c/(o+c),w={x:d.x+f*g,y:d.y+p*g},y=a.x-w.x,C=a.y-w.y;return{c1:new O(h.x+y,h.y+C),c2:new O(d.x+y,d.y+C)}};_.prototype._calculateCurveWidths=function(t){var a=t.startPoint,n=t.endPoint,e={start:null,end:null},i=this.velocityFilterWeight*n.velocityFrom(a)+(1-this.velocityFilterWeight)*this._lastVelocity,s=this._strokeWidth(i);return e.start=this._lastWidth,e.end=s,this._lastVelocity=i,this._lastWidth=s,e};_.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};_.prototype._drawPoint=function(t,a,n){var e=this._ctx;e.moveTo(t,a),e.arc(t,a,n,0,2*Math.PI,!1),this._isEmpty=!1};_.prototype._drawCurve=function(t,a,n){var e=this._ctx,i=n-a,s=Math.floor(t.length());e.beginPath();for(var r=0;r<s;r+=1){var h=r/s,d=h*h,o=d*h,c=1-h,f=c*c,p=f*c,g=p*t.startPoint.x;g+=3*f*h*t.control1.x,g+=3*c*d*t.control2.x,g+=o*t.endPoint.x;var w=p*t.startPoint.y;w+=3*f*h*t.control1.y,w+=3*c*d*t.control2.y,w+=o*t.endPoint.y;var y=a+o*i;this._drawPoint(g,w,y)}e.closePath(),e.fill()};_.prototype._drawDot=function(t){var a=this._ctx,n=typeof this.dotSize=="function"?this.dotSize():this.dotSize;a.beginPath(),this._drawPoint(t.x,t.y,n),a.closePath(),a.fill()};_.prototype._fromData=function(t,a,n){for(var e=0;e<t.length;e+=1){var i=t[e];if(i.length>1)for(var s=0;s<i.length;s+=1){var r=i[s],h=new O(r.x,r.y,r.time),d=r.color;if(s===0)this.penColor=d,this._reset(),this._addPoint(h);else if(s!==i.length-1){var o=this._addPoint(h),c=o.curve,f=o.widths;c&&f&&a(c,f,d)}}else{this._reset();var p=i[0];n(p)}}};_.prototype._toSVG=function(){var t=this,a=this._data,n=this._canvas,e=Math.max(window.devicePixelRatio||1,1),i=0,s=0,r=n.width/e,h=n.height/e,d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS(null,"width",n.width),d.setAttributeNS(null,"height",n.height),this._fromData(a,function(u,x,k){var D=document.createElement("path");if(!isNaN(u.control1.x)&&!isNaN(u.control1.y)&&!isNaN(u.control2.x)&&!isNaN(u.control2.y)){var R="M "+u.startPoint.x.toFixed(3)+","+u.startPoint.y.toFixed(3)+" "+("C "+u.control1.x.toFixed(3)+","+u.control1.y.toFixed(3)+" ")+(u.control2.x.toFixed(3)+","+u.control2.y.toFixed(3)+" ")+(u.endPoint.x.toFixed(3)+","+u.endPoint.y.toFixed(3));D.setAttribute("d",R),D.setAttribute("stroke-width",(x.end*2.25).toFixed(3)),D.setAttribute("stroke",k),D.setAttribute("fill","none"),D.setAttribute("stroke-linecap","round"),d.appendChild(D)}},function(u){var x=document.createElement("circle"),k=typeof t.dotSize=="function"?t.dotSize():t.dotSize;x.setAttribute("r",k),x.setAttribute("cx",u.x),x.setAttribute("cy",u.y),x.setAttribute("fill",u.color),d.appendChild(x)});var o="data:image/svg+xml;base64,",c='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'+(' viewBox="'+i+" "+s+" "+r+" "+h+'"')+(' width="'+r+'"')+(' height="'+h+'"')+">",f=d.innerHTML;if(f===void 0){var p=document.createElement("dummy"),g=d.childNodes;p.innerHTML="";for(var w=0;w<g.length;w+=1)p.appendChild(g[w].cloneNode(!0));f=p.innerHTML}var y="</svg>",C=c+f+y;return o+btoa(C)};_.prototype.fromData=function(t){var a=this;this.clear(),this._fromData(t,function(n,e){return a._drawCurve(n,e.start,e.end)},function(n){return a._drawDot(n)}),this._data=t};_.prototype.toData=function(){return this._data};const ut=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"})),ht=K(ut);var j={exports:{}},X;function ct(){return X||(X=1,function(t,a){(function(n,e){t.exports=e()})(Y,function(){return function(n){function e(s){if(i[s])return i[s].exports;var r=i[s]={exports:{},id:s,loaded:!1};return n[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=n,e.c=i,e.p="",e(0)}([function(n,e){function i(o){var c=o.getContext("2d"),f=o.width,p=o.height,g=c.getImageData(0,0,f,p).data,w=h(!0,f,p,g),y=h(!1,f,p,g),C=d(!0,f,p,g),u=d(!1,f,p,g),x=u-C+1,k=y-w+1,D=c.getImageData(C,w,x,k);return o.width=x,o.height=k,c.clearRect(0,0,x,k),c.putImageData(D,0,0),o}function s(o,c,f,p){return{red:p[4*(f*c+o)],green:p[4*(f*c+o)+1],blue:p[4*(f*c+o)+2],alpha:p[4*(f*c+o)+3]}}function r(o,c,f,p){return s(o,c,f,p).alpha}function h(o,c,f,p){for(var g=o?1:-1,w=o?0:f-1,y=w;o?y<f:y>-1;y+=g)for(var C=0;C<c;C++)if(r(C,y,c,p))return y;return null}function d(o,c,f,p){for(var g=o?1:-1,w=o?0:c-1,y=w;o?y<c:y>-1;y+=g)for(var C=0;C<f;C++)if(r(y,C,c,p))return y;return null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i}])})}(j)),j.exports}(function(t,a){(function(n,e){t.exports=e(tt,S,ht,ct())})(Y,function(n,e,i,s){return function(r){function h(o){if(d[o])return d[o].exports;var c=d[o]={exports:{},id:o,loaded:!1};return r[o].call(c.exports,c,c.exports,h),c.loaded=!0,c.exports}var d={};return h.m=r,h.c=d,h.p="",h(0)}([function(r,h,d){function o(m){return m&&m.__esModule?m:{default:m}}function c(m,v){var P={};for(var b in m)v.indexOf(b)>=0||Object.prototype.hasOwnProperty.call(m,b)&&(P[b]=m[b]);return P}function f(m,v){if(!(m instanceof v))throw new TypeError("Cannot call a class as a function")}function p(m,v){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!v||typeof v!="object"&&typeof v!="function"?m:v}function g(m,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);m.prototype=Object.create(v&&v.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(m,v):m.__proto__=v)}Object.defineProperty(h,"__esModule",{value:!0});var w=Object.assign||function(m){for(var v=1;v<arguments.length;v++){var P=arguments[v];for(var b in P)Object.prototype.hasOwnProperty.call(P,b)&&(m[b]=P[b])}return m},y=function(){function m(v,P){for(var b=0;b<P.length;b++){var l=P[b];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(v,l.key,l)}}return function(v,P,b){return P&&m(v.prototype,P),b&&m(v,b),v}}(),C=d(1),u=o(C),x=d(2),k=o(x),D=d(3),R=o(D),J=d(4),Z=o(J),U=function(m){function v(){var P,b,l,N;f(this,v);for(var A=arguments.length,q=Array(A),z=0;z<A;z++)q[z]=arguments[z];return b=l=p(this,(P=v.__proto__||Object.getPrototypeOf(v)).call.apply(P,[this].concat(q))),l._sigPad=null,l._excludeOurProps=function(){var E=l.props,T=(E.canvasProps,E.clearOnResize,c(E,["canvasProps","clearOnResize"]));return T},l.getCanvas=function(){return l._canvas},l.getTrimmedCanvas=function(){var E=document.createElement("canvas");return E.width=l._canvas.width,E.height=l._canvas.height,E.getContext("2d").drawImage(l._canvas,0,0),(0,Z.default)(E)},l.getSignaturePad=function(){return l._sigPad},l._checkClearOnResize=function(){l.props.clearOnResize&&l._resizeCanvas()},l._resizeCanvas=function(){var E=l.props.canvasProps||{},T=E.width,I=E.height;if(!T||!I){var W=l._canvas,L=Math.max(window.devicePixelRatio||1,1);T||(W.width=W.offsetWidth*L),I||(W.height=W.offsetHeight*L),W.getContext("2d").scale(L,L),l.clear()}},l.on=function(){return window.addEventListener("resize",l._checkClearOnResize),l._sigPad.on()},l.off=function(){return window.removeEventListener("resize",l._checkClearOnResize),l._sigPad.off()},l.clear=function(){return l._sigPad.clear()},l.isEmpty=function(){return l._sigPad.isEmpty()},l.fromDataURL=function(E,T){return l._sigPad.fromDataURL(E,T)},l.toDataURL=function(E,T){return l._sigPad.toDataURL(E,T)},l.fromData=function(E){return l._sigPad.fromData(E)},l.toData=function(){return l._sigPad.toData()},N=b,p(l,N)}return g(v,m),y(v,[{key:"componentDidMount",value:function(){this._sigPad=new R.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:"componentWillUnmount",value:function(){this.off()}},{key:"componentDidUpdate",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:"render",value:function(){var P=this,b=this.props.canvasProps;return k.default.createElement("canvas",w({ref:function(l){P._canvas=l}},b))}}]),v}(x.Component);U.propTypes={velocityFilterWeight:u.default.number,minWidth:u.default.number,maxWidth:u.default.number,minDistance:u.default.number,dotSize:u.default.oneOfType([u.default.number,u.default.func]),penColor:u.default.string,throttle:u.default.number,onEnd:u.default.func,onBegin:u.default.func,canvasProps:u.default.object,clearOnResize:u.default.bool},U.defaultProps={clearOnResize:!0},h.default=U},function(r,h){r.exports=n},function(r,h){r.exports=e},function(r,h){r.exports=i},function(r,h){r.exports=s}])})})(G);var lt=G.exports;const dt=Q(lt),ft="_signatureCanvas_1bkvb_1",vt="_container_1bkvb_10",pt="_buttonContainer_1bkvb_14",B={signatureCanvas:ft,container:vt,buttonContainer:pt};function gt(t){const a=et("run"),[n,e]=S.useState(!1),[i,s]=S.useState(!1),[r,h]=S.useState(void 0),d=V(u=>{let x=u.runState.values[t.component.qualifiedCode];return x==null?void 0:x.value}),o=S.useRef(null),[c,f]=S.useState(400);S.useEffect(()=>{var u;f((u=o==null?void 0:o.current)==null?void 0:u.offsetWidth)},[o]),S.useEffect(()=>{const u=()=>{var x;f((x=o==null?void 0:o.current)==null?void 0:x.offsetWidth)};return window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u)}},[]);const p=V(u=>u.runState.preview),g=S.useRef(),w=nt(),y=()=>{var u;(u=g.current)==null||u.clear(),h(void 0),s(!1),e(!1)},C=()=>{const u=g.current.toDataURL("image/png");ot(a,t.component.qualifiedCode,p,u,"signature.png").then(x=>{w(rt({componentCode:t.component.qualifiedCode,value:x}))}).catch(x=>{console.error(x)})};return S.useEffect(()=>{d&&d.stored_filename&&(s(!0),at(it(d.stored_filename)).then(u=>{e(!1),h(u)}))},[d]),M.jsxs(M.Fragment,{children:[M.jsx(H,{sx:{backgroundColor:"background.default"},className:B.container,children:M.jsx(H,{ref:o,sx:{maxWidth:Math.min(c,400)+"px"},className:B.signatureCanvas,children:r?M.jsx("img",{src:r,style:{width:Math.min(c,400)+"px",height:"200px"}}):M.jsx(dt,{penColor:"red",clearOnResize:!0,onBegin:()=>{e(!0),s(!0)},ref:g,canvasProps:{width:Math.min(c,400),height:200}})})}),M.jsx("br",{}),M.jsxs("div",{className:B.buttonContainer,children:[M.jsx($,{onClick:()=>y(),disabled:!i,children:"Clear"}),M.jsx($,{onClick:()=>C(),disabled:!n,children:"Submit"})]})]})}export{gt as default};
