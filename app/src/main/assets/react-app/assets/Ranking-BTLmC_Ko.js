import{j as q,r as v}from"./index-BPkE25ts.js";import{R as H,H as b,aR as D,b8 as L,aS as p,b9 as y}from"./use-service-Bb7LY6Q3.js";import{B as m}from"./index-DrOR_lvT.js";import{u as B}from"./useDrop-C3oBIppg.js";import"./isTouchDevice-ByQSu3Gj.js";import"./common-D9PPFwWu.js";import"./CardMedia-Q0SAzLl_.js";import"./Card-D1gdhD1c.js";import"./Toolbar-DcOb7dJo.js";const N="_dragContainer_5yuyr_1",M="_rankingItem_5yuyr_10",E={dragContainer:N,rankingItem:M};function U(s){const t=H(),r=b(e=>{let o={};return s.component.answers.forEach(l=>{o[l.qualifiedCode]=e.runState.values[l.qualifiedCode].value}),o},D),u=e=>isNaN(r[e])?"unsorted":"sorted",f=b(e=>{let o={};return s.component.answers.forEach(l=>{e.runState.order?o[l.qualifiedCode]=e.runState.order[l.qualifiedCode]:o[l.qualifiedCode]=e.runState.values[l.qualifiedCode].order+1}),o},D),C=s.component.answers.filter(e=>!r[e.qualifiedCode]).sort(function(e,o){return f[e.qualifiedCode]-f[o.qualifiedCode]}),c=s.component.answers.filter(e=>+r[e.qualifiedCode]>0).sort(function(e,o){return r[e.qualifiedCode]-r[o.qualifiedCode]}),i=(e,o,l)=>{const a={...f};if(l=="sorted"&&u(e.qualifiedCode)=="unsorted"){const d=o+1;for(let n in r)r.hasOwnProperty(n)&&r[n]>=d&&t(p({componentCode:n,value:r[n]+1}));t(p({componentCode:e.qualifiedCode,value:d})),e.index=o;const g=a[e.qualifiedCode];C.forEach(n=>{a[n.qualifiedCode]>=g&&(a[n.qualifiedCode]=a[n.qualifiedCode]-1)}),t(y(a))}else if(l=="unsorted"&&u(e.qualifiedCode)=="sorted"){const d=r[e.qualifiedCode];for(let n in r)r.hasOwnProperty(n)&&r[n]>=d&&t(p({componentCode:n,value:r[n]-1}));t(p({componentCode:e.qualifiedCode,value:void 0})),e.index=o;const g=o+1;C.forEach(n=>{a[n.qualifiedCode]>=g&&(a[n.qualifiedCode]=a[n.qualifiedCode]+1)}),a[e.qualifiedCode]=g,t(y(a))}},h=e=>{u(e.qualifiedCode)=="unsorted"?i(e,c.length,"sorted"):i(e,C.length,"unsorted")},x=(e,o,l,a)=>{const d={...f};if(l=="unsorted"&&u(e.qualifiedCode)=="unsorted"){const g=d[e.qualifiedCode];d[e.qualifiedCode]=d[o.qualifiedCode],d[o.qualifiedCode]=g,t(y(d)),e.index=a}else l=="sorted"&&u(e.qualifiedCode)=="sorted"&&(t(p({componentCode:e.qualifiedCode,value:r[o.qualifiedCode]})),t(p({componentCode:o.qualifiedCode,value:r[e.qualifiedCode]})),e.index=a)};return q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[q.jsx(S,{styles:E,ordererLength:c.length,unordererLength:C.length,onHover:x,order:f,onItemTransfer:i,onDoubleClick:h,itemType:"unsorted",options:C}),q.jsx(S,{styles:E,onHover:x,onItemTransfer:i,onDoubleClick:h,ordererLength:c.length,unordererLength:C.length,order:f,itemType:"sorted",options:c})]})}function S({styles:s,itemType:t,options:r,onItemTransfer:u,onDoubleClick:f,onHover:C}){const c=v.useRef(null);return q.jsxs(m,{ref:c,className:s.dragContainer,sx:{backgroundColor:"background.default"},children:[r.map((i,h)=>q.jsxs(v.Fragment,{children:[q.jsx(_,{itemType:t,index:h,onItemTransfer:u},"drop"+i.code),q.jsx(P,{index:h,onHover:C,itemType:t,option:i,rankingItemStyle:s.rankingItem,onDoubleClick:f},i.code)]},i.code)),q.jsx(_,{itemType:t,index:r.length,fillParent:!0,onItemTransfer:u},"last")]})}function P({option:s,onDoubleClick:t,rankingItemStyle:r,index:u,onHover:f,itemType:C}){var a;const c=v.useRef(),i={index:u,qualifiedCode:s.qualifiedCode},[h,x,e]=L({type:"rankingOption",item:i,collect:d=>{var g;return((g=d.getItem())==null?void 0:g.qualifiedCode)===s.qualifiedCode}}),[{handlerId:o},l]=B({accept:"rankingOption",collect(d){return{handlerId:d.getHandlerId()}},hover(d,g){var w;if(!c.current||!g.isOver({shallow:!0})||!d)return;const n=d.index,O=u;if(n===O)return;const k=(w=c.current)==null?void 0:w.getBoundingClientRect(),j=(k.bottom-k.top)/2,R=g.getClientOffset().y-k.top;n<O&&R<j||n>O&&R>j||f(d,s,C,u)}});return l(e(c)),q.jsx("div",{ref:x,children:q.jsx(m,{ref:c,"data-handler-id":o,style:{opacity:h?"0.2":"1"},onDoubleClick:()=>t(i),className:r,sx:{backgroundColor:"background.paper"},children:(a=s.content)==null?void 0:a.label})})}function _({index:s,onItemTransfer:t,itemType:r,fillParent:u}){const f=v.useRef(),[{handlerId:C},c]=B({accept:"rankingOption",collect(i){return{handlerId:i.getHandlerId()}},hover(i,h){!f.current||!h.isOver({shallow:!0})||!i||t(i,s,r)}});return c(f),q.jsx("div",{style:{flex:u?1:"inherit",minHeight:"12px"},ref:f,"data-handler-id":C})}export{U as default};
