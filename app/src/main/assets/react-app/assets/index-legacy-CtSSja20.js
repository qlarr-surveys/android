!function(){function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,s,i,l=[],o=!0,c=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;o=!1}else for(;!(o=(n=s.call(r)).done)&&(l.push(n.value),l.length!==t);o=!0);}catch(e){c=!0,a=e}finally{try{if(!o&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw a}}return l}}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function r(e,t,r,n,a,s,i){try{var l=e[s](i),o=l.value}catch(c){return void r(c)}l.done?t(o):Promise.resolve(o).then(n,a)}System.register(["./index-legacy-DMBe9EAg.js","./index-legacy-Dgk-mR2d.js","./use-service-legacy-CgI9X4sP.js","./Web-legacy-yvcV3pU-.js","./yup-legacy-C3aTvBsi.js","./Tabs-legacy-C8lKUr6-.js","./Card-legacy-DoW-tgDj.js","./LoadingButton-legacy-BX6tsN0p.js","./TableRow-legacy-DlEOJ0F5.js","./tableRowClasses-legacy-CPFVA4RK.js","./TableHead-legacy-KDNxqZvW.js","./TableCell-legacy-DZEPxFoJ.js","./TextField-legacy-QXvJQCtl.js","./Divider-legacy-BMiOv-Cp.js","./Checkbox-legacy-DMb0Vmp_.js","./SwitchBase-legacy-Cc5oLAc3.js","./useFormControl-legacy-CjmSkc-O.js","./radioClasses-legacy-BKKEz_sy.js","./FormControlLabel-legacy--V8-R9RI.js"],(function(t,n){"use strict";var a,s,i,l,o,c,d,u,m,h,f,p,x,g,_,v,j,b,y,S,C,w,N,I,A,U,D,R,E,M,T,L,k,$,z,q,P,V,B,O,F,W,Y,H,Z,G,J,K,Q,X,ee;return{setters:[e=>{a=e.j,s=e.f,i=e.g,l=e.h,o=e._,c=e.r,d=e.b,u=e.d,m=e.B,h=e.R},e=>{f=e.U},e=>{p=e.d,x=e.e,g=e.B,_=e.b,v=e.c,j=e.A,b=e.y,y=e.D,S=e.F,C=e.ao,w=e.T,N=e.am,I=e.w,A=e.an,U=e.I},e=>{D=e.u,R=e.m,E=e.f,M=e.F,T=e.R,L=e.n,k=e.I,$=e.M},e=>{z=e.d,q=e.a,P=e.c,V=e.e,B=e.o},e=>{O=e.b},e=>{F=e.C},e=>{W=e.L},e=>{Y=e.T,H=e.a,Z=e.b,G=e.c},e=>{J=e.a},e=>{K=e.T},e=>{Q=e.T},e=>{X=e.y},e=>{ee=e.D},null,null,null,null,null],execute:function(){var n=document.createElement("style");n.textContent="._mainContainer_1u62w_1{margin:auto;max-width:800px;min-width:300px;height:calc(100vh - 64px);overflow:auto}._content_1u62w_9{margin-top:30px}._addUser_6nyqh_1{display:flex;gap:10px;margin-top:20px;align-items:center}._mainContainer_sp6mp_1{margin:auto;max-width:800px;min-width:300px;height:calc(100vh - 64px);overflow:auto}._createUserCard_sp6mp_9{padding:25px}._formGroup_sp6mp_13{max-width:400px}._errorText_sp6mp_17{color:#eb5757!important}\n",document.head.appendChild(n),t("default",(function(){return a.jsx(m,{className:ce.mainContainer,children:a.jsx(he,{})})}));const te=p(a.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}),"ArrowDownward");function re(e){return i("MuiTableSortLabel",e)}const ne=s("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc"]),ae=["active","children","className","direction","hideSortIcon","IconComponent"],se=x(g,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(e,t)=>{const r=e.ownerState;return[t.root,r.active&&t.active]}})((({theme:e})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(e.vars||e).palette.text.secondary},"&:hover":{color:(e.vars||e).palette.text.secondary,[`& .${ne.icon}`]:{opacity:.5}},[`&.${ne.active}`]:{color:(e.vars||e).palette.text.primary,[`& .${ne.icon}`]:{opacity:1,color:(e.vars||e).palette.text.secondary}}}))),ie=x("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(e,t)=>{const r=e.ownerState;return[t.icon,t[`iconDirection${l(r.direction)}`]]}})((({theme:e,ownerState:t})=>o({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:e.transitions.create(["opacity","transform"],{duration:e.transitions.duration.shorter}),userSelect:"none"},"desc"===t.direction&&{transform:"rotate(0deg)"},"asc"===t.direction&&{transform:"rotate(180deg)"}))),le=c.forwardRef((function(e,t){const r=_({props:e,name:"MuiTableSortLabel"}),n=r.active,s=void 0!==n&&n,i=r.children,c=r.className,m=r.direction,h=void 0===m?"asc":m,f=r.hideSortIcon,p=void 0!==f&&f,x=r.IconComponent,g=void 0===x?te:x,j=d(r,ae),b=o({},r,{active:s,direction:h,hideSortIcon:p,IconComponent:g}),y=(e=>{const t=e.classes,r=e.direction,n={root:["root",e.active&&"active"],icon:["icon",`iconDirection${l(r)}`]};return v(n,re,t)})(b);return a.jsxs(se,o({className:u(y.root,c),component:"span",disableRipple:!0,ownerState:b,ref:t},j,{children:[i,p&&!s?null:a.jsx(ie,{as:g,className:u(y.icon),ownerState:b})]}))})),oe=p(a.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"PersonAdd"),ce={mainContainer:"_mainContainer_1u62w_1",content:"_content_1u62w_9"},de="_addUser_6nyqh_1",ue="_createUserCard_sp6mp_9";function me({userId:e,open:t,onClose:n}){const s=j("user"),i=b("manage").t,l=y();z(q,"noWhitespace",(function(e){return this.test("no-whitespace",e,(function(t){const r=this.path,n=this.createError;return!(null==t||!t.trim())||n({path:r,message:e})}))}));const o=P().shape({firstName:q().required(i("firstname_required")).noWhitespace(i("error.invalid_first_name")).max(50,i("error.first_name_too_long")),lastName:q().required(i("lastname_required")).noWhitespace(i("error.invalid_last_name")).max(50,i("error.last_name_too_long")),email:q().required(i("email_required")).matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/i,i("error.invalid_email")),roles:V().required(i("error.roles_required")).min(1,i("error.at_least_one_role"))}),d=D({resolver:B(o),defaultValues:{firstName:"",lastName:"",email:"",roles:[]}}),u=R({control:d.control,name:"roles"}),h=d.setError,f=d.reset,p=d.handleSubmit,x=d.formState.isSubmitting,g=d.setValue;d.watch;c.useEffect((()=>{e&&(l(S(!0)),s.getUser({userId:e}).then((e=>{l(S(!1)),f(e)})))}),[f,e]);const _=p(function(){var t,a=(t=function*(t){l(S(!0));const r=t.firstName,a=t.lastName,o=t.email,c=t.roles;try{e?yield s.updateUser({userId:e,data:{email:o,firstName:r,lastName:a,roles:c}}):yield s.createUser({email:o,firstName:r,lastName:a,roles:c}),n()}catch(d){d.name==C.DUPLICATE_EMAIL.name&&h("email",{type:"manual",message:i(`processed_errors.${d.name}`)})}finally{l(S(!1))}},function(){var e=this,n=arguments;return new Promise((function(a,s){var i=t.apply(e,n);function l(e){r(i,a,s,l,o,"next",e)}function o(e){r(i,a,s,l,o,"throw",e)}l(void 0)}))});return function(e){return a.apply(this,arguments)}}()),v=[{value:E.SUPER_ADMIN,label:i("label.super_admin")},{value:E.SURVEY_ADMIN,label:i("label.survey_admin")},{value:E.ANALYST,label:i("label.analyst")},{value:E.SURVEYOR,label:i("label.surveyor")}];return c.useEffect((()=>{const e=u.includes(E.SUPER_ADMIN),t=u.includes(E.SURVEY_ADMIN);if(e||t){const e=u.filter((e=>e===E.SUPER_ADMIN||e===E.SURVEY_ADMIN));g("roles",e)}}),[u,g]),a.jsx(O,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:a.jsxs(F,{sx:{overflow:"visible"},className:ue,children:[a.jsx(w,{variant:"h4",sx:{mb:3},children:i(e?"edit_user.title":"add_user.title")}),a.jsxs(M,{methods:d,onSubmit:_,children:[a.jsxs(N,{spacing:2.5,children:[a.jsx(T,{name:"firstName",label:i("label.first_name")}),a.jsx(T,{name:"lastName",label:i("label.last_name")}),a.jsx(T,{name:"email",label:i("label.email")}),a.jsx(L,{chip:!0,checkbox:!0,name:"roles",label:i("add_user.roles"),options:v,isOptionDisabled:(e,t)=>{const r=t.includes(E.SUPER_ADMIN),n=t.includes(E.SURVEY_ADMIN);return!(!r&&!n)&&(r&&e!==E.SUPER_ADMIN||n&&e!==E.SURVEY_ADMIN)}})]}),a.jsxs(m,{sx:{display:"flex",gap:"1rem",justifyContent:"flex-end",mt:"40px"},children:[a.jsx(W,{onClick:()=>n(!0),color:"inherit",size:"large",variant:"contained",children:i("add_user.cancel")}),a.jsx(W,{color:"inherit",size:"large",type:"submit",variant:"contained",loading:x,children:i("add_user.save")})]})]})]})})}const he=()=>{const t=j("user"),r=b("manage").t,n=e(c.useState([]),2),s=n[0],i=n[1],l=y(),o=e(c.useState(null),2),d=o[0],u=o[1],p=e(c.useState("asc"),2),x=p[0],g=p[1],_=e(c.useState("name"),2),v=_[0],C=_[1],N=e(c.useState(null),2),D=N[0],R=N[1],E=e(c.useState(null),2),M=E[0],T=E[1],L=e(c.useState(!1),2),z=L[0],q=L[1],P=I.getUser().id,V=()=>{l(S(!0)),t.getAllUsers().then((e=>{e&&i(e)})).finally((()=>{l(S(!1))}))},B=e(c.useState(null),2),O=B[0],F=B[1],W=()=>{F(null)};c.useEffect((()=>{V()}),[]);const te=e=>{g(v===e&&"asc"===x?"desc":"asc"),C(e)},re=(e,t,r)=>{if("name"===r){const r=`${e.firstName} ${e.lastName}`.toLowerCase(),n=`${t.firstName} ${t.lastName}`.toLowerCase();return n<r?-1:n>r?1:0}return t[r]<e[r]?-1:t[r]>e[r]?1:0},ne=((e,t)=>{const r=e.map(((e,t)=>[e,t]));return r.sort(((e,r)=>{const n=t(e[0],r[0]);return 0!==n?n:e[1]-r[1]})),r.map((e=>e[0]))})(s,(ae=v,"desc"===x?(e,t)=>re(e,t,ae):(e,t)=>-re(e,t,ae)));var ae;const se=e(c.useState(!1),2),ie=se[0],ce=se[1],ue=(e=null)=>{R(e),ce(!0)},he=c.useCallback(((e,t)=>{u(e.currentTarget),T(t)}),[]),fe=c.useCallback((()=>{u(null),T(null)}),[]);return a.jsxs(a.Fragment,{children:[a.jsxs(m,{display:"flex",justifyContent:"space-between",children:[a.jsx(w,{variant:"h5",sx:{mb:3},children:r("users_manage.users")}),a.jsxs(A,{className:de,onClick:()=>ue(),children:[a.jsx(oe,{}),r("users_manage.add_user")]})]}),a.jsx(Y,{sx:{overflow:"unset",[`& .${J.head}`]:{color:"text.primary"},[`& .${J.root}`]:{bgcolor:"background.default",borderBottomColor:e=>e.palette.divider}},children:a.jsxs(H,{sx:{minWidth:650},"aria-label":"simple table",children:[a.jsx(K,{children:a.jsxs(Z,{children:[a.jsx(Q,{align:"left",children:a.jsx(le,{active:"name"===v,direction:"name"===v?x:"asc",onClick:()=>te("name"),children:r("users_manage.name")})}),a.jsx(Q,{align:"left",children:a.jsx(le,{active:"email"===v,direction:"email"===v?x:"asc",onClick:()=>te("email"),children:r("users_manage.email")})}),a.jsx(Q,{align:"left",children:a.jsx(le,{active:"roles"===v,direction:"roles"===v?x:"asc",onClick:()=>te("roles"),children:r("users_manage.roles")})}),a.jsx(Q,{align:"left",children:a.jsx(le,{active:"status"===v,direction:"status"===v?x:"asc",onClick:()=>te("status"),children:r("users_manage.status")})})]})}),a.jsx(G,{children:ne.map((e=>{const t=!e.isConfirmed||e.id===P;return a.jsxs(h.Fragment,{children:[a.jsxs(Z,{children:[a.jsxs(Q,{align:"left",children:[e.firstName," ",e.lastName]}),a.jsx(Q,{align:"left",children:e.email}),a.jsx(Q,{align:"left",children:e.roles.map((e=>r(`label.${e}`))).join(", ")}),a.jsx(Q,{align:"left",children:e.isConfirmed?r("users_manage.active"):r("users_manage.invitation_sent")}),a.jsx(Q,{align:"right",padding:"none",children:!t&&a.jsx(U,{onClick:t=>he(t,e.id),children:a.jsx(k,{icon:"carbon:overflow-menu-vertical"})})})]},e.id),a.jsxs(X,{open:Boolean(d)&&M===e.id,anchorEl:d,onClose:fe,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{width:160}}},children:[a.jsxs($,{onClick:()=>{var t;t=e.id,ue(t),u(null)},children:[a.jsx(k,{icon:"carbon:edit",sx:{mr:1}})," ",r("users_manage.title_edit")]}),a.jsx(ee,{sx:{borderStyle:"dashed",mt:.5}}),a.jsxs($,{onClick:()=>{u(null),F(e)},sx:{color:"error.main"},children:[a.jsx(k,{icon:"carbon:trash-can",sx:{mr:1}})," ",r("users_manage.title_delete")]})]})]},e.id)}))})]})}),Boolean(O)&&a.jsx(f,{deleteUser:()=>{q(!0),t.deleteUser({userId:O.id}).then((()=>{W(),V(),q(!1)})).catch((e=>{q(!1)}))},name:O.firstName+" "+O.lastName,open:Boolean(O),onClose:W,isLoading:z}),ie&&a.jsx(me,{userId:D,open:ie,onClose:e=>{ce(!1),e||V()}})]})}}}}))}();
