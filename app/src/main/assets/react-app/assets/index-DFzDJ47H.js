import{j as e,f as me,g as ue,h as Q,_ as z,r as l,b as pe,d as H,B as O,R as fe}from"./index-BdaHkdQl.js";import{U as he}from"./index-BF_JiN0B.js";import{d as X,e as ee,B as xe,b as _e,c as be,A as se,y as te,D as ae,F as y,ao as ge,T as re,am as Se,w as ve,an as je,I as Ce}from"./use-service-D09swmN7.js";import{u as Ue,m as Te,f as h,F as ye,R as $,n as Ne,I as P,M as G}from"./Web-Xt-AHKsA.js";import{d as Ae,a as L,c as De,e as Re,o as Ie}from"./yup-DY16kGze.js";import{b as Le}from"./Tabs-CXy611xA.js";import{C as Ee}from"./Card-DaS3BkKI.js";import{L as Z}from"./LoadingButton-CeTIEj79.js";import{T as Me,a as we,b as J,c as $e}from"./TableRow-XbFzsXVn.js";import{a as K}from"./tableRowClasses-D2zlaSzG.js";import{T as Pe}from"./TableHead-CYTlZN0Y.js";import{T as g}from"./TableCell-CNVjjGNS.js";import{y as ke}from"./TextField-B66jFwFo.js";import{D as ze}from"./Divider-OC9h4qP8.js";import"./Checkbox-0qy6A3Vu.js";import"./SwitchBase-outpB1OY.js";import"./useFormControl-BousA45m.js";import"./radioClasses-DNdhtY0L.js";import"./FormControlLabel-DrGXXvQK.js";const Oe=X(e.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}),"ArrowDownward");function Be(a){return ue("MuiTableSortLabel",a)}const qe=me("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc"]),k=qe,Fe=["active","children","className","direction","hideSortIcon","IconComponent"],Ve=a=>{const{classes:r,direction:m,active:x}=a,t={root:["root",x&&"active"],icon:["icon","iconDirection".concat(Q(m))]};return be(t,Be,r)},We=ee(xe,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:m}=a;return[r.root,m.active&&r.active]}})(({theme:a})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(a.vars||a).palette.text.secondary},"&:hover":{color:(a.vars||a).palette.text.secondary,["& .".concat(k.icon)]:{opacity:.5}},["&.".concat(k.active)]:{color:(a.vars||a).palette.text.primary,["& .".concat(k.icon)]:{opacity:1,color:(a.vars||a).palette.text.secondary}}})),Ye=ee("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(a,r)=>{const{ownerState:m}=a;return[r.icon,r["iconDirection".concat(Q(m.direction))]]}})(({theme:a,ownerState:r})=>z({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:a.transitions.create(["opacity","transform"],{duration:a.transitions.duration.shorter}),userSelect:"none"},r.direction==="desc"&&{transform:"rotate(0deg)"},r.direction==="asc"&&{transform:"rotate(180deg)"})),He=l.forwardRef(function(r,m){const x=_e({props:r,name:"MuiTableSortLabel"}),{active:t=!1,children:b,className:S,direction:_="asc",hideSortIcon:v=!1,IconComponent:n=Oe}=x,N=pe(x,Fe),j=z({},x,{active:t,direction:_,hideSortIcon:v,IconComponent:n}),T=Ve(j);return e.jsxs(We,z({className:H(T.root,S),component:"span",disableRipple:!0,ownerState:j,ref:m},N,{children:[b,v&&!t?null:e.jsx(Ye,{as:n,className:H(T.icon),ownerState:j})]}))}),E=He,Ge=X(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"PersonAdd"),Ze="_mainContainer_1u62w_1",Je="_content_1u62w_9",Ke={mainContainer:Ze,content:Je},Qe="_addUser_6nyqh_1",Xe={addUser:Qe},es="_mainContainer_sp6mp_1",ss="_createUserCard_sp6mp_9",ts="_formGroup_sp6mp_13",as="_errorText_sp6mp_17",rs={mainContainer:es,createUserCard:ss,formGroup:ts,errorText:as};function ns({userId:a,open:r,onClose:m}){const x=se("user"),{t}=te("manage"),b=ae();Ae(L,"noWhitespace",function(o){return this.test("no-whitespace",o,function(c){const{path:p,createError:f}=this;return c!=null&&c.trim()?!0:f({path:p,message:o})})});const S=De().shape({firstName:L().required(t("firstname_required")).noWhitespace(t("error.invalid_first_name")).max(50,t("error.first_name_too_long")),lastName:L().required(t("lastname_required")).noWhitespace(t("error.invalid_last_name")).max(50,t("error.last_name_too_long")),email:L().required(t("email_required")).matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/i,t("error.invalid_email")),roles:Re().required(t("error.roles_required")).min(1,t("error.at_least_one_role"))}),_={firstName:"",lastName:"",email:"",roles:[]},v=Ue({resolver:Ie(S),defaultValues:_}),n=Te({control:v.control,name:"roles"}),{setError:N,reset:j,handleSubmit:T,formState:{isSubmitting:M},setValue:A,watch:B}=v;l.useEffect(()=>{a&&(b(y(!0)),x.getUser({userId:a}).then(o=>{b(y(!1)),j(o)}))},[j,a]);const D=T(async o=>{b(y(!0));const{firstName:c,lastName:p,email:f,roles:C}=o;try{a?await x.updateUser({userId:a,data:{email:f,firstName:c,lastName:p,roles:C}}):await x.createUser({email:f,firstName:c,lastName:p,roles:C}),m()}catch(I){I.name==ge.DUPLICATE_EMAIL.name&&N("email",{type:"manual",message:t("processed_errors.".concat(I.name))})}finally{b(y(!1))}}),w=[{value:h.SUPER_ADMIN,label:t("label.super_admin")},{value:h.SURVEY_ADMIN,label:t("label.survey_admin")},{value:h.ANALYST,label:t("label.analyst")},{value:h.SURVEYOR,label:t("label.surveyor")}],R=(o,c)=>{const p=c.includes(h.SUPER_ADMIN),f=c.includes(h.SURVEY_ADMIN);return p||f?p&&o!==h.SUPER_ADMIN||f&&o!==h.SURVEY_ADMIN:!1};return l.useEffect(()=>{const o=n.includes(h.SUPER_ADMIN),c=n.includes(h.SURVEY_ADMIN);if(o||c){const p=n.filter(f=>f===h.SUPER_ADMIN||f===h.SURVEY_ADMIN);A("roles",p)}},[n,A]),e.jsx(Le,{open:r,onClose:m,maxWidth:"md",fullWidth:!0,children:e.jsxs(Ee,{sx:{overflow:"visible"},className:rs.createUserCard,children:[e.jsx(re,{variant:"h4",sx:{mb:3},children:t(a?"edit_user.title":"add_user.title")}),e.jsxs(ye,{methods:v,onSubmit:D,children:[e.jsxs(Se,{spacing:2.5,children:[e.jsx($,{name:"firstName",label:t("label.first_name")}),e.jsx($,{name:"lastName",label:t("label.last_name")}),e.jsx($,{name:"email",label:t("label.email")}),e.jsx(Ne,{chip:!0,checkbox:!0,name:"roles",label:t("add_user.roles"),options:w,isOptionDisabled:R})]}),e.jsxs(O,{sx:{display:"flex",gap:"1rem",justifyContent:"flex-end",mt:"40px"},children:[e.jsx(Z,{onClick:()=>m(!0),color:"inherit",size:"large",variant:"contained",children:t("add_user.cancel")}),e.jsx(Z,{color:"inherit",size:"large",type:"submit",variant:"contained",loading:M,children:t("add_user.save")})]})]})]})})}const os=()=>{const a=se("user"),{t:r}=te("manage"),[m,x]=l.useState([]),t=ae(),[b,S]=l.useState(null),[_,v]=l.useState("asc"),[n,N]=l.useState("name"),[j,T]=l.useState(null),[M,A]=l.useState(null),[B,D]=l.useState(!1),w=ve.getUser().id,R=()=>{t(y(!0)),a.getAllUsers().then(s=>{s&&x(s)}).finally(()=>{t(y(!1))})},[o,c]=l.useState(null),p=()=>{c(null)},f=()=>{D(!0),a.deleteUser({userId:o.id}).then(()=>{p(),R(),D(!1)}).catch(s=>{D(!1)})};l.useEffect(()=>{R()},[]);const C=s=>{v(n===s&&_==="asc"?"desc":"asc"),N(s)},I=(s,d)=>{const i=s.map((u,U)=>[u,U]);return i.sort((u,U)=>{const Y=d(u[0],U[0]);return Y!==0?Y:u[1]-U[1]}),i.map(u=>u[0])},ne=(s,d)=>s==="desc"?(i,u)=>q(i,u,d):(i,u)=>-q(i,u,d),q=(s,d,i)=>{if(i==="name"){const u="".concat(s.firstName," ").concat(s.lastName).toLowerCase(),U="".concat(d.firstName," ").concat(d.lastName).toLowerCase();return U<u?-1:U>u?1:0}else return d[i]<s[i]?-1:d[i]>s[i]?1:0},oe=I(m,ne(_,n)),[F,V]=l.useState(!1),W=(s=null)=>{T(s),V(!0)},ie=s=>{W(s),S(null)},le=s=>{V(!1),s||R()},ce=l.useCallback((s,d)=>{S(s.currentTarget),A(d)},[]),de=l.useCallback(()=>{S(null),A(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(O,{display:"flex",justifyContent:"space-between",children:[e.jsx(re,{variant:"h5",sx:{mb:3},children:r("users_manage.users")}),e.jsxs(je,{className:Xe.addUser,onClick:()=>W(),children:[e.jsx(Ge,{}),r("users_manage.add_user")]})]}),e.jsx(Me,{sx:{overflow:"unset",["& .".concat(K.head)]:{color:"text.primary"},["& .".concat(K.root)]:{bgcolor:"background.default",borderBottomColor:s=>s.palette.divider}},children:e.jsxs(we,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Pe,{children:e.jsxs(J,{children:[e.jsx(g,{align:"left",children:e.jsx(E,{active:n==="name",direction:n==="name"?_:"asc",onClick:()=>C("name"),children:r("users_manage.name")})}),e.jsx(g,{align:"left",children:e.jsx(E,{active:n==="email",direction:n==="email"?_:"asc",onClick:()=>C("email"),children:r("users_manage.email")})}),e.jsx(g,{align:"left",children:e.jsx(E,{active:n==="roles",direction:n==="roles"?_:"asc",onClick:()=>C("roles"),children:r("users_manage.roles")})}),e.jsx(g,{align:"left",children:e.jsx(E,{active:n==="status",direction:n==="status"?_:"asc",onClick:()=>C("status"),children:r("users_manage.status")})})]})}),e.jsx($e,{children:oe.map(s=>{const d=!s.isConfirmed||s.id===w;return e.jsxs(fe.Fragment,{children:[e.jsxs(J,{children:[e.jsxs(g,{align:"left",children:[s.firstName," ",s.lastName]}),e.jsx(g,{align:"left",children:s.email}),e.jsx(g,{align:"left",children:s.roles.map(i=>r("label.".concat(i))).join(", ")}),e.jsx(g,{align:"left",children:s.isConfirmed?r("users_manage.active"):r("users_manage.invitation_sent")}),e.jsx(g,{align:"right",padding:"none",children:!d&&e.jsx(Ce,{onClick:i=>ce(i,s.id),children:e.jsx(P,{icon:"carbon:overflow-menu-vertical"})})})]},s.id),e.jsxs(ke,{open:!!b&&M===s.id,anchorEl:b,onClose:de,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{width:160}}},children:[e.jsxs(G,{onClick:()=>{ie(s.id)},children:[e.jsx(P,{icon:"carbon:edit",sx:{mr:1}})," ",r("users_manage.title_edit")]}),e.jsx(ze,{sx:{borderStyle:"dashed",mt:.5}}),e.jsxs(G,{onClick:()=>{S(null),c(s)},sx:{color:"error.main"},children:[e.jsx(P,{icon:"carbon:trash-can",sx:{mr:1}})," ",r("users_manage.title_delete")]})]})]},s.id)})})]})}),!!o&&e.jsx(he,{deleteUser:f,name:o.firstName+" "+o.lastName,open:!!o,onClose:p,isLoading:B}),F&&e.jsx(ns,{userId:j,open:F,onClose:le})]})};function ys(){return e.jsx(O,{className:Ke.mainContainer,children:e.jsx(os,{})})}export{ys as default};
