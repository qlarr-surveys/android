{"version":3,"file":"VideoCapture-D0Bc5SzC.js","sources":["../../src/components/Questions/VideoCapture/VideoCapture.jsx"],"sourcesContent":["import { Box } from \"@mui/system\";\nimport { useDispatch } from \"react-redux\";\nimport { useSelector } from \"react-redux\";\nimport { previewUrl, uploadFile } from \"~/networking/run\";\nimport { valueChange } from \"~/state/runState\";\nimport styles from \"./VideoCapture.module.css\";\nimport ReactPlayer from \"react-player\";\nimport { getFileFromPath } from \"~/networking/common\";\nimport { useService } from \"~/hooks/use-service\";\n\nfunction VideoCapture(props) {\n  const runService = useService(\"run\");\n\n  const component = props.component;\n  const state = useSelector((state) => {\n    return state.runState.values[component.qualifiedCode];\n  });\n  const preview = useSelector((state) => {\n    return state.runState.preview;\n  });\n\n  const mode = useSelector((state) => {\n    return state.runState.values.Survey.mode;\n  });\n\n  const dispatch = useDispatch();\n\n  const onImageClick = () => {\n    const code = component.qualifiedCode;\n    const maxFileSize =\n      (component.validation?.validation_max_file_size?.isActive &&\n        component.validation?.validation_max_file_size?.max_size) ||\n      -1;\n    if (preview && mode == \"offline\") {\n      getFileFromPath(\"/dummy_video.mp4\").then((response) => {\n        uploadFile(runService, code, preview, response)\n          .then((response) => {\n            dispatch(\n              valueChange({\n                componentCode: props.component.qualifiedCode,\n                value: response,\n              })\n            );\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      });\n    } else if (window[\"Android\"]) {\n      window[\"Android\"].captureVideo(code, maxFileSize);\n      window[\"onVideoCaptured\" + code] = (value) => {\n        dispatch(\n          valueChange({\n            componentCode: code,\n            value,\n          })\n        );\n      };\n    } else {\n      console.debug(\"no android device!!\");\n    }\n  };\n\n  return (\n    <Box className={styles.container}>\n      {!state.value || !state.value.stored_filename ? (\n        <img\n          onClick={onImageClick}\n          src=\"/video.png\"\n          style={{\n            maxHeight: \"200px\",\n          }}\n        />\n      ) : (\n        <div\n          style={{\n            position: \"relative\",\n            marginTop: \"16px\",\n            // 16:9 aspect ratio\n            paddingTop: \"56%\",\n          }}\n        >\n          <ReactPlayer\n            url={previewUrl(state.value.stored_filename)}\n            loop={false}\n            light={true}\n            controls={true}\n            config={{\n              forceAudio: false,\n            }}\n            style={{\n              backgroundColor: \"black\",\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n            }}\n            volume={1}\n            width=\"100%\"\n            height=\"100%\"\n          />\n        </div>\n      )}\n      <br />\n      {component.showHint && <span>{component.content?.hint}</span>}\n    </Box>\n  );\n}\n\nexport default VideoCapture;\n"],"names":["state","_a","response","jsxs","jsx"],"mappings":";;;;;;;;;;;;;AAUA,SAAS,aAAa,OAAO;;AACrB,QAAA,aAAa,WAAW,KAAK;AAEnC,QAAM,YAAY,MAAM;AAClB,QAAA,QAAQ,YAAY,CAACA,WAAU;AACnC,WAAOA,OAAM,SAAS,OAAO,UAAU,aAAa;AAAA,EAAA,CACrD;AACK,QAAA,UAAU,YAAY,CAACA,WAAU;AACrC,WAAOA,OAAM,SAAS;AAAA,EAAA,CACvB;AAEK,QAAA,OAAO,YAAY,CAACA,WAAU;AAC3BA,WAAAA,OAAM,SAAS,OAAO,OAAO;AAAA,EAAA,CACrC;AAED,QAAM,WAAW;AAEjB,QAAM,eAAe,MAAM;;AACzB,UAAM,OAAO,UAAU;AACjB,UAAA,gBACH,MAAAC,MAAA,UAAU,eAAV,gBAAAA,IAAsB,6BAAtB,mBAAgD,eAC/C,qBAAU,eAAV,mBAAsB,6BAAtB,mBAAgD,aAClD;AACE,QAAA,WAAW,QAAQ,WAAW;AAChC,sBAAgB,kBAAkB,EAAE,KAAK,CAAC,aAAa;AACrD,mBAAW,YAAY,MAAM,SAAS,QAAQ,EAC3C,KAAK,CAACC,cAAa;AAClB;AAAA,YACE,YAAY;AAAA,cACV,eAAe,MAAM,UAAU;AAAA,cAC/B,OAAOA;AAAAA,YAAA,CACR;AAAA,UAAA;AAAA,QACH,CACD,EACA,MAAM,CAAC,QAAQ;AACd,kBAAQ,MAAM,GAAG;AAAA,QAAA,CAClB;AAAA,MAAA,CACJ;AAAA,IAAA,WACQ,OAAO,SAAS,GAAG;AAC5B,aAAO,SAAS,EAAE,aAAa,MAAM,WAAW;AAChD,aAAO,oBAAoB,IAAI,IAAI,CAAC,UAAU;AAC5C;AAAA,UACE,YAAY;AAAA,YACV,eAAe;AAAA,YACf;AAAA,UAAA,CACD;AAAA,QAAA;AAAA,MACH;AAAA,IACF,OACK;AACL,cAAQ,MAAM,qBAAqB;AAAA,IACrC;AAAA,EAAA;AAGF,SACGC,kCAAAA,KAAA,KAAA,EAAI,WAAW,OAAO,WACpB,UAAA;AAAA,IAAA,CAAC,MAAM,SAAS,CAAC,MAAM,MAAM,kBAC5BC,kCAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,KAAI;AAAA,QACJ,OAAO;AAAA,UACL,WAAW;AAAA,QACb;AAAA,MAAA;AAAA,IAAA,IAGFA,kCAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,UACL,UAAU;AAAA,UACV,WAAW;AAAA;AAAA,UAEX,YAAY;AAAA,QACd;AAAA,QAEA,UAAAA,kCAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,KAAK,WAAW,MAAM,MAAM,eAAe;AAAA,YAC3C,MAAM;AAAA,YACN,OAAO;AAAA,YACP,UAAU;AAAA,YACV,QAAQ;AAAA,cACN,YAAY;AAAA,YACd;AAAA,YACA,OAAO;AAAA,cACL,iBAAiB;AAAA,cACjB,UAAU;AAAA,cACV,KAAK;AAAA,cACL,MAAM;AAAA,YACR;AAAA,YACA,QAAQ;AAAA,YACR,OAAM;AAAA,YACN,QAAO;AAAA,UAAA;AAAA,QACT;AAAA,MAAA;AAAA,IACF;AAAA,0CAED,MAAG,EAAA;AAAA,IACH,UAAU,YAAYA,kCAAAA,IAAC,QAAM,EAAA,WAAA,eAAU,YAAV,mBAAmB,MAAK;AAAA,EACxD,EAAA,CAAA;AAEJ;"}