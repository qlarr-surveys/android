{"version":3,"file":"VideoCapture-legacy-CK3AlQKI.js","sources":["../../src/components/Questions/VideoCapture/VideoCapture.jsx"],"sourcesContent":["import { Box } from \"@mui/system\";\nimport { useDispatch } from \"react-redux\";\nimport { useSelector } from \"react-redux\";\nimport { previewUrl, uploadFile } from \"~/networking/run\";\nimport { valueChange } from \"~/state/runState\";\nimport styles from \"./VideoCapture.module.css\";\nimport ReactPlayer from \"react-player\";\nimport { getFileFromPath } from \"~/networking/common\";\nimport { useService } from \"~/hooks/use-service\";\n\nfunction VideoCapture(props) {\n  const runService = useService(\"run\");\n\n  const component = props.component;\n  const state = useSelector((state) => {\n    return state.runState.values[component.qualifiedCode];\n  });\n  const preview = useSelector((state) => {\n    return state.runState.preview;\n  });\n\n  const mode = useSelector((state) => {\n    return state.runState.values.Survey.mode;\n  });\n\n  const dispatch = useDispatch();\n\n  const onImageClick = () => {\n    const code = component.qualifiedCode;\n    const maxFileSize =\n      (component.validation?.validation_max_file_size?.isActive &&\n        component.validation?.validation_max_file_size?.max_size) ||\n      -1;\n    if (preview && mode == \"offline\") {\n      getFileFromPath(\"/dummy_video.mp4\").then((response) => {\n        uploadFile(runService, code, preview, response)\n          .then((response) => {\n            dispatch(\n              valueChange({\n                componentCode: props.component.qualifiedCode,\n                value: response,\n              })\n            );\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      });\n    } else if (window[\"Android\"]) {\n      window[\"Android\"].captureVideo(code, maxFileSize);\n      window[\"onVideoCaptured\" + code] = (value) => {\n        dispatch(\n          valueChange({\n            componentCode: code,\n            value,\n          })\n        );\n      };\n    } else {\n      console.debug(\"no android device!!\");\n    }\n  };\n\n  return (\n    <Box className={styles.container}>\n      {!state.value || !state.value.stored_filename ? (\n        <img\n          onClick={onImageClick}\n          src=\"/video.png\"\n          style={{\n            maxHeight: \"200px\",\n          }}\n        />\n      ) : (\n        <div\n          style={{\n            position: \"relative\",\n            marginTop: \"16px\",\n            // 16:9 aspect ratio\n            paddingTop: \"56%\",\n          }}\n        >\n          <ReactPlayer\n            url={previewUrl(state.value.stored_filename)}\n            loop={false}\n            light={true}\n            controls={true}\n            config={{\n              forceAudio: false,\n            }}\n            style={{\n              backgroundColor: \"black\",\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n            }}\n            volume={1}\n            width=\"100%\"\n            height=\"100%\"\n          />\n        </div>\n      )}\n      <br />\n      {component.showHint && <span>{component.content?.hint}</span>}\n    </Box>\n  );\n}\n\nexport default VideoCapture;\n"],"names":["VideoCapture","props","_component$content","runService","useService","component","state","useSelector","runState","values","qualifiedCode","preview","mode","Survey","dispatch","useDispatch","onImageClick","_component$validation","_component$validation2","code","maxFileSize","validation","validation_max_file_size","isActive","max_size","getFileFromPath","then","response","uploadFile","valueChange","componentCode","value","catch","err","console","error","window","captureVideo","debug","jsxs","Box","className","styles","container","children","stored_filename","jsx","onClick","src","style","maxHeight","position","marginTop","paddingTop","ReactPlayer","url","previewUrl","loop","light","controls","config","forceAudio","backgroundColor","top","left","volume","width","height","showHint","content","hint"],"mappings":"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"}