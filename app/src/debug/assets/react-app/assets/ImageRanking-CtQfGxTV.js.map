{"version":3,"file":"ImageRanking-CtQfGxTV.js","sources":["../../src/components/Questions/ImageRanking/ImageRanking.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styles from \"./ImageRanking.module.css\";\nimport { useTheme } from \"@emotion/react\";\nimport { Box, Grid } from \"@mui/material\";\nimport { shallowEqual, useDispatch } from \"react-redux\";\nimport { valueChange } from \"~/state/runState\";\nimport { buildResourceUrl } from \"~/networking/common\";\nimport { useSelector } from \"react-redux\";\nimport { setDirty } from \"~/state/templateState\";\nimport { rtlLanguage } from \"~/utils/common\";\n\nfunction ImageRanking(props) {\n  const values = useSelector((state) => {\n    let valuesMap = {};\n    props.component.answers.forEach((element) => {\n      valuesMap[element.qualifiedCode] =\n        state.runState.values[element.qualifiedCode].value;\n    });\n    return valuesMap;\n  }, shallowEqual);\n  const dispatch = useDispatch();\n\n  const containerRef = useRef(null);\n  const [width, setWidth] = useState(800);\n  useEffect(() => {\n    setWidth(containerRef?.current?.offsetWidth);\n  }, [containerRef]);\n  const imageWidth =\n    (width - props.component.columns * props.component.spacing * 2) /\n    props.component.columns;\n  const imageHeight = imageWidth / (props.component.imageAspectRatio || 1);\n\n  useEffect(() => {\n    const resizeListener = () => {\n      // change width from the state object\n      setWidth(containerRef?.current?.offsetWidth);\n    };\n    // set resize listener\n    window.addEventListener(\"resize\", resizeListener);\n\n    // clean up function\n    return () => {\n      // remove resize listener\n      window.removeEventListener(\"resize\", resizeListener);\n    };\n  }, []);\n\n  const onItemClick = (componentCode) => {\n    dispatch(setDirty(props.component.qualifiedCode));\n    dispatch(setDirty(props.parentCode));\n    if (+values[componentCode] > 0) {\n      dispatch(valueChange({ componentCode, undefined }));\n    } else {\n      let keys = Object.keys(values);\n      let allValues = keys.map((key) => values[key]);\n      for (var i = 1; i <= keys.length; i++) {\n        if (!allValues.includes(i)) {\n          dispatch(valueChange({ componentCode, value: i }));\n          return;\n        }\n      }\n    }\n  };\n\n  const lang = useSelector((state) => {\n    return state.runState.values[\"Survey\"].lang;\n  });\n  const isRtl = rtlLanguage.includes(lang);\n\n  return (\n    <Box\n      sx={{\n        gap: `${props.component.spacing}px`,\n        justifyContent: isRtl ? \"flex-end\" : \"flex-start\",\n      }}\n      className={styles.imageFlexContainer}\n    >\n      {props.component.answers.map((option) => {\n        return (\n          <ImageRankingItem\n            option={option}\n            spacing={props.component.spacing}\n            columns={props.component.columns}\n            hideText={props.component.hideText}\n            onClick={() => onItemClick(option.qualifiedCode)}\n            parentCode={props.component.qualifiedCode}\n            imageHeight={imageHeight}\n            imageWidth={imageWidth}\n            key={option.qualifiedCode}\n          />\n        );\n      })}\n    </Box>\n  );\n}\n\nfunction ImageRankingItem(props) {\n  const theme = useTheme();\n  const state = useSelector((state) => {\n    let answerState = state.runState.values[props.option.qualifiedCode];\n    return {\n      showAnswer:\n        typeof answerState?.relevance == \"undefined\" || answerState.relevance,\n      value: answerState?.value || 0,\n    };\n  }, shallowEqual);\n\n  const backgroundImage = props.option.resources?.image\n    ? `url('${buildResourceUrl(props.option.resources.image)}')`\n    : `url('/placeholder-image.jpg')`;\n\n  return (\n    <Box\n      key={props.option.code}\n      sx={{\n        flex: `0 1 calc(${100 / props.columns}% - ${props.spacing}px)`,\n        cursor: \"pointer\",\n      }}\n    >\n\n      <Box\n        className={styles.imageContainer}\n        onClick={() => props.onClick()}\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        style={{\n          paddingTop: 100 / props.aspectRatio + \"%\",\n          backgroundImage: backgroundImage,\n          borderRadius: \"4px\",\n          boxShadow: 2,\n          height: props.imageHeight + \"px\",\n          border: state.checked\n            ? `2px solid ${theme.palette.primary.main}`\n            : \"2px solid transparent\",\n        }}\n      >\n        {state.value > 0 && (\n          <div\n            style={{\n              height: Math.min(props.imageHeight, props.imageWidth) + \"px\",\n              width: Math.min(props.imageHeight, props.imageWidth) + \"px\",\n              borderRadius:\n                Math.min(props.imageHeight, props.imageWidth) / 2 + \"px\",\n              fontSize:\n                Math.min(props.imageHeight, props.imageWidth) / 2 + \"px\",\n              background: theme.palette.primary.main,\n\n            }}\n            className={styles.rankContainer}\n          >\n            <span\n              className={styles.rankValue}\n              style={{\n                color: theme.textStyles.text.color,\n              }}\n            >\n              {state.value}\n            </span>\n          </div>\n        )}\n      </Box>\n      {!props.hideText && (\n        <Box\n          sx={{\n            fontFamily: theme.textStyles.text.font,\n            color: theme.textStyles.text.color,\n            fontSize: theme.textStyles.text.size,\n          }}\n        >\n          {props.option.content?.label}\n        </Box>\n      )}\n    </Box>\n  );\n}\n\nexport default ImageRanking;\n"],"names":["useRef","useState","useEffect","jsx","state","jsxs"],"mappings":"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"}