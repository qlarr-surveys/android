{"version":3,"file":"PhotoCapture-BOBJCfBs.js","sources":["../../src/components/Questions/PhotoCapture/PhotoCapture.jsx"],"sourcesContent":["import { Box } from \"@mui/system\";\nimport { useDispatch } from \"react-redux\";\nimport { useSelector } from \"react-redux\";\nimport { previewUrlByFilename, uploadFile } from \"~/networking/run\";\nimport { valueChange } from \"~/state/runState\";\nimport styles from \"./PhotoCapture.module.css\";\nimport { getFileFromPath } from '~/networking/common';\nimport { useService } from \"~/hooks/use-service\";\n\nfunction PhotoCapture(props) {\n  const runService = useService(\"run\");\n  const component = props.component;\n  const state = useSelector((state) => {\n    return state.runState.values[component.qualifiedCode];\n  });\n  const preview = useSelector((state) => {\n    return state.runState.preview;\n  });\n\n  const mode = useSelector((state) => {\n    return state.runState.values.Survey.mode;\n  });\n\n  const dispatch = useDispatch();\n\n  const onImageClick = () => {\n    const code = component.qualifiedCode;\n    const validationMaxSize = (component.validation?.validation_max_file_size?.isActive &&\n      component.validation?.validation_max_file_size?.max_size) || -1;\n  \n  // Limit to validation value or 10MB (10240 KB), whichever is smaller\n  const IMAGE_MAX_SIZE_KB = 10240; // 10MB\n  const maxFileSize = validationMaxSize > 0 \n    ? Math.min(validationMaxSize, IMAGE_MAX_SIZE_KB)\n    : IMAGE_MAX_SIZE_KB;\n    if (preview && mode == \"offline\") {\n      getFileFromPath(\"/dummy_image.png\").then((response) => {\n        uploadFile(runService, code, preview, response)\n          .then((response) => {\n            dispatch(\n              valueChange({\n                componentCode: props.component.qualifiedCode,\n                value: response,\n              })\n            );\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      });\n    } else if (window[\"Android\"]) {\n      window[\"Android\"].capturePhoto(code, maxFileSize);\n      window[\"onPhotoCaptured\" + code] = (value) => {\n        dispatch(\n          valueChange({\n            componentCode: code,\n            value,\n          })\n        );\n      };\n    } else {\n      console.debug(\"no android device!!\");\n    }\n  };\n\n  return (\n    <Box className={styles.container} sx={{ maxHeight: \"400px\" }}>\n      {!state.value || !state.value.stored_filename ? (\n        <img\n          onClick={onImageClick}\n          src=\"/camera.png\"\n          style={{\n            maxHeight: \"200px\",\n            maxWidth: \"100%\",\n          }}\n        />\n      ) : (\n        <img\n          onClick={onImageClick}\n          src={previewUrlByFilename(state.value.stored_filename)}\n          style={{\n            maxHeight: \"400px\",\n            maxWidth: \"100%\",\n          }}\n        />\n      )}\n      <br />\n      {component.showHint && <span>{component.content?.hint}</span>}\n    </Box>\n\n\n\n\n  );\n}\n\nexport default PhotoCapture;\n"],"names":["state","_a","response","jsxs","jsx"],"mappings":";;;;;;AASA,SAAS,aAAa,OAAO;;AAC3B,QAAM,aAAa,WAAW,KAAK;AACnC,QAAM,YAAY,MAAM;AACxB,QAAM,QAAQ,YAAY,CAACA,WAAU;AACnC,WAAOA,OAAM,SAAS,OAAO,UAAU,aAAa;AAAA,EACtD,CAAC;AACD,QAAM,UAAU,YAAY,CAACA,WAAU;AACrC,WAAOA,OAAM,SAAS;AAAA,EACxB,CAAC;AAED,QAAM,OAAO,YAAY,CAACA,WAAU;AAClC,WAAOA,OAAM,SAAS,OAAO,OAAO;AAAA,EACtC,CAAC;AAED,QAAM,WAAW,YAAA;AAEjB,QAAM,eAAe,MAAM;;AACzB,UAAM,OAAO,UAAU;AACvB,UAAM,sBAAqB,MAAAC,MAAA,UAAU,eAAV,gBAAAA,IAAsB,6BAAtB,mBAAgD,eACzE,qBAAU,eAAV,mBAAsB,6BAAtB,mBAAgD,aAAa;AAGjE,UAAM,oBAAoB;AAC1B,UAAM,cAAc,oBAAoB,IACpC,KAAK,IAAI,mBAAmB,iBAAiB,IAC7C;AACF,QAAI,WAAW,QAAQ,WAAW;AAChC,sBAAgB,kBAAkB,EAAE,KAAK,CAAC,aAAa;AACrD,mBAAW,YAAY,MAAM,SAAS,QAAQ,EAC3C,KAAK,CAACC,cAAa;AAClB;AAAA,YACE,YAAY;AAAA,cACV,eAAe,MAAM,UAAU;AAAA,cAC/B,OAAOA;AAAAA,YAAA,CACR;AAAA,UAAA;AAAA,QAEL,CAAC,EACA,MAAM,CAAC,QAAQ;AACd,kBAAQ,MAAM,GAAG;AAAA,QACnB,CAAC;AAAA,MACL,CAAC;AAAA,IACH,WAAW,OAAO,SAAS,GAAG;AAC5B,aAAO,SAAS,EAAE,aAAa,MAAM,WAAW;AAChD,aAAO,oBAAoB,IAAI,IAAI,CAAC,UAAU;AAC5C;AAAA,UACE,YAAY;AAAA,YACV,eAAe;AAAA,YACf;AAAA,UAAA,CACD;AAAA,QAAA;AAAA,MAEL;AAAA,IACF,OAAO;AACL,cAAQ,MAAM,qBAAqB;AAAA,IACrC;AAAA,EACF;AAEA,SACEC,uCAAC,OAAI,WAAW,OAAO,WAAW,IAAI,EAAE,WAAW,QAAA,GAChD,UAAA;AAAA,IAAA,CAAC,MAAM,SAAS,CAAC,MAAM,MAAM,kBAC5BC,kCAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,KAAI;AAAA,QACJ,OAAO;AAAA,UACL,WAAW;AAAA,UACX,UAAU;AAAA,QAAA;AAAA,MACZ;AAAA,IAAA,IAGFA,kCAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,KAAK,qBAAqB,MAAM,MAAM,eAAe;AAAA,QACrD,OAAO;AAAA,UACL,WAAW;AAAA,UACX,UAAU;AAAA,QAAA;AAAA,MACZ;AAAA,IAAA;AAAA,0CAGH,MAAA,EAAG;AAAA,IACH,UAAU,YAAYA,kCAAAA,IAAC,QAAA,EAAM,WAAA,eAAU,YAAV,mBAAmB,KAAA,CAAK;AAAA,EAAA,GACxD;AAMJ;"}