{"version":3,"file":"ImageRanking-legacy-BOyUyInh.js","sources":["../../src/components/Questions/ImageRanking/ImageRanking.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styles from \"./ImageRanking.module.css\";\nimport { useTheme } from \"@emotion/react\";\nimport { Box, Grid } from \"@mui/material\";\nimport { shallowEqual, useDispatch } from \"react-redux\";\nimport { valueChange } from \"~/state/runState\";\nimport { buildResourceUrl } from \"~/networking/common\";\nimport { useSelector } from \"react-redux\";\nimport { setDirty } from \"~/state/templateState\";\nimport { rtlLanguage } from \"~/utils/common\";\n\nfunction ImageRanking(props) {\n  const values = useSelector((state) => {\n    let valuesMap = {};\n    props.component.answers.forEach((element) => {\n      valuesMap[element.qualifiedCode] =\n        state.runState.values[element.qualifiedCode].value;\n    });\n    return valuesMap;\n  }, shallowEqual);\n  const dispatch = useDispatch();\n\n  const containerRef = useRef(null);\n  const [width, setWidth] = useState(800);\n  useEffect(() => {\n    setWidth(containerRef?.current?.offsetWidth);\n  }, [containerRef]);\n  const imageWidth =\n    (width - props.component.columns * props.component.spacing * 2) /\n    props.component.columns;\n  const imageHeight = imageWidth / (props.component.imageAspectRatio || 1);\n\n  useEffect(() => {\n    const resizeListener = () => {\n      // change width from the state object\n      setWidth(containerRef?.current?.offsetWidth);\n    };\n    // set resize listener\n    window.addEventListener(\"resize\", resizeListener);\n\n    // clean up function\n    return () => {\n      // remove resize listener\n      window.removeEventListener(\"resize\", resizeListener);\n    };\n  }, []);\n\n  const onItemClick = (componentCode) => {\n    dispatch(setDirty(props.component.qualifiedCode));\n    dispatch(setDirty(props.parentCode));\n    if (+values[componentCode] > 0) {\n      dispatch(valueChange({ componentCode, undefined }));\n    } else {\n      let keys = Object.keys(values);\n      let allValues = keys.map((key) => values[key]);\n      for (var i = 1; i <= keys.length; i++) {\n        if (!allValues.includes(i)) {\n          dispatch(valueChange({ componentCode, value: i }));\n          return;\n        }\n      }\n    }\n  };\n\n  const lang = useSelector((state) => {\n    return state.runState.values[\"Survey\"].lang;\n  });\n  const isRtl = rtlLanguage.includes(lang);\n\n  return (\n    <Box\n      sx={{\n        gap: `${props.component.spacing}px`,\n        justifyContent: isRtl ? \"flex-end\" : \"flex-start\",\n      }}\n      className={styles.imageFlexContainer}\n    >\n      {props.component.answers.map((option) => {\n        return (\n          <ImageRankingItem\n            option={option}\n            spacing={props.component.spacing}\n            columns={props.component.columns}\n            hideText={props.component.hideText}\n            onClick={() => onItemClick(option.qualifiedCode)}\n            parentCode={props.component.qualifiedCode}\n            imageHeight={imageHeight}\n            imageWidth={imageWidth}\n            key={option.qualifiedCode}\n          />\n        );\n      })}\n    </Box>\n  );\n}\n\nfunction ImageRankingItem(props) {\n  const theme = useTheme();\n  const state = useSelector((state) => {\n    let answerState = state.runState.values[props.option.qualifiedCode];\n    return {\n      showAnswer:\n        typeof answerState?.relevance == \"undefined\" || answerState.relevance,\n      value: answerState?.value || 0,\n    };\n  }, shallowEqual);\n\n  const backgroundImage = props.option.resources?.image\n    ? `url('${buildResourceUrl(props.option.resources.image)}')`\n    : `url('/placeholder-image.jpg')`;\n\n  return (\n    <Box\n      key={props.option.code}\n      sx={{\n        flex: `0 1 calc(${100 / props.columns}% - ${props.spacing}px)`,\n        cursor: \"pointer\",\n      }}\n    >\n\n      <Box\n        className={styles.imageContainer}\n        onClick={() => props.onClick()}\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        style={{\n          paddingTop: 100 / props.aspectRatio + \"%\",\n          backgroundImage: backgroundImage,\n          borderRadius: \"4px\",\n          boxShadow: 2,\n          height: props.imageHeight + \"px\",\n          border: state.checked\n            ? `2px solid ${theme.palette.primary.main}`\n            : \"2px solid transparent\",\n        }}\n      >\n        {state.value > 0 && (\n          <div\n            style={{\n              height: Math.min(props.imageHeight, props.imageWidth) + \"px\",\n              width: Math.min(props.imageHeight, props.imageWidth) + \"px\",\n              borderRadius:\n                Math.min(props.imageHeight, props.imageWidth) / 2 + \"px\",\n              fontSize:\n                Math.min(props.imageHeight, props.imageWidth) / 2 + \"px\",\n              background: theme.palette.primary.main,\n\n            }}\n            className={styles.rankContainer}\n          >\n            <span\n              className={styles.rankValue}\n              style={{\n                color: theme.textStyles.text.color,\n              }}\n            >\n              {state.value}\n            </span>\n          </div>\n        )}\n      </Box>\n      {!props.hideText && (\n        <Box\n          sx={{\n            fontFamily: theme.textStyles.text.font,\n            color: theme.textStyles.text.color,\n            fontSize: theme.textStyles.text.size,\n          }}\n        >\n          {props.option.content?.label}\n        </Box>\n      )}\n    </Box>\n  );\n}\n\nexport default ImageRanking;\n"],"names":["ImageRanking","props","values","useSelector","state","valuesMap","component","answers","forEach","element","qualifiedCode","runState","value","shallowEqual","dispatch","useDispatch","containerRef","useRef","_reactExports$useStat","useState","_reactExports$useStat2","_slicedToArray","width","setWidth","useEffect","_containerRef$current","current","offsetWidth","imageWidth","columns","spacing","imageHeight","imageAspectRatio","resizeListener","_containerRef$current2","window","addEventListener","removeEventListener","onItemClick","componentCode","setDirty","parentCode","valueChange","undefined","keys","Object","allValues","map","key","i","length","includes","lang","isRtl","rtlLanguage","jsx","Box","sx","gap","justifyContent","className","styles","imageFlexContainer","children","option","ImageRankingItem","hideText","onClick","_props$option$resourc","_props$option$content","theme","useTheme","answerState","showAnswer","relevance","backgroundImage","resources","image","buildResourceUrl","jsxs","flex","cursor","imageContainer","display","alignItems","style","paddingTop","aspectRatio","borderRadius","boxShadow","height","border","checked","palette","primary","main","Math","min","fontSize","background","rankContainer","rankValue","color","textStyles","text","fontFamily","font","size","content","label","code"],"mappings":"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"}