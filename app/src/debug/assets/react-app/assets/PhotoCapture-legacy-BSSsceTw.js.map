{"version":3,"file":"PhotoCapture-legacy-BSSsceTw.js","sources":["../../src/components/Questions/PhotoCapture/PhotoCapture.jsx"],"sourcesContent":["import { Box } from \"@mui/system\";\nimport { useDispatch } from \"react-redux\";\nimport { useSelector } from \"react-redux\";\nimport { previewUrlByFilename, uploadFile } from \"~/networking/run\";\nimport { valueChange } from \"~/state/runState\";\nimport styles from \"./PhotoCapture.module.css\";\nimport { getFileFromPath } from '~/networking/common';\nimport { useService } from \"~/hooks/use-service\";\n\nfunction PhotoCapture(props) {\n  const runService = useService(\"run\");\n  const component = props.component;\n  const state = useSelector((state) => {\n    return state.runState.values[component.qualifiedCode];\n  });\n  const preview = useSelector((state) => {\n    return state.runState.preview;\n  });\n\n  const mode = useSelector((state) => {\n    return state.runState.values.Survey.mode;\n  });\n\n  const dispatch = useDispatch();\n\n  const onImageClick = () => {\n    const code = component.qualifiedCode;\n    const validationMaxSize = (component.validation?.validation_max_file_size?.isActive &&\n      component.validation?.validation_max_file_size?.max_size) || -1;\n  \n  // Limit to validation value or 10MB (10240 KB), whichever is smaller\n  const IMAGE_MAX_SIZE_KB = 10240; // 10MB\n  const maxFileSize = validationMaxSize > 0 \n    ? Math.min(validationMaxSize, IMAGE_MAX_SIZE_KB)\n    : IMAGE_MAX_SIZE_KB;\n    if (preview && mode == \"offline\") {\n      getFileFromPath(\"/dummy_image.png\").then((response) => {\n        uploadFile(runService, code, preview, response)\n          .then((response) => {\n            dispatch(\n              valueChange({\n                componentCode: props.component.qualifiedCode,\n                value: response,\n              })\n            );\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      });\n    } else if (window[\"Android\"]) {\n      window[\"Android\"].capturePhoto(code, maxFileSize);\n      window[\"onPhotoCaptured\" + code] = (value) => {\n        dispatch(\n          valueChange({\n            componentCode: code,\n            value,\n          })\n        );\n      };\n    } else {\n      console.debug(\"no android device!!\");\n    }\n  };\n\n  return (\n    <Box className={styles.container} sx={{ maxHeight: \"400px\" }}>\n      {!state.value || !state.value.stored_filename ? (\n        <img\n          onClick={onImageClick}\n          src=\"/camera.png\"\n          style={{\n            maxHeight: \"200px\",\n            maxWidth: \"100%\",\n          }}\n        />\n      ) : (\n        <img\n          onClick={onImageClick}\n          src={previewUrlByFilename(state.value.stored_filename)}\n          style={{\n            maxHeight: \"400px\",\n            maxWidth: \"100%\",\n          }}\n        />\n      )}\n      <br />\n      {component.showHint && <span>{component.content?.hint}</span>}\n    </Box>\n\n\n\n\n  );\n}\n\nexport default PhotoCapture;\n"],"names":["PhotoCapture","props","_component$content","runService","useService","component","state","useSelector","runState","values","qualifiedCode","preview","mode","Survey","dispatch","useDispatch","onImageClick","_component$validation","_component$validation2","code","validationMaxSize","validation","validation_max_file_size","isActive","max_size","IMAGE_MAX_SIZE_KB","maxFileSize","Math","min","getFileFromPath","then","response","uploadFile","valueChange","componentCode","value","catch","err","console","error","window","capturePhoto","debug","jsxs","Box","className","styles","container","sx","maxHeight","children","stored_filename","jsx","onClick","src","style","maxWidth","previewUrlByFilename","showHint","content","hint"],"mappings":"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"}