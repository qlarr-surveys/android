{"version":3,"file":"VideoCapture-CPQvFkUw.js","sources":["../../src/components/Questions/VideoCapture/VideoCapture.jsx"],"sourcesContent":["import { Box } from \"@mui/system\";\nimport { useDispatch } from \"react-redux\";\nimport { useSelector } from \"react-redux\";\nimport { previewUrlByFilename, uploadFile } from \"~/networking/run\";\nimport { valueChange } from \"~/state/runState\";\nimport styles from \"./VideoCapture.module.css\";\nimport ReactPlayer from \"react-player\";\nimport { getFileFromPath } from \"~/networking/common\";\nimport { useService } from \"~/hooks/use-service\";\n\nfunction VideoCapture(props) {\n  const runService = useService(\"run\");\n\n  const component = props.component;\n  const state = useSelector((state) => {\n    return state.runState.values[component.qualifiedCode];\n  });\n  const preview = useSelector((state) => {\n    return state.runState.preview;\n  });\n\n  const mode = useSelector((state) => {\n    return state.runState.values.Survey.mode;\n  });\n\n  const dispatch = useDispatch();\n\n  const onImageClick = () => {\n    const code = component.qualifiedCode;\n    const maxFileSize =\n      (component.validation?.validation_max_file_size?.isActive &&\n        component.validation?.validation_max_file_size?.max_size) ||\n      -1;\n    if (preview && mode == \"offline\") {\n      getFileFromPath(\"/dummy_video.mp4\").then((response) => {\n        uploadFile(runService, code, preview, response)\n          .then((response) => {\n            dispatch(\n              valueChange({\n                componentCode: props.component.qualifiedCode,\n                value: response,\n              })\n            );\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      });\n    } else if (window[\"Android\"]) {\n      window[\"Android\"].captureVideo(code, maxFileSize);\n      window[\"onVideoCaptured\" + code] = (value) => {\n        dispatch(\n          valueChange({\n            componentCode: code,\n            value,\n          })\n        );\n      };\n    } else {\n      console.debug(\"no android device!!\");\n    }\n  };\n\n  return (\n    <Box className={styles.container}>\n      {!state.value || !state.value.stored_filename ? (\n        <img\n          onClick={onImageClick}\n          src=\"/video.png\"\n          style={{\n            maxHeight: \"200px\",\n          }}\n        />\n      ) : (\n        <div\n          style={{\n            position: \"relative\",\n            marginTop: \"16px\",\n            // 16:9 aspect ratio\n            paddingTop: \"56%\",\n          }}\n        >\n          <ReactPlayer\n            url={previewUrlByFilename(state.value.stored_filename)}\n            loop={false}\n            light={true}\n            controls={true}\n            config={{\n              forceAudio: false,\n            }}\n            style={{\n              backgroundColor: \"black\",\n              position: \"absolute\",\n              top: \"0\",\n              left: \"0\",\n            }}\n            volume={1}\n            width=\"100%\"\n            height=\"100%\"\n          />\n        </div>\n      )}\n      <br />\n      {component.showHint && <span>{component.content?.hint}</span>}\n    </Box>\n  );\n}\n\nexport default VideoCapture;\n"],"names":["state","_a","response","jsxs","jsx"],"mappings":";;;;;;;AAUA,SAAS,aAAa,OAAO;;AAC3B,QAAM,aAAa,WAAW,KAAK;AAEnC,QAAM,YAAY,MAAM;AACxB,QAAM,QAAQ,YAAY,CAACA,WAAU;AACnC,WAAOA,OAAM,SAAS,OAAO,UAAU,aAAa;AAAA,EACtD,CAAC;AACD,QAAM,UAAU,YAAY,CAACA,WAAU;AACrC,WAAOA,OAAM,SAAS;AAAA,EACxB,CAAC;AAED,QAAM,OAAO,YAAY,CAACA,WAAU;AAClC,WAAOA,OAAM,SAAS,OAAO,OAAO;AAAA,EACtC,CAAC;AAED,QAAM,WAAW,YAAA;AAEjB,QAAM,eAAe,MAAM;;AACzB,UAAM,OAAO,UAAU;AACvB,UAAM,gBACH,MAAAC,MAAA,UAAU,eAAV,gBAAAA,IAAsB,6BAAtB,mBAAgD,eAC/C,qBAAU,eAAV,mBAAsB,6BAAtB,mBAAgD,aAClD;AACF,QAAI,WAAW,QAAQ,WAAW;AAChC,sBAAgB,kBAAkB,EAAE,KAAK,CAAC,aAAa;AACrD,mBAAW,YAAY,MAAM,SAAS,QAAQ,EAC3C,KAAK,CAACC,cAAa;AAClB;AAAA,YACE,YAAY;AAAA,cACV,eAAe,MAAM,UAAU;AAAA,cAC/B,OAAOA;AAAAA,YAAA,CACR;AAAA,UAAA;AAAA,QAEL,CAAC,EACA,MAAM,CAAC,QAAQ;AACd,kBAAQ,MAAM,GAAG;AAAA,QACnB,CAAC;AAAA,MACL,CAAC;AAAA,IACH,WAAW,OAAO,SAAS,GAAG;AAC5B,aAAO,SAAS,EAAE,aAAa,MAAM,WAAW;AAChD,aAAO,oBAAoB,IAAI,IAAI,CAAC,UAAU;AAC5C;AAAA,UACE,YAAY;AAAA,YACV,eAAe;AAAA,YACf;AAAA,UAAA,CACD;AAAA,QAAA;AAAA,MAEL;AAAA,IACF,OAAO;AACL,cAAQ,MAAM,qBAAqB;AAAA,IACrC;AAAA,EACF;AAEA,SACEC,kCAAAA,KAAC,KAAA,EAAI,WAAW,OAAO,WACpB,UAAA;AAAA,IAAA,CAAC,MAAM,SAAS,CAAC,MAAM,MAAM,kBAC5BC,kCAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,SAAS;AAAA,QACT,KAAI;AAAA,QACJ,OAAO;AAAA,UACL,WAAW;AAAA,QAAA;AAAA,MACb;AAAA,IAAA,IAGFA,kCAAAA;AAAAA,MAAC;AAAA,MAAA;AAAA,QACC,OAAO;AAAA,UACL,UAAU;AAAA,UACV,WAAW;AAAA;AAAA,UAEX,YAAY;AAAA,QAAA;AAAA,QAGd,UAAAA,kCAAAA;AAAAA,UAAC;AAAA,UAAA;AAAA,YACC,KAAK,qBAAqB,MAAM,MAAM,eAAe;AAAA,YACrD,MAAM;AAAA,YACN,OAAO;AAAA,YACP,UAAU;AAAA,YACV,QAAQ;AAAA,cACN,YAAY;AAAA,YAAA;AAAA,YAEd,OAAO;AAAA,cACL,iBAAiB;AAAA,cACjB,UAAU;AAAA,cACV,KAAK;AAAA,cACL,MAAM;AAAA,YAAA;AAAA,YAER,QAAQ;AAAA,YACR,OAAM;AAAA,YACN,QAAO;AAAA,UAAA;AAAA,QAAA;AAAA,MACT;AAAA,IAAA;AAAA,0CAGH,MAAA,EAAG;AAAA,IACH,UAAU,YAAYA,kCAAAA,IAAC,QAAA,EAAM,WAAA,eAAU,YAAV,mBAAmB,KAAA,CAAK;AAAA,EAAA,GACxD;AAEJ;"}