{"version":3,"file":"PhotoCapture-legacy-Dnu-n2D-.js","sources":["../../src/components/Questions/PhotoCapture/PhotoCapture.jsx"],"sourcesContent":["import { Box } from \"@mui/system\";\nimport { useDispatch } from \"react-redux\";\nimport { useSelector } from \"react-redux\";\nimport { previewUrl, uploadFile } from \"~/networking/run\";\nimport { valueChange } from \"~/state/runState\";\nimport styles from \"./PhotoCapture.module.css\";\nimport { getFileFromPath } from '~/networking/common';\nimport { useService } from \"~/hooks/use-service\";\n\nfunction PhotoCapture(props) {\n  const runService = useService(\"run\");\n  const component = props.component;\n  const state = useSelector((state) => {\n    return state.runState.values[component.qualifiedCode];\n  });\n  const preview = useSelector((state) => {\n    return state.runState.preview;\n  });\n\n  const mode = useSelector((state) => {\n    return state.runState.values.Survey.mode;\n  });\n\n  const dispatch = useDispatch();\n\n  const onImageClick = () => {\n    const code = component.qualifiedCode;\n    const maxFileSize = (component.validation?.validation_max_file_size?.isActive &&\n      component.validation?.validation_max_file_size?.max_size) || -1;\n    if (preview && mode == \"offline\") {\n      getFileFromPath(\"/dummy_image.png\").then((response) => {\n        uploadFile(runService, code, preview, response)\n          .then((response) => {\n            dispatch(\n              valueChange({\n                componentCode: props.component.qualifiedCode,\n                value: response,\n              })\n            );\n          })\n          .catch((err) => {\n            console.error(err);\n          });\n      });\n    } else if (window[\"Android\"]) {\n      window[\"Android\"].capturePhoto(code, maxFileSize);\n      window[\"onPhotoCaptured\" + code] = (value) => {\n        dispatch(\n          valueChange({\n            componentCode: code,\n            value,\n          })\n        );\n      };\n    } else {\n      console.debug(\"no android device!!\");\n    }\n  };\n\n  return (\n    <Box className={styles.container} sx={{ maxHeight: \"400px\" }}>\n      {!state.value || !state.value.stored_filename ? (\n        <img\n          onClick={onImageClick}\n          src=\"/camera.png\"\n          style={{\n            maxHeight: \"200px\",\n            maxWidth: \"100%\",\n          }}\n        />\n      ) : (\n        <img\n          onClick={onImageClick}\n          src={previewUrl(state.value.stored_filename)}\n          style={{\n            maxHeight: \"400px\",\n            maxWidth: \"100%\",\n          }}\n        />\n      )}\n      <br />\n      {component.showHint && <span>{component.content?.hint}</span>}\n    </Box>\n\n\n\n\n  );\n}\n\nexport default PhotoCapture;\n"],"names":["PhotoCapture","props","_component$content","runService","useService","component","state","useSelector","runState","values","qualifiedCode","preview","mode","Survey","dispatch","useDispatch","onImageClick","_component$validation","_component$validation2","code","maxFileSize","validation","validation_max_file_size","isActive","max_size","getFileFromPath","then","response","uploadFile","valueChange","componentCode","value","catch","err","console","error","window","capturePhoto","debug","jsxs","Box","className","styles","container","sx","maxHeight","children","stored_filename","jsx","onClick","src","style","maxWidth","previewUrl","showHint","content","hint"],"mappings":"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"}